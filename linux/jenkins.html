<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://topjf.github.io/linux/jenkins.html"><meta property="og:site_name" content="topjf"><meta property="og:title" content="Jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½²"><meta property="og:description" content="å¼€å‘pushä»£ç åˆ°gitï¼Œè§¦å‘jenkinsè‡ªåŠ¨pullä»£ç ï¼Œé€šè¿‡mavenç¼–è¯‘ã€æ‰“åŒ…ï¼Œç„¶åé€šè¿‡æ‰§è¡Œshellè„šæœ¬ä½¿dockeræ„å»ºé•œåƒå¹¶pushåˆ°ç§æœï¼ˆæˆ–è€…é˜¿é‡Œäº‘ï¼‰ä»“åº“ï¼Œæ­¤æ“ä½œå®ŒæˆåjenkinsæœåŠ¡å™¨ä¸Šå†æ‰§è¡ŒSSHå‘½ä»¤ç™»å½•åˆ°éƒ¨ç½²æœåŠ¡å™¨ï¼Œdockerä»ä»“åº“ï¼ˆç§æœï¼‰æ‹‰å–é•œåƒï¼Œå¯åŠ¨å®¹å™¨ã€‚æ•´ä¸ªæ“ä½œæµç¨‹å®Œæˆã€‚ é€šè¿‡ war å®‰è£… 2.372ï¼ˆæ¨èä½¿ç”¨ï¼‰ ä¸‹è½½..."><meta property="og:type" content="article"><meta property="og:image" content="https://topjf.github.io/"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2022-12-16T06:02:03.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="Jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½²"><meta property="article:tag" content="linux"><meta property="article:tag" content="Jebkins"><meta property="article:published_time" content="2022-08-09T00:00:00.000Z"><meta property="article:modified_time" content="2022-12-16T06:02:03.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½²","image":["https://topjf.github.io/"],"datePublished":"2022-08-09T00:00:00.000Z","dateModified":"2022-12-16T06:02:03.000Z","author":[]}</script><script type="text/javascript" src="/script/demo.js"></script><link rel="stylesheet" href="/iconfont/iconfont.css"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>Jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½² | topjf</title><meta name="description" content="å¼€å‘pushä»£ç åˆ°gitï¼Œè§¦å‘jenkinsè‡ªåŠ¨pullä»£ç ï¼Œé€šè¿‡mavenç¼–è¯‘ã€æ‰“åŒ…ï¼Œç„¶åé€šè¿‡æ‰§è¡Œshellè„šæœ¬ä½¿dockeræ„å»ºé•œåƒå¹¶pushåˆ°ç§æœï¼ˆæˆ–è€…é˜¿é‡Œäº‘ï¼‰ä»“åº“ï¼Œæ­¤æ“ä½œå®ŒæˆåjenkinsæœåŠ¡å™¨ä¸Šå†æ‰§è¡ŒSSHå‘½ä»¤ç™»å½•åˆ°éƒ¨ç½²æœåŠ¡å™¨ï¼Œdockerä»ä»“åº“ï¼ˆç§æœï¼‰æ‹‰å–é•œåƒï¼Œå¯åŠ¨å®¹å™¨ã€‚æ•´ä¸ªæ“ä½œæµç¨‹å®Œæˆã€‚ é€šè¿‡ war å®‰è£… 2.372ï¼ˆæ¨èä½¿ç”¨ï¼‰ ä¸‹è½½...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-41a36a5c.css" as="style"><link rel="stylesheet" href="/assets/style-41a36a5c.css">
    <link rel="modulepreload" href="/assets/app-30d3d221.js"><link rel="modulepreload" href="/assets/framework-ed4f969a.js"><link rel="modulepreload" href="/assets/jenkins.html-d192fce6.js"><link rel="modulepreload" href="/assets/jenkins.html-3082f494.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.png" alt="topjf"><!----><span class="site-name hide-in-pad">topjf</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="é¦–é¡µ"><span class="font-icon icon iconfont icon-home" style=""></span>é¦–é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a href="/home.html" class="nav-link" aria-label="å¿«é€Ÿå¯¼èˆª"><span class="font-icon icon iconfont icon-arrow" style=""></span>å¿«é€Ÿå¯¼èˆª<!----></a></div><div class="nav-item hide-in-mobile"><a href="/all/all.html" class="nav-link" aria-label="é¢è¯•å®å…¸"><span class="font-icon icon iconfont icon-overflow" style=""></span>é¢è¯•å®å…¸<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="ä¸ªäººä¸­å¿ƒ"><span class="title"><span class="font-icon icon iconfont icon-anonymous" style=""></span>ä¸ªäººä¸­å¿ƒ</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/article" class="nav-link" aria-label="æ–‡ç« "><span class="font-icon icon iconfont icon-note" style=""></span>æ–‡ç« <!----></a></li><li class="dropdown-item"><a href="/category" class="nav-link" aria-label="åˆ†ç±»"><span class="font-icon icon iconfont icon-categoryselected" style=""></span>åˆ†ç±»<!----></a></li><li class="dropdown-item"><a href="/tag" class="nav-link" aria-label="æ ‡ç­¾"><span class="font-icon icon iconfont icon-list" style=""></span>æ ‡ç­¾<!----></a></li><li class="dropdown-item"><a href="/encrypted" class="nav-link" aria-label="åŠ å¯†æ–‡ç« "><span class="font-icon icon iconfont icon-command" style=""></span>åŠ å¯†æ–‡ç« <!----></a></li><li class="dropdown-item"><a href="/star" class="nav-link" aria-label="æ”¶è—æ–‡ç« "><span class="font-icon icon iconfont icon-like" style=""></span>æ”¶è—æ–‡ç« <!----></a></li><li class="dropdown-item"><a href="/timeline" class="nav-link" aria-label="æ—¶é—´çº¿"><span class="font-icon icon iconfont icon-time" style=""></span>æ—¶é—´çº¿<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="ç½‘ç«™ç›¸å…³"><span class="title"><span class="font-icon icon iconfont icon-info" style=""></span>ç½‘ç«™ç›¸å…³</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/about/about-this.html" class="nav-link" aria-label="å…³äºæœ¬ç«™"><span class="font-icon icon iconfont icon-people" style=""></span>å…³äºæœ¬ç«™<!----></a></li><li class="dropdown-item"><a href="/history/history.html" class="nav-link" aria-label="ç½‘ç«™å†å²"><span class="font-icon icon iconfont icon-time" style=""></span>ç½‘ç«™å†å²<!----></a></li><li class="dropdown-item"><a href="https://theme-hope.vuejs.press/zh/" rel="noopener noreferrer" target="_blank" aria-label="VuePress Theme Hope æ–‡æ¡£" class="nav-link"><span class="font-icon icon iconfont icon-creative" style=""></span>VuePress Theme Hope æ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/topjf/topjf" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button class="search-pro-button" role="search" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg></button><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><p class="sidebar-heading"><span class="font-icon icon iconfont icon-object" style=""></span><span class="title">åŸºç¡€å‘½ä»¤</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/linux/basis/command.html" class="nav-link sidebar-link sidebar-page" aria-label="Linuxç¬”å‘½ä»¤å¤§å…¨"><span class="font-icon icon iconfont icon-linux" style=""></span>Linuxç¬”å‘½ä»¤å¤§å…¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/basis/basis.html" class="nav-link sidebar-link sidebar-page" aria-label="LinuxåŸºç¡€"><span class="font-icon icon iconfont icon-linux" style=""></span>LinuxåŸºç¡€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><!--[--><a href="/linux/command-examples.html" class="nav-link sidebar-link sidebar-page" aria-label="Linuxå¸¸ç”¨å‘½ä»¤å®ä¾‹"><span class="font-icon icon iconfont icon-linux" style=""></span>Linuxå¸¸ç”¨å‘½ä»¤å®ä¾‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/exception-analysis.html" class="nav-link sidebar-link sidebar-page" aria-label="Linuxå¸¸è§å¼‚å¸¸åˆ†æ"><span class="font-icon icon iconfont icon-linux" style=""></span>Linuxå¸¸è§å¼‚å¸¸åˆ†æ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/network-setting.html" class="nav-link sidebar-link sidebar-page" aria-label="centosç½‘ç»œç½‘å¡é…ç½®"><span class="font-icon icon iconfont icon-linux" style=""></span>centosç½‘ç»œç½‘å¡é…ç½®<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/disk.html" class="nav-link sidebar-link sidebar-page" aria-label="ç£ç›˜ç›¸å…³çŸ¥è¯†"><span class="font-icon icon iconfont icon-linux" style=""></span>ç£ç›˜ç›¸å…³çŸ¥è¯†<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/yum-repo.html" class="nav-link sidebar-link sidebar-page" aria-label="YUM æºé…ç½®"><span class="font-icon icon iconfont icon-linux" style=""></span>YUM æºé…ç½®<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/update-kernel.html" class="nav-link sidebar-link sidebar-page" aria-label="centos(kernel)å†…æ ¸å‡çº§"><span class="font-icon icon iconfont icon-linux" style=""></span>centos(kernel)å†…æ ¸å‡çº§<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/linux/jenkins.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½²"><span class="font-icon icon iconfont icon-linux" style=""></span>Jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½²<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#é€šè¿‡-war-å®‰è£…-2-372-æ¨èä½¿ç”¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é€šè¿‡ war å®‰è£… 2.372ï¼ˆæ¨èä½¿ç”¨ï¼‰"><!---->é€šè¿‡ war å®‰è£… 2.372ï¼ˆæ¨èä½¿ç”¨ï¼‰<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#å®‰è£…-jdk" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å®‰è£… JDK"><!---->å®‰è£… JDK<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#å®‰è£…-tomcat" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å®‰è£… tomcat"><!---->å®‰è£… tomcat<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#å®‰è£…-maven" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å®‰è£… maven"><!---->å®‰è£… maven<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#tomcat-å¯åŠ¨-jenkins" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="tomcat å¯åŠ¨ jenkins"><!---->tomcat å¯åŠ¨ jenkins<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#é€šè¿‡-yum-å®‰è£…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é€šè¿‡ yum å®‰è£…"><!---->é€šè¿‡ yum å®‰è£…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#é€šè¿‡-docker-å®‰è£…-2-363" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é€šè¿‡ docker å®‰è£… 2.363"><!---->é€šè¿‡ docker å®‰è£… 2.363<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#å®‰è£…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å®‰è£…"><!---->å®‰è£…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#æŸ¥çœ‹ç®¡ç†å‘˜å¯†ç " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æŸ¥çœ‹ç®¡ç†å‘˜å¯†ç "><!---->æŸ¥çœ‹ç®¡ç†å‘˜å¯†ç <!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#é…ç½®å›½å†…ç«™ç‚¹åŠ é€Ÿ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é…ç½®å›½å†…ç«™ç‚¹åŠ é€Ÿ"><!---->é…ç½®å›½å†…ç«™ç‚¹åŠ é€Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#å®‰è£…æ’ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å®‰è£…æ’ä»¶"><!---->å®‰è£…æ’ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#å®‰è£…è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²æ‰€éœ€çš„æ’ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å®‰è£…è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²æ‰€éœ€çš„æ’ä»¶"><!---->å®‰è£…è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²æ‰€éœ€çš„æ’ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#åˆ›å»ºç”¨æˆ·" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åˆ›å»ºç”¨æˆ·"><!---->åˆ›å»ºç”¨æˆ·<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#è‡ªåŠ¨éƒ¨ç½²é¡¹ç›®-springboot-maven-gitee" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è‡ªåŠ¨éƒ¨ç½²é¡¹ç›®ï¼ˆspringBoot+maven+giteeï¼‰"><!---->è‡ªåŠ¨éƒ¨ç½²é¡¹ç›®ï¼ˆspringBoot+maven+giteeï¼‰<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#æ·»åŠ å‡­è¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ·»åŠ å‡­è¯"><!---->æ·»åŠ å‡­è¯<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#åŸºç¡€ä»‹ç»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åŸºç¡€ä»‹ç»"><!---->åŸºç¡€ä»‹ç»<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#ä»€ä¹ˆæ˜¯æµæ°´çº¿" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä»€ä¹ˆæ˜¯æµæ°´çº¿"><!---->ä»€ä¹ˆæ˜¯æµæ°´çº¿<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#å£°æ˜å¼æµæ°´çº¿" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å£°æ˜å¼æµæ°´çº¿"><!---->å£°æ˜å¼æµæ°´çº¿<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/linux/jenkins.html#jenkinsfile-çš„ä½¿ç”¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Jenkinsfile çš„ä½¿ç”¨"><!---->Jenkinsfile çš„ä½¿ç”¨<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading"><span class="font-icon icon iconfont icon-tool" style=""></span><span class="title">è¿ç»´ç›‘æ§å·¥å…·</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/linux/monitoringtools/nagios.html" class="nav-link sidebar-link sidebar-page" aria-label="Nagiosç›‘æ§å¹³å°"><span class="font-icon icon iconfont icon-edit" style=""></span>Nagiosç›‘æ§å¹³å°<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/monitoringtools/open-falcon.html" class="nav-link sidebar-link sidebar-page" aria-label="Open-Falconç›‘æ§å¹³å°"><span class="font-icon icon iconfont icon-edit" style=""></span>Open-Falconç›‘æ§å¹³å°<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/monitoringtools/zabbix2.html" class="nav-link sidebar-link sidebar-page" aria-label="Zabbixæ¦‚è¿°ç¯‡"><span class="font-icon icon iconfont icon-edit" style=""></span>Zabbixæ¦‚è¿°ç¯‡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/monitoringtools/zabbix.html" class="nav-link sidebar-link sidebar-page" aria-label="Zabbixç›‘æ§å¹³å°å®‰è£…ç¯‡"><span class="font-icon icon iconfont icon-edit" style=""></span>Zabbixç›‘æ§å¹³å°å®‰è£…ç¯‡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><span class="font-icon icon iconfont icon-tool" style=""></span><span class="title">ansibleè¿ç»´ç®¡ç†å·¥å…·</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/linux/ansible/ansible.html" class="nav-link sidebar-link sidebar-page" aria-label="ansible AD-Hocå‘½ä»¤æ‰§è¡Œå·¥å…·"><span class="font-icon icon iconfont icon-linux" style=""></span>ansible AD-Hocå‘½ä»¤æ‰§è¡Œå·¥å…·<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/ansible/ansible-doc.html" class="nav-link sidebar-link sidebar-page" aria-label="ansible-docæ¨¡å—åŠŸèƒ½æŸ¥çœ‹å·¥å…·"><span class="font-icon icon iconfont icon-linux" style=""></span>ansible-docæ¨¡å—åŠŸèƒ½æŸ¥çœ‹å·¥å…·<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/ansible/ansible-galaxy.html" class="nav-link sidebar-link sidebar-page" aria-label="ansible-galaxy"><span class="font-icon icon iconfont icon-linux" style=""></span>ansible-galaxy<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/ansible/ansible-playbook.html" class="nav-link sidebar-link sidebar-page" aria-label="ansible-playbookä»»åŠ¡ç¼–æ’å·¥å…·ï¼ˆå‰§æœ¬ï¼‰"><span class="font-icon icon iconfont icon-linux" style=""></span>ansible-playbookä»»åŠ¡ç¼–æ’å·¥å…·ï¼ˆå‰§æœ¬ï¼‰<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/ansible/ansible-docker.html" class="nav-link sidebar-link sidebar-page" aria-label="ansibleå®‰è£…docker"><span class="font-icon icon iconfont icon-linux" style=""></span>ansibleå®‰è£…docker<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/ansible/ansible-jdk.html" class="nav-link sidebar-link sidebar-page" aria-label="ansibleå®‰è£…jdk"><span class="font-icon icon iconfont icon-linux" style=""></span>ansibleå®‰è£…jdk<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/ansible/ansible-mysql.html" class="nav-link sidebar-link sidebar-page" aria-label="ansibleå®‰è£…mysql"><span class="font-icon icon iconfont icon-linux" style=""></span>ansibleå®‰è£…mysql<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/ansible/ansible-nginx.html" class="nav-link sidebar-link sidebar-page" aria-label="ansibleå®‰è£…nginx"><span class="font-icon icon iconfont icon-linux" style=""></span>ansibleå®‰è£…nginx<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/ansible/ansible-redis.html" class="nav-link sidebar-link sidebar-page" aria-label="ansibleå®‰è£…Redis"><span class="font-icon icon iconfont icon-linux" style=""></span>ansibleå®‰è£…Redis<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/linux/ansible/ansible-basis.html" class="nav-link sidebar-link sidebar-page" aria-label="ansibleå®‰è£…ä¸åŸºç¡€æ¦‚å¿µ"><span class="font-icon icon iconfont icon-linux" style=""></span>ansibleå®‰è£…ä¸åŸºç¡€æ¦‚å¿µ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><!--[--><a href="/linux/shell.html" class="nav-link sidebar-link sidebar-page" aria-label="Shell è„šæœ¬ç¼–ç¨‹"><span class="font-icon icon iconfont icon-linux" style=""></span>Shell è„šæœ¬ç¼–ç¨‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="font-icon icon iconfont icon-linux" style=""></span>Jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½²</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="/article" target="_blank" rel="noopener noreferrer">topjf</a></span><span property="author" content="topjf"></span></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category0 clickable" role="navigation">Linux</span><meta property="articleSection" content="Linux"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><span class="page-tag-item tag6 clickable" role="navigation">linux</span><span class="page-tag-item tag5 clickable" role="navigation">Jebkins</span><meta property="keywords" content="linux,Jebkins"></span><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-08-09T00:00:00.000Z"></span><!----><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 7319 å­—</span><meta property="wordCount" content="7319"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 24 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT24M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹<!----></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#é€šè¿‡-war-å®‰è£…-2-372-æ¨èä½¿ç”¨" class="router-link-active router-link-exact-active toc-link level2">é€šè¿‡ war å®‰è£… 2.372ï¼ˆæ¨èä½¿ç”¨ï¼‰</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#å®‰è£…-jdk" class="router-link-active router-link-exact-active toc-link level3">å®‰è£… JDK</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#å®‰è£…-tomcat" class="router-link-active router-link-exact-active toc-link level3">å®‰è£… tomcat</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#å®‰è£…-maven" class="router-link-active router-link-exact-active toc-link level3">å®‰è£… maven</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#tomcat-å¯åŠ¨-jenkins" class="router-link-active router-link-exact-active toc-link level3">tomcat å¯åŠ¨ jenkins</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#é€šè¿‡-yum-å®‰è£…" class="router-link-active router-link-exact-active toc-link level2">é€šè¿‡ yum å®‰è£…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#é€šè¿‡-docker-å®‰è£…-2-363" class="router-link-active router-link-exact-active toc-link level2">é€šè¿‡ docker å®‰è£… 2.363</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#å®‰è£…" class="router-link-active router-link-exact-active toc-link level3">å®‰è£…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#æŸ¥çœ‹ç®¡ç†å‘˜å¯†ç " class="router-link-active router-link-exact-active toc-link level3">æŸ¥çœ‹ç®¡ç†å‘˜å¯†ç </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#é…ç½®å›½å†…ç«™ç‚¹åŠ é€Ÿ" class="router-link-active router-link-exact-active toc-link level3">é…ç½®å›½å†…ç«™ç‚¹åŠ é€Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#å®‰è£…æ’ä»¶" class="router-link-active router-link-exact-active toc-link level3">å®‰è£…æ’ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#å®‰è£…è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²æ‰€éœ€çš„æ’ä»¶" class="router-link-active router-link-exact-active toc-link level3">å®‰è£…è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²æ‰€éœ€çš„æ’ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#åˆ›å»ºç”¨æˆ·" class="router-link-active router-link-exact-active toc-link level3">åˆ›å»ºç”¨æˆ·</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#è‡ªåŠ¨éƒ¨ç½²é¡¹ç›®-springboot-maven-gitee" class="router-link-active router-link-exact-active toc-link level2">è‡ªåŠ¨éƒ¨ç½²é¡¹ç›®ï¼ˆspringBoot+maven+giteeï¼‰</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#æ·»åŠ å‡­è¯" class="router-link-active router-link-exact-active toc-link level3">æ·»åŠ å‡­è¯</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#åŸºç¡€ä»‹ç»" class="router-link-active router-link-exact-active toc-link level2">åŸºç¡€ä»‹ç»</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#ä»€ä¹ˆæ˜¯æµæ°´çº¿" class="router-link-active router-link-exact-active toc-link level3">ä»€ä¹ˆæ˜¯æµæ°´çº¿</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#å£°æ˜å¼æµæ°´çº¿" class="router-link-active router-link-exact-active toc-link level3">å£°æ˜å¼æµæ°´çº¿</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/linux/jenkins.html#jenkinsfile-çš„ä½¿ç”¨" class="router-link-active router-link-exact-active toc-link level3">Jenkinsfile çš„ä½¿ç”¨</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><!-- more --><h1>Jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½²</h1><p><img src="/assets/true-image-20220810165403975-a1b4f51f.png" alt=""></p><blockquote><p>å¼€å‘pushä»£ç åˆ°gitï¼Œè§¦å‘jenkinsè‡ªåŠ¨pullä»£ç ï¼Œé€šè¿‡mavenç¼–è¯‘ã€æ‰“åŒ…ï¼Œç„¶åé€šè¿‡æ‰§è¡Œshellè„šæœ¬ä½¿dockeræ„å»ºé•œåƒå¹¶pushåˆ°ç§æœï¼ˆæˆ–è€…é˜¿é‡Œäº‘ï¼‰ä»“åº“ï¼Œæ­¤æ“ä½œå®ŒæˆåjenkinsæœåŠ¡å™¨ä¸Šå†æ‰§è¡ŒSSHå‘½ä»¤ç™»å½•åˆ°éƒ¨ç½²æœåŠ¡å™¨ï¼Œdockerä»ä»“åº“ï¼ˆç§æœï¼‰æ‹‰å–é•œåƒï¼Œå¯åŠ¨å®¹å™¨ã€‚æ•´ä¸ªæ“ä½œæµç¨‹å®Œæˆã€‚</p></blockquote><hr><h2 id="é€šè¿‡-war-å®‰è£…-2-372-æ¨èä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#é€šè¿‡-war-å®‰è£…-2-372-æ¨èä½¿ç”¨" aria-hidden="true">#</a> é€šè¿‡ war å®‰è£… 2.372ï¼ˆæ¨èä½¿ç”¨ï¼‰</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://mirrors.huaweicloud.com/jenkins/war/2.346/jenkins.war" target="_blank" rel="noopener noreferrer">huaweiæº2.346<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€<a href="https://get.jenkins.io/war-stable/" target="_blank" rel="noopener noreferrer">ç¨³å®šç‰ˆåˆ—è¡¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€<a href="https://get.jenkins.io/war/" target="_blank" rel="noopener noreferrer">å°é²œç‰ˆåˆ—è¡¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">wget</span> <span class="token parameter variable">-O</span> ./jenkins3611.war https://get.jenkins.io/war-stable/2.361.1/jenkins.war
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">wget</span> <span class="token parameter variable">-O</span> ./jenkins372.war https://get.jenkins.io/war/2.372/jenkins.war
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å®‰è£…ï¼ˆæå–ç ï¼š1234ï¼‰ï¼š <a href="https://pan.baidu.com/s/17pkHcX7YrssnEVctveHbHQ" target="_blank" rel="noopener noreferrer">javaå„ä¸ªç‰ˆæœ¬ä¸‹è½½<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€<a href="https://pan.baidu.com/s/1ch1_sjFDvvgY52-niYEBFw" target="_blank" rel="noopener noreferrer">maven3.8<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€<a href="https://pan.baidu.com/s/1TQgpdHz6p38k6QxPsBDhrQ" target="_blank" rel="noopener noreferrer">tomcat<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€yum install -y git</p><h3 id="å®‰è£…-jdk" tabindex="-1"><a class="header-anchor" href="#å®‰è£…-jdk" aria-hidden="true">#</a> å®‰è£… JDK</h3><ul><li>å¸è½½é»˜è®¤jdk</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>rpm -qa | grep java
rpm -e --nodeps java-1.8.0-openjdk*
rpm -e --nodeps  java-1.8.0-openjdk*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è§£å‹å®‰è£…</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>tar -zxvf jdk-17_linux-x64_bin.tar.gz -C /usr/java/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>rm -rf /usr/bin/ja* &amp;&amp; ln -s /usr/java/jdk-17.0.4/bin/ja* /usr/bin/ &amp;&amp; ls -al /usr/bin/ja*</code></p><ul><li>è®¾ç½®ç¯å¢ƒå˜é‡</li></ul><p><code>vim /etc/profile</code></p><p>jdk17æ²¡æœ‰jreç›®å½•</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/java/jdk-17.0.4

<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®‰è£…-tomcat" tabindex="-1"><a class="header-anchor" href="#å®‰è£…-tomcat" aria-hidden="true">#</a> å®‰è£… tomcat</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>tar -zxvf apache-tomcat-9.0.65.tar.gz -C /data
mv /data/apache-tomcat-9.0.65 /data/tomcat-9.0.65 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è®¾ç½®ç«¯å£ <code>vim /data/tomcat-9.0.65/conf/server.xml</code></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>51000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>HTTP/1.1<span class="token punctuation">&quot;</span></span>
               <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20000<span class="token punctuation">&quot;</span></span>
               <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8443<span class="token punctuation">&quot;</span></span> <span class="token attr-name">URIEncoding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®‰è£…-maven" tabindex="-1"><a class="header-anchor" href="#å®‰è£…-maven" aria-hidden="true">#</a> å®‰è£… maven</h3><ul><li>è§£å‹</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>tar -zxvf apache-maven-3.8.6-bin.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>è®¾ç½®ç¯å¢ƒå˜é‡</li></ul><p><code>vim /etc/profile</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/java/jdk-17.0.4
<span class="token builtin class-name">export</span> <span class="token assign-left variable">M2_HOME</span><span class="token operator">=</span>/data/apache-maven-3.8.6

<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">${M2_HOME}</span>/bin:<span class="token environment constant">$PATH</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼š<code>source /etc/profile</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@n1 apache-maven-3.8.6<span class="token punctuation">]</span><span class="token comment"># mvn -v</span>

Apache Maven <span class="token number">3.8</span>.6 <span class="token punctuation">(</span>84538c9988a25aec085021c365c560670ad80f63<span class="token punctuation">)</span>
Maven home: /data/apache-maven-3.8.6
Java version: <span class="token number">17.0</span>.4, vendor: Oracle Corporation, runtime: /usr/java/jdk-17.0.4
Default locale: zh_CN, platform encoding: UTF-8
OS name: <span class="token string">&quot;linux&quot;</span>, version: <span class="token string">&quot;3.10.0-1160.71.1.el7.x86_64&quot;</span>, arch: <span class="token string">&quot;amd64&quot;</span>, family: <span class="token string">&quot;unix&quot;</span>

<span class="token punctuation">[</span>root@n1 soft<span class="token punctuation">]</span><span class="token comment"># java -version</span>
<span class="token function">java</span> version <span class="token string">&quot;17.0.4&quot;</span> <span class="token number">2022</span>-07-19 LTS
Java<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> SE Runtime Environment <span class="token punctuation">(</span>build <span class="token number">17.0</span>.4+11-LTS-179<span class="token punctuation">)</span>
Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">17.0</span>.4+11-LTS-179, mixed mode, sharing<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="tomcat-å¯åŠ¨-jenkins" tabindex="-1"><a class="header-anchor" href="#tomcat-å¯åŠ¨-jenkins" aria-hidden="true">#</a> tomcat å¯åŠ¨ jenkins</h3><p>ä½¿ç”¨Javaæµ‹è¯•è¿è¡Œ1 <code>java -jar jenkins.war httpPort=8889</code></p><p>æŠŠwaræ”¾åˆ° tomcat é‡Œè¿è¡Œ <code>cp -R ../software/jenkins.war ./webapps/</code></p><p>æ‰§è¡Œï¼š<code>./bin/startup.sh</code></p><p>è®¿é—®ï¼š<code>http://192.168.100.130:51000/jenkins372/</code></p><p><img src="/assets/true-image-20221005172127451-24e0cd50.png" alt=""></p><p>æŸ¥çœ‹å¯†ç </p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> /root/.jenkins/secrets/initialAdminPassword
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>62db2150540d400a8b86944ea4c9a2af</p><p><strong>åç»­å‚è€ƒä¸‹é¢dockerçš„ï¼šã€å®‰è£…æ’ä»¶ã€‘</strong></p><h2 id="é€šè¿‡-yum-å®‰è£…" tabindex="-1"><a class="header-anchor" href="#é€šè¿‡-yum-å®‰è£…" aria-hidden="true">#</a> é€šè¿‡ yum å®‰è£…</h2><p>ç¨³å®šç‰ˆ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo

<span class="token comment">#########</span>
<span class="token punctuation">[</span>jenkins<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>Jenkins-stable
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://pkg.jenkins.io/redhat-stable
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">########</span>

<span class="token function">sudo</span> <span class="token function">rpm</span> <span class="token parameter variable">--import</span> https://pkg.jenkins.io/redhat-stable/jenkins.io.key
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€æ–°ç‰ˆ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/yum.repos.d/jenkins2.repo https://pkg.jenkins.io/redhat/jenkins.repo
 
<span class="token comment">#########</span>
<span class="token punctuation">[</span>jenkins<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>Jenkins
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://pkg.jenkins.io/redhat
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">########</span>
 
<span class="token function">rpm</span> <span class="token parameter variable">--import</span> https://pkg.jenkins.io/redhat/jenkins.io.key
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> jenkins

jenkins <span class="token parameter variable">--version</span>
<span class="token number">2.363</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹jenkinsçš„ç«¯å£å·ï¼Œé»˜è®¤ä¸º8080ã€‚è¿™é‡Œä¿®æ”¹ä¸º8099ã€‚</p><p>vim /etc/sysconfig/jenkins ï¼šjenkinsé…ç½®æ–‡ä»¶</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment">## Type:        integer(0:65535)</span>
<span class="token comment">## Default:     8080</span>
<span class="token comment">## ServiceRestart: jenkins</span>
<span class="token comment">#</span>
<span class="token comment"># Port Jenkins is listening on.</span>
<span class="token comment"># Set to -1 to disable</span>
<span class="token comment">#</span>
JENKINS_PORT=&quot;8099&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service Jenkins restart
systemctl enable jenkins.service
systemctl start jenkins.service
systemctl restart jenkins.service
systemctl status jenkins.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥çœ‹å¯†ç </p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> /var/lib/jenkins/secrets/initialAdminPassword
2a35ad12127f45fd8a61b1017b38c907
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="http://192.168.100.130:8099" target="_blank" rel="noopener noreferrer">http://192.168.100.130:8099<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h2 id="é€šè¿‡-docker-å®‰è£…-2-363" tabindex="-1"><a class="header-anchor" href="#é€šè¿‡-docker-å®‰è£…-2-363" aria-hidden="true">#</a> é€šè¿‡ docker å®‰è£… 2.363</h2><p><a href="https://blog.csdn.net/xiaoxiangzi520/article/details/88842200" target="_blank" rel="noopener noreferrer">è‡ªåŠ¨åŒ–éƒ¨ç½² å‚è€ƒ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://blog.csdn.net/qq_42476834/article/details/117373828" target="_blank" rel="noopener noreferrer">è®¾ç½®dockerå¿«æ·é”®<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://hub.docker.com/r/jenkins/jenkins" target="_blank" rel="noopener noreferrer">docker.hub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="å®‰è£…" tabindex="-1"><a class="header-anchor" href="#å®‰è£…" aria-hidden="true">#</a> å®‰è£…</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull jenkins/jenkins:latest
<span class="token function">docker</span> pull jenkins/jenkins:lts-jdk17
<span class="token function">docker</span> pull jenkins/jenkins:lts-centos7
<span class="token function">docker</span> pull jenkins/jenkins:2.363
<span class="token function">docker</span> pull jenkins/jenkins:2.363-jdk17
<span class="token function">docker</span> pull jenkins/jenkins:2.363-centos7

<span class="token function">docker</span> tag jenkins/jenkins:2.363-centos7 registry.cn-chengdu.aliyuncs.com/jinfang/jenkins:2.363-centos7

<span class="token function">docker</span> push registry.cn-chengdu.aliyuncs.com/jinfang/jenkins:2.363-centos7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /data/jenkins_home
<span class="token function">chmod</span> <span class="token number">777</span> /data/jenkins_home
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8888</span>:8080 <span class="token parameter variable">-p</span> <span class="token number">50000</span>:50000 <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span> always <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /data/jenkins_home:/var/jenkins_home <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /etc/localtime:/etc/localtime <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> jenkins registry.cn-chengdu.aliyuncs.com/jinfang/jenkins:latest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8889</span>:8080 <span class="token parameter variable">-p</span> <span class="token number">50001</span>:50000 <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span> always <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /data/jenkins_jdk17:/var/jenkins_home <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /etc/localtime:/etc/localtime <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> jenkins-jdk17 registry.cn-chengdu.aliyuncs.com/jinfang/jenkins:2.363-jdk17
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ansible web -m shell -a &#39;docker pull registry.cn-chengdu.aliyuncs.com/jinfang/jenkins:latest&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è®¿é—®ï¼š<a href="http://192.168.0.8:8889" target="_blank" rel="noopener noreferrer">http://192.168.0.8:8889<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><p><img src="/assets/true-image-20220810180106690-97f6b7d9.png" alt=""></p><hr><p><img src="/assets/true-image-20220810174515569-ad9345bd.png" alt=""></p><hr><h3 id="æŸ¥çœ‹ç®¡ç†å‘˜å¯†ç " tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹ç®¡ç†å‘˜å¯†ç " aria-hidden="true">#</a> æŸ¥çœ‹ç®¡ç†å‘˜å¯†ç </h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker logs jenkins
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>
*************************************************************
*************************************************************
*************************************************************

Jenkins initial setup is required. An admin user has been created and a password generated.
Please use the following password to proceed to installation:

62fc38a29bf840ee8c5fcf746ad9f574

This may also be found at: /var/jenkins_home/secrets/initialAdminPassword

*************************************************************
*************************************************************
*************************************************************
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>62fc38a29bf840ee8c5fcf746ad9f574</p></blockquote><h3 id="é…ç½®å›½å†…ç«™ç‚¹åŠ é€Ÿ" tabindex="-1"><a class="header-anchor" href="#é…ç½®å›½å†…ç«™ç‚¹åŠ é€Ÿ" aria-hidden="true">#</a> é…ç½®å›½å†…ç«™ç‚¹åŠ é€Ÿ</h3><p><code>vim /data/jenkins_home/hudson.model.UpdateCenter.xml</code></p><p>æŠŠ <code>https://updates.jenkins.io/update-center.json</code></p><p>æ¢ä¸ºå…¶ä¸­ä¹‹ä¸€</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>https://updates.jenkins-zh.cn/update-center.json

https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json

https://mirrors.huaweicloud.com/jenkins/updates/update-center.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&#39;1.1&#39; encoding=&#39;UTF-8&#39;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sites</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>default<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://mirrors.huaweicloud.com/jenkins/updates/update-center.json<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>site</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sites</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶å®å›½å†…çš„é…ç½®å†…å®¹ä½¿ç”¨çš„ä¸‹è½½æ›´æ–°åœ°å€ä¹Ÿæ˜¯ <em>Jenkins</em> å®˜æ–¹é»˜è®¤ä¸‹è½½çš„åœ°å€ï¼Œæ‰€ä»¥è¿˜å¾—ç¼–è¾‘ <code>updates/default.json</code></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sed -i &#39;s#https://updates.jenkins.io/download#https://mirrors.huaweicloud.com/jenkins#g&#39; default.json

sed -i &#39;s#http://www.google.com#https://www.baidu.com#g&#39; default.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å›½å†…å¸¸ç”¨çš„é•œåƒåœ°å€ï¼š</p><table><thead><tr><th>æ¥æº</th><th>åœ°å€</th></tr></thead><tbody><tr><td>tencent</td><td><a href="https://mirrors.cloud.tencent.com/jenkins/" target="_blank" rel="noopener noreferrer">https://mirrors.cloud.tencent.com/jenkins/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td></tr><tr><td>huawei</td><td><a href="https://mirrors.huaweicloud.com/jenkins/" target="_blank" rel="noopener noreferrer">https://mirrors.huaweicloud.com/jenkins/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td></tr><tr><td>tsinghua</td><td><a href="https://mirrors.tuna.tsinghua.edu.cn/jenkins/" target="_blank" rel="noopener noreferrer">https://mirrors.tuna.tsinghua.edu.cn/jenkins/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td></tr><tr><td>ustc</td><td><a href="https://mirrors.ustc.edu.cn/jenkins/" target="_blank" rel="noopener noreferrer">https://mirrors.ustc.edu.cn/jenkins/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td></tr><tr><td>bit</td><td><a href="http://mirror.bit.edu.cn/jenkins/" target="_blank" rel="noopener noreferrer">http://mirror.bit.edu.cn/jenkins/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td></tr></tbody></table><p>ä¹Ÿå¯ä»¥åœ¨ç®¡ç†ç•Œé¢è¿›è¡Œè®¾ç½®</p><p><img src="/assets/true-image-20220815154424445-0dc04bf4.png" alt=""></p><p>é‡å¯æœåŠ¡ï¼š<code>docker restart jenkins</code></p><p>æŸ¥çœ‹é…ç½®ï¼š <code>[root@n1 jenkins_home]# cat updates/default.json</code></p><h3 id="å®‰è£…æ’ä»¶" tabindex="-1"><a class="header-anchor" href="#å®‰è£…æ’ä»¶" aria-hidden="true">#</a> å®‰è£…æ’ä»¶</h3><p>äºŒé€‰ä¸€å³å¯</p><p><img src="/assets/true-image-20220810180823960-21251171.png" alt=""></p><p><img src="/assets/true-image-20220815172322524-f8237869.png" alt=""></p><h3 id="å®‰è£…è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²æ‰€éœ€çš„æ’ä»¶" tabindex="-1"><a class="header-anchor" href="#å®‰è£…è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²æ‰€éœ€çš„æ’ä»¶" aria-hidden="true">#</a> å®‰è£…è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²æ‰€éœ€çš„æ’ä»¶</h3><p>æ‰€éœ€æ’ä»¶ï¼šgit pluginã€Maven Integrationã€Pipeline Maven Integrationã€Gitlabã€SSHã€Publish Over SSHã€giteeã€githubã€Deploy to containerã€Dockerã€Docker Commonsã€docker-build-step</p><p>â€‹</p><p><img src="/assets/true-image-20220815175644826-e07b981b.png" alt=""></p><p><img src="/assets/true-image-20220815175704436-9a02dd83.png" alt=""></p><p><img src="/assets/true-image-20220815175737395-62ea9871.png" alt=""></p><h3 id="åˆ›å»ºç”¨æˆ·" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºç”¨æˆ·" aria-hidden="true">#</a> åˆ›å»ºç”¨æˆ·</h3><p>admin admin123456</p><p><img src="/assets/true-image-20220815152906828-cdfc2be0.png" alt=""></p><p><img src="/assets/true-image-20220815152959582-8b634e1f.png" alt=""></p><p><img src="/assets/true-image-20220815153017867-bb8f0f54.png" alt=""></p><hr><h2 id="è‡ªåŠ¨éƒ¨ç½²é¡¹ç›®-springboot-maven-gitee" tabindex="-1"><a class="header-anchor" href="#è‡ªåŠ¨éƒ¨ç½²é¡¹ç›®-springboot-maven-gitee" aria-hidden="true">#</a> è‡ªåŠ¨éƒ¨ç½²é¡¹ç›®ï¼ˆspringBoot+maven+giteeï¼‰</h2><h3 id="æ·»åŠ å‡­è¯" tabindex="-1"><a class="header-anchor" href="#æ·»åŠ å‡­è¯" aria-hidden="true">#</a> æ·»åŠ å‡­è¯</h3><p><code>http://192.168.100.130:51000/gitee-project/drj</code></p><h2 id="åŸºç¡€ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€ä»‹ç»" aria-hidden="true">#</a> åŸºç¡€ä»‹ç»</h2><p><em>å°ç›®å½•</em></p><ul><li>ä»€ä¹ˆæ˜¯æµæ°´çº¿</li><li>å£°æ˜å¼æµæ°´çº¿</li><li>Jenkinsfile çš„ä½¿ç”¨</li></ul><h3 id="ä»€ä¹ˆæ˜¯æµæ°´çº¿" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯æµæ°´çº¿" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯æµæ°´çº¿</h3><p>jenkins æœ‰ 2 ç§æµæ°´çº¿åˆ†ä¸º <strong>å£°æ˜å¼æµæ°´çº¿</strong>ä¸<strong>è„šæœ¬åŒ–æµæ°´çº¿</strong>ï¼Œ è„šæœ¬åŒ–æµæ°´çº¿æ˜¯ jenkins æ—§ç‰ˆæœ¬ä½¿ç”¨çš„æµæ°´çº¿è„šæœ¬ï¼Œæ–°ç‰ˆæœ¬ Jenkins æ¨èä½¿ç”¨å£°æ˜å¼æµæ°´çº¿ã€‚ æ–‡æ¡£åªä»‹ç»å£°æ˜æµæ°´çº¿ã€‚</p><h4 id="_1å£°æ˜å¼æµæ°´çº¿" tabindex="-1"><a class="header-anchor" href="#_1å£°æ˜å¼æµæ°´çº¿" aria-hidden="true">#</a> 1å£°æ˜å¼æµæ°´çº¿</h4><p>åœ¨å£°æ˜å¼æµæ°´çº¿è¯­æ³•ä¸­ï¼Œæµæ°´çº¿è¿‡ç¨‹å®šä¹‰åœ¨ <code>Pipeline{}</code> ä¸­ï¼ŒPipeline å—å®šä¹‰äº†æ•´ä¸ªæµæ°´çº¿ä¸­å®Œæˆçš„æ‰€æœ‰å·¥ä½œï¼Œæ¯”å¦‚</p><p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p><ul><li><strong>agent any</strong> ï¼šåœ¨ä»»ä½•å¯ç”¨çš„ä»£ç†ä¸Šæ‰§è¡Œæµæ°´çº¿æˆ–å®ƒçš„ä»»ä½•é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œæµæ°´çº¿è¿‡ç¨‹çš„ä½ç½®ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šåˆ°å…·ä½“çš„èŠ‚ç‚¹</li><li><strong>stage</strong> ï¼šå®šä¹‰æµæ°´çº¿çš„æ‰§è¡Œè¿‡ç¨‹ï¼ˆç›¸å½“äºä¸€ä¸ªé˜¶æ®µï¼‰ï¼Œæ¯”å¦‚ä¸‹æ–‡æ‰€ç¤ºçš„ <code>Buildã€Testã€Deploy</code>ï¼Œ ä½†æ˜¯è¿™ä¸ªåå­—æ˜¯æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œå®šä¹‰çš„ï¼Œå¹¶éå›ºå®šçš„åå­—</li><li><strong>steps</strong> ï¼šæ‰§è¡ŒæŸé˜¶æ®µå…·ä½“çš„æ­¥éª¤ã€‚</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>//Jenkinsfile (Declarative Pipeline)
pipeline {
  agent any
    stages {
      stage(&#39;Build&#39;) {
        steps {
          echo &#39;Build&#39;
        }
      }
      stage(&#39;Test&#39;) {
        steps {
          echo &#39;Test&#39;
        }
      }
      stage(&#39;Deploy&#39;) {
        steps {
          echo &#39;Deploy&#39;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2è„šæœ¬åŒ–æµæ°´çº¿" tabindex="-1"><a class="header-anchor" href="#_2è„šæœ¬åŒ–æµæ°´çº¿" aria-hidden="true">#</a> 2è„šæœ¬åŒ–æµæ°´çº¿</h4><p>åœ¨è„šæœ¬åŒ–æµæ°´çº¿è¯­æ³•ä¸­ï¼Œä¼šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ª Nodeï¼ˆèŠ‚ç‚¹ï¼‰å—åœ¨æ•´ä¸ªæµæ°´çº¿ä¸­æ‰§è¡Œæ ¸å¿ƒå·¥ä½œ</p><p><strong>å‚æ•°è¯´æ˜:</strong></p><ul><li><strong>node</strong> ï¼šåœ¨ä»»ä½•å¯ç”¨çš„ä»£ç†ä¸Šæ‰§è¡Œæµæ°´çº¿æˆ–å®ƒçš„ä»»ä½•é˜¶æ®µï¼Œä¹Ÿå¯ä»¥æŒ‡å®šåˆ°å…·ä½“çš„èŠ‚ç‚¹</li><li><strong>stage</strong> ï¼šå’Œå£°æ˜å¼çš„å«ä¹‰ä¸€è‡´ï¼Œå®šä¹‰æµæ°´çº¿çš„é˜¶æ®µã€‚Stage å—åœ¨è„šæœ¬åŒ–æµæ°´çº¿è¯­æ³•ä¸­æ˜¯å¯é€‰çš„ï¼Œ ç„¶è€Œåœ¨è„šæœ¬åŒ–æµæ°´çº¿ä¸­å®ç° stage å—ï¼Œå¯ä»¥æ¸…æ¥šåœ°åœ¨ Jenkins UI ç•Œé¢ä¸­æ˜¾ç¤ºæ¯ä¸ª stage çš„ä»»åŠ¡å­é›†ã€‚</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>//Jenkinsfile (Scripted Pipeline)
node <span class="token punctuation">{</span>
  stage(&#39;Build&#39;) <span class="token punctuation">{</span>
    echo &#39;Build&#39;
  <span class="token punctuation">}</span>
  stage(&#39;Test&#39;) <span class="token punctuation">{</span>
    echo &#39;Test&#39;
  <span class="token punctuation">}</span>
  stage(&#39;Deploy&#39;) <span class="token punctuation">{</span>
    echo &#39;Deploy&#39;
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å£°æ˜å¼æµæ°´çº¿" tabindex="-1"><a class="header-anchor" href="#å£°æ˜å¼æµæ°´çº¿" aria-hidden="true">#</a> å£°æ˜å¼æµæ°´çº¿</h3><p>å£°æ˜å¼æµæ°´çº¿å¿…é¡»åŒ…å«åœ¨ä¸€ä¸ª <code>Pipeline</code> å—ä¸­ï¼Œæ¯”å¦‚æ˜¯ä¸€ä¸ª <code>Pipeline</code> å—çš„æ ¼å¼</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>pipeline <span class="token punctuation">{</span>
  /* insert Declarative Pipeline here <span class="token important">*/</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å£°æ˜å¼æµæ°´çº¿ä¸­æœ‰æ•ˆçš„åŸºæœ¬è¯­å¥å’Œè¡¨è¾¾å¼éµå¾ªä¸ <code>Groovy</code> çš„è¯­æ³•åŒæ ·çš„è§„åˆ™ï¼Œä½†æœ‰ä»¥ä¸‹ä¾‹å¤–</p><ul><li>æµæ°´çº¿é¡¶å±‚å¿…é¡»æ˜¯ä¸€ä¸ª blockï¼Œå³ pipeline{}</li><li>åˆ†éš”ç¬¦å¯ä»¥ä¸éœ€è¦åˆ†å·ï¼Œä½†æ˜¯æ¯æ¡è¯­å¥éƒ½å¿…é¡»åœ¨è‡ªå·±çš„è¡Œä¸Š</li><li>å—åªèƒ½ç”± Sectionsã€Directivesã€Steps æˆ– assignment statements ç»„æˆ</li><li>å±æ€§å¼•ç”¨è¯­å¥è¢«å½“åšæ˜¯æ— å‚æ•°çš„æ–¹æ³•è°ƒç”¨ï¼Œæ¯”å¦‚ input ä¼šè¢«å½“åš input()ã€‚</li></ul><h4 id="sections" tabindex="-1"><a class="header-anchor" href="#sections" aria-hidden="true">#</a> Sections</h4><p>å£°æ˜å¼æµæ°´çº¿ä¸­çš„ Sections ä¸æ˜¯ä¸€ä¸ªå…³é”®å­—æˆ–æŒ‡ä»¤ï¼Œ è€Œæ˜¯åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª <code>Agent</code>ã€<code>Stages</code>ã€ <code>post</code>ã€<code>Directives</code> å’Œ <code>Steps</code> çš„ä»£ç åŒºåŸŸå—ã€‚</p><p>1.Agent</p><p>Agent è¡¨ç¤ºæ•´ä¸ªæµæ°´çº¿æˆ–ç‰¹å®šé˜¶æ®µä¸­çš„æ­¥éª¤å’Œå‘½ä»¤æ‰§è¡Œçš„ä½ç½®ï¼Œè¯¥éƒ¨åˆ†å¿…é¡»åœ¨ pipeline å—çš„é¡¶å±‚è¢«å®šä¹‰ï¼Œä¹Ÿå¯ä»¥åœ¨ stage ä¸­å†æ¬¡å®šä¹‰ï¼Œä½†æ˜¯ stage çº§åˆ«æ˜¯å¯é€‰çš„ã€‚</p><p><strong>any</strong></p><p>åœ¨ä»»ä½•å¯ç”¨çš„ä»£ç†ä¸Šæ‰§è¡Œæµæ°´çº¿ï¼Œé…ç½®è¯­æ³•</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>pipeline <span class="token punctuation">{</span>
  agent any
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>none</strong></p><p>è¡¨ç¤ºè¯¥ Pipeline è„šæœ¬æ²¡æœ‰å…¨å±€çš„ agent é…ç½®ã€‚å½“é¡¶å±‚çš„ agent é…ç½®ä¸º none æ—¶ï¼Œ æ¯ä¸ª stage éƒ¨åˆ†éƒ½éœ€è¦åŒ…å«å®ƒè‡ªå·±çš„ agentã€‚é…ç½®è¯­æ³•</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>pipeline <span class="token punctuation">{</span>
  agent none
  stages <span class="token punctuation">{</span>
    stage(&#39;Stage For Build&#39;)<span class="token punctuation">{</span>
      agent any
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>label</strong></p><p>ä»¥èŠ‚ç‚¹æ ‡ç­¾å½¢å¼é€‰æ‹©æŸä¸ªå…·ä½“çš„èŠ‚ç‚¹æ‰§è¡Œ Pipeline å‘½ä»¤ï¼Œä¾‹å¦‚ï¼šagent { label &#39;my-defined-label&#39; }ã€‚èŠ‚ç‚¹éœ€è¦æå‰é…ç½®æ ‡ç­¾ã€‚</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>pipeline <span class="token punctuation">{</span>
  agent none
    stages <span class="token punctuation">{</span>
      stage(&#39;Stage For Build&#39;)<span class="token punctuation">{</span>
        agent <span class="token punctuation">{</span> label &#39;role<span class="token punctuation">-</span>master&#39; <span class="token punctuation">}</span>
        steps <span class="token punctuation">{</span>
          echo &quot;role<span class="token punctuation">-</span>master&quot;
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>node</strong></p><p>å’Œ label é…ç½®ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯å¯ä»¥æ·»åŠ ä¸€äº›é¢å¤–çš„é…ç½®ï¼Œæ¯”å¦‚ customWorkspace(è®¾ç½®é»˜è®¤å·¥ä½œç›®å½•)</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>pipeline <span class="token punctuation">{</span>
  agent none
    stages <span class="token punctuation">{</span>
      stage(&#39;Stage For Build&#39;)<span class="token punctuation">{</span>
        agent <span class="token punctuation">{</span>
          node <span class="token punctuation">{</span>
            label &#39;role<span class="token punctuation">-</span>master&#39;
            customWorkspace &quot;/tmp/zhangzhuo/data&quot;
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        steps <span class="token punctuation">{</span>
          sh &quot;echo role<span class="token punctuation">-</span>master <span class="token punctuation">&gt;</span> 1.txt&quot;
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>dockerfile</strong></p><p>ä½¿ç”¨ä»æºç ä¸­åŒ…å«çš„ Dockerfile æ‰€æ„å»ºçš„å®¹å™¨æ‰§è¡Œæµæ°´çº¿æˆ– stageã€‚æ­¤æ—¶å¯¹åº”çš„ agent å†™æ³•å¦‚ä¸‹</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>agent <span class="token punctuation">{</span>
   dockerfile <span class="token punctuation">{</span>
     filename &#39;Dockerfile.build&#39;  //dockerfileæ–‡ä»¶åç§°
     dir &#39;build&#39;                  //æ‰§è¡Œæ„å»ºé•œåƒçš„å·¥ä½œç›®å½•
     label &#39;role<span class="token punctuation">-</span>master&#39;          //æ‰§è¡Œçš„nodeèŠ‚ç‚¹ï¼Œæ ‡ç­¾é€‰æ‹©
     additionalBuildArgs &#39;<span class="token punctuation">-</span><span class="token punctuation">-</span>build<span class="token punctuation">-</span>arg version=1.0.2&#39; //æ„å»ºå‚æ•°
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>docker</strong></p><p>ç›¸å½“äº dockerfileï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ docker å­—æ®µæŒ‡å®šå¤–éƒ¨é•œåƒå³å¯ï¼Œå¯ä»¥çœå»æ„å»ºçš„æ—¶é—´ã€‚æ¯”å¦‚ä½¿ç”¨ maven é•œåƒè¿›è¡Œæ‰“åŒ…ï¼ŒåŒæ—¶å¯ä»¥æŒ‡å®š args</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>agent{
  docker{
    image &#39;192.168.10.15/kubernetes/alpine:latest&#39;   //é•œåƒåœ°å€
    label &#39;role-master&#39; //æ‰§è¡Œçš„èŠ‚ç‚¹ï¼Œæ ‡ç­¾é€‰æ‹©
    args &#39;-v /tmp:/tmp&#39;      //å¯åŠ¨é•œåƒçš„å‚æ•°
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>kubernetes</strong></p><p>éœ€è¦éƒ¨ç½² kubernetes ç›¸å…³çš„æ’ä»¶ï¼Œ<a href="https://github.com/jenkinsci/kubernetes-plugin/" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>Jenkins ä¹Ÿæ”¯æŒä½¿ç”¨ Kubernetes åˆ›å»º Slaveï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„åŠ¨æ€ Slaveã€‚é…ç½®ç¤ºä¾‹å¦‚ä¸‹</p><ul><li><p>cloud: Configure Clouds çš„åç§°ï¼ŒæŒ‡å®šåˆ°å…¶ä¸­ä¸€ä¸ª k8s</p></li><li><p>slaveConnectTimeout: è¿æ¥è¶…æ—¶æ—¶é—´</p></li><li><p>yaml: pod å®šä¹‰æ–‡ä»¶ï¼Œjnlp å®¹å™¨çš„é…ç½®å¿…é¡»æœ‰é…ç½®æ— éœ€æ”¹å˜ï¼Œå…¶ä½™ containerd æ ¹æ®è‡ªå·±æƒ…å†µæŒ‡å®š</p></li><li><p>workspaceVolumeï¼šæŒä¹…åŒ– jenkins çš„å·¥ä½œç›®å½•ã€‚</p></li><li><p>persistentVolumeClaimWorkspaceVolumeï¼šæŒ‚è½½å·²æœ‰ pvcã€‚</p></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>workspaceVolume persistentVolumeClaimWorkspaceVolume<span class="token punctuation">(</span>claimName: <span class="token string">&quot;jenkins-agent&quot;</span>, mountPath: <span class="token string">&quot;/&quot;</span>, readOnly: <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>nfsWorkspaceVolumeï¼šæŒ‚è½½ nfs æœåŠ¡å™¨ç›®å½•</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>workspaceVolume nfsWorkspaceVolume<span class="token punctuation">(</span>serverAddress: <span class="token string">&quot;192.168.10.254&quot;</span>, serverPath: <span class="token string">&quot;/nfs&quot;</span>, readOnly: <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>dynamicPVCï¼šåŠ¨æ€ç”³è¯· pvcï¼Œä»»åŠ¡æ‰§è¡Œç»“æŸååˆ é™¤</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>workspaceVolume dynamicPVC<span class="token punctuation">(</span>storageClassName: <span class="token string">&quot;nfs-client&quot;</span>, requestsSize: <span class="token string">&quot;1Gi&quot;</span>, accessModes: <span class="token string">&quot;ReadWriteMany&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>emptyDirWorkspaceVolumeï¼šä¸´æ—¶ç›®å½•ï¼Œä»»åŠ¡æ‰§è¡Œç»“æŸåä¼šéšç€ pod åˆ é™¤è¢«åˆ é™¤ï¼Œä¸»è¦åŠŸèƒ½å¤šä¸ªä»»åŠ¡ container å…±äº« jenkins å·¥ä½œç›®å½•ã€‚</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>workspaceVolume emptyDirWorkspaceVolume<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>hostPathWorkspaceVolumeï¼šæŒ‚è½½ node èŠ‚ç‚¹æœ¬æœºç›®å½•ï¼Œæ³¨æ„æŒ‚è½½æœ¬æœºç›®å½•æ³¨æ„æƒé™é—®é¢˜ï¼Œå¯ä»¥å…ˆåˆ›å»ºè®¾ç½® 777 æƒé™ï¼Œå¦åˆ™é»˜è®¤ kubelet åˆ›å»ºçš„ç›®å½•æƒé™ä¸º 755 é»˜è®¤å…¶ä»–ç”¨æˆ·æ²¡æœ‰å†™æƒé™ï¼Œæ‰§è¡Œæµæ°´çº¿ä¼šæŠ¥é”™ã€‚</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>workspaceVolume hostPathWorkspaceVolume<span class="token punctuation">(</span>hostPath: <span class="token string">&quot;/opt/workspace&quot;</span>, readOnly: <span class="token boolean">false</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç¤ºä¾‹</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>agent {
  kubernetes {
      cloud &#39;kubernetes&#39;
      slaveConnectTimeout 1200
      workspaceVolume emptyDirWorkspaceVolume()
      yaml &#39;&#39;&#39;
kind: Pod
metadata:
  name: jenkins-agent
spec:
  containers:
  - args: [\&#39;$(JENKINS_SECRET)\&#39;, \&#39;$(JENKINS_NAME)\&#39;]
    image: &#39;192.168.10.15/kubernetes/jnlp:alpine&#39;
    name: jnlp
    imagePullPolicy: IfNotPresent
  - command:
      - &quot;cat&quot;
    image: &quot;192.168.10.15/kubernetes/alpine:latest&quot;
    imagePullPolicy: &quot;IfNotPresent&quot;
    name: &quot;date&quot;
    tty: true
  restartPolicy: Never
&#39;&#39;&#39;
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.agent çš„é…ç½®ç¤ºä¾‹</p><p><strong>kubernetes ç¤ºä¾‹</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
  agent {
    kubernetes {
      cloud &#39;kubernetes&#39;
      slaveConnectTimeout 1200
      workspaceVolume emptyDirWorkspaceVolume()
      yaml &#39;&#39;&#39;
kind: Pod
metadata:
  name: jenkins-agent
spec:
  containers:
  - args: [\&#39;$(JENKINS_SECRET)\&#39;, \&#39;$(JENKINS_NAME)\&#39;]
    image: &#39;192.168.10.15/kubernetes/jnlp:alpine&#39;
    name: jnlp
    imagePullPolicy: IfNotPresent
  - command:
      - &quot;cat&quot;
    image: &quot;192.168.10.15/kubernetes/alpine:latest&quot;
    imagePullPolicy: &quot;IfNotPresent&quot;
    name: &quot;date&quot;
    tty: true
  - command:
      - &quot;cat&quot;
    image: &quot;192.168.10.15/kubernetes/kubectl:apline&quot;
    imagePullPolicy: &quot;IfNotPresent&quot;
    name: &quot;kubectl&quot;
    tty: true
  restartPolicy: Never
&#39;&#39;&#39;
    }
  }
  environment {
    MY_KUBECONFIG = credentials(&#39;kubernetes-cluster&#39;)
  }
  stages {
    stage(&#39;Data&#39;) {
      steps {
        container(name: &#39;date&#39;) {
          sh &quot;&quot;&quot;
            date
          &quot;&quot;&quot;
        }
      }
    }
    stage(&#39;echo&#39;) {
      steps {
        container(name: &#39;date&#39;) {
          sh &quot;&quot;&quot;
            echo &#39;k8s is pod&#39;
          &quot;&quot;&quot;
        }
      }
    }
    stage(&#39;kubectl&#39;) {
      steps {
        container(name: &#39;kubectl&#39;) {
          sh &quot;&quot;&quot;
            kubectl get pod -A  --kubeconfig $MY_KUBECONFIG
          &quot;&quot;&quot;
        }
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>docker çš„ç¤ºä¾‹</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
  agent none
  stages {
    stage(&#39;Example Build&#39;) {
      agent { docker &#39;maven:3-alpine&#39; }
      steps {
        echo &#39;Hello, Maven&#39;
        sh &#39;mvn --version&#39;
      }
    }
    stage(&#39;Example Test&#39;) {
      agent { docker &#39;openjdk:8-jre&#39; }
      steps {
        echo &#39;Hello, JDK&#39;
        sh &#39;java -version&#39;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.Post</p><p>Post ä¸€èˆ¬ç”¨äºæµæ°´çº¿ç»“æŸåçš„è¿›ä¸€æ­¥å¤„ç†ï¼Œæ¯”å¦‚é”™è¯¯é€šçŸ¥ç­‰ã€‚ Post å¯ä»¥é’ˆå¯¹æµæ°´çº¿ä¸åŒçš„ç»“æœåšå‡ºä¸åŒçš„å¤„ç†ï¼Œå°±åƒå¼€å‘ç¨‹åºçš„é”™è¯¯å¤„ç†ï¼Œ æ¯”å¦‚ Python è¯­è¨€çš„ <code>try catch</code>ã€‚</p><p>Post å¯ä»¥å®šä¹‰åœ¨ Pipeline æˆ– stage ä¸­ï¼Œç›®å‰æ”¯æŒä»¥ä¸‹æ¡ä»¶</p><ul><li><strong>always</strong>ï¼šæ— è®º Pipeline æˆ– stage çš„å®ŒæˆçŠ¶æ€å¦‚ä½•ï¼Œéƒ½å…è®¸è¿è¡Œè¯¥ post ä¸­å®šä¹‰çš„æŒ‡ä»¤ï¼›</li><li><strong>changed</strong>ï¼šåªæœ‰å½“å‰ Pipeline æˆ– stage çš„å®ŒæˆçŠ¶æ€ä¸å®ƒä¹‹å‰çš„è¿è¡Œä¸åŒæ—¶ï¼Œæ‰å…è®¸åœ¨è¯¥ post éƒ¨åˆ†è¿è¡Œè¯¥æ­¥éª¤ï¼›</li><li><strong>fixed</strong>ï¼šå½“æœ¬æ¬¡ Pipeline æˆ– stage æˆåŠŸï¼Œä¸”ä¸Šä¸€æ¬¡æ„å»ºæ˜¯å¤±è´¥æˆ–ä¸ç¨³å®šæ—¶ï¼Œå…è®¸è¿è¡Œè¯¥ post ä¸­å®šä¹‰çš„æŒ‡ä»¤ï¼›</li><li><strong>regression</strong>ï¼šå½“æœ¬æ¬¡ Pipeline æˆ– stage çš„çŠ¶æ€ä¸ºå¤±è´¥ã€ä¸ç¨³å®šæˆ–ç»ˆæ­¢ï¼Œä¸”ä¸Šä¸€æ¬¡æ„å»ºçš„ çŠ¶æ€ä¸ºæˆåŠŸæ—¶ï¼Œå…è®¸è¿è¡Œè¯¥ post ä¸­å®šä¹‰çš„æŒ‡ä»¤ï¼›</li><li><strong>failure</strong>ï¼šåªæœ‰å½“å‰ Pipeline æˆ– stage çš„å®ŒæˆçŠ¶æ€ä¸ºå¤±è´¥ï¼ˆfailureï¼‰ï¼Œæ‰å…è®¸åœ¨ post éƒ¨åˆ†è¿è¡Œè¯¥æ­¥éª¤ï¼Œé€šå¸¸è¿™æ—¶åœ¨ Web ç•Œé¢ä¸­æ˜¾ç¤ºä¸ºçº¢è‰²</li><li><strong>success</strong>ï¼šå½“å‰çŠ¶æ€ä¸ºæˆåŠŸï¼ˆsuccessï¼‰ï¼Œæ‰§è¡Œ post æ­¥éª¤ï¼Œé€šå¸¸åœ¨ Web ç•Œé¢ä¸­æ˜¾ç¤ºä¸ºè“è‰² æˆ–ç»¿è‰²</li><li><strong>unstable</strong>ï¼šå½“å‰çŠ¶æ€ä¸ºä¸ç¨³å®šï¼ˆunstableï¼‰ï¼Œæ‰§è¡Œ post æ­¥éª¤ï¼Œé€šå¸¸ç”±äºæµ‹è¯•å¤±è´¥æˆ–ä»£ç  è¿è§„ç­‰é€ æˆï¼Œåœ¨ Web ç•Œé¢ä¸­æ˜¾ç¤ºä¸ºé»„è‰²</li><li><strong>aborted</strong>ï¼šå½“å‰çŠ¶æ€ä¸ºç»ˆæ­¢ï¼ˆabortedï¼‰ï¼Œæ‰§è¡Œè¯¥ post æ­¥éª¤ï¼Œé€šå¸¸ç”±äºæµæ°´çº¿è¢«æ‰‹åŠ¨ç»ˆæ­¢è§¦å‘ï¼Œè¿™æ—¶åœ¨ Web ç•Œé¢ä¸­æ˜¾ç¤ºä¸ºç°è‰²ï¼›</li><li><strong>unsuccessful</strong>ï¼šå½“å‰çŠ¶æ€ä¸æ˜¯ success æ—¶ï¼Œæ‰§è¡Œè¯¥ post æ­¥éª¤ï¼›</li><li><strong>cleanup</strong>ï¼šæ— è®º pipeline æˆ– stage çš„å®ŒæˆçŠ¶æ€å¦‚ä½•ï¼Œéƒ½å…è®¸è¿è¡Œè¯¥ post ä¸­å®šä¹‰çš„æŒ‡ä»¤ã€‚å’Œ always çš„åŒºåˆ«åœ¨äºï¼Œcleanup ä¼šåœ¨å…¶å®ƒæ‰§è¡Œä¹‹åæ‰§è¡Œã€‚</li></ul><p>ç¤ºä¾‹</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ post éƒ¨åˆ†æ”¾åœ¨æµæ°´çº¿çš„åº•éƒ¨ï¼Œæ¯”å¦‚æœ¬å®ä¾‹ï¼Œæ— è®º stage çš„å®ŒæˆçŠ¶æ€å¦‚ä½•ï¼Œ éƒ½ä¼šè¾“å‡ºä¸€æ¡ <code>I will always say Hello again!</code> ä¿¡æ¯</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//Jenkinsfile (Declarative Pipeline)
pipeline {
  agent any
  stages {
    stage(&#39;Example1&#39;) {
      steps {
        echo &#39;Hello World1&#39;
      }
    }
    stage(&#39;Example2&#39;) {
      steps {
        echo &#39;Hello World2&#39;
      }
    }
  }
  post {
    always {
      echo &#39;I will always say Hello again!&#39;
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå¯ä»¥å°† post å†™åœ¨ stageï¼Œä¸‹é¢ç¤ºä¾‹è¡¨ç¤º Example1 æ‰§è¡Œå¤±è´¥æ‰§è¡Œ postã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//Jenkinsfile (Declarative Pipeline)
pipeline {
  agent any
  stages {
    stage(&#39;Example1&#39;) {
      steps {
        sh &#39;ip a&#39;
      }
      post {
        failure {
          echo &#39;I will always say Hello again!&#39;
        }
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4.sepes</p><p>Steps éƒ¨åˆ†åœ¨ç»™å®šçš„ stage æŒ‡ä»¤ä¸­æ‰§è¡Œçš„ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤ï¼Œæ¯”å¦‚åœ¨ steps å®šä¹‰æ‰§è¡Œä¸€æ¡ shell å‘½ä»¤</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//Jenkinsfile (Declarative Pipeline)
pipeline {
  agent any
  stages {
    stage(&#39;Example&#39;) {
      steps {
        echo &#39;Hello World&#39;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…æ˜¯ä½¿ç”¨ sh å­—æ®µæ‰§è¡Œå¤šæ¡æŒ‡ä»¤</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//Jenkinsfile (Declarative Pipeline)
pipeline {
  agent any
  stages {
    stage(&#39;Example&#39;) {
      steps {
        sh &quot;&quot;&quot;
           echo &#39;Hello World1&#39;
           echo &#39;Hello World2&#39;
        &quot;&quot;&quot;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="directives-æ¡ä»¶åˆ¤æ–­æˆ–é¢„å¤„ç†æ•°æ®" tabindex="-1"><a class="header-anchor" href="#directives-æ¡ä»¶åˆ¤æ–­æˆ–é¢„å¤„ç†æ•°æ®" aria-hidden="true">#</a> Directives æ¡ä»¶åˆ¤æ–­æˆ–é¢„å¤„ç†æ•°æ®</h4><p>Directives å¯ç”¨äºä¸€äº›æ‰§è¡Œ stage æ—¶çš„æ¡ä»¶åˆ¤æ–­æˆ–é¢„å¤„ç†ä¸€äº›æ•°æ®ï¼Œå’Œ Sections ä¸€è‡´ï¼ŒDirectives ä¸æ˜¯ä¸€ä¸ªå…³é”®å­—æˆ–æŒ‡ä»¤ï¼Œ è€Œæ˜¯åŒ…å«äº† <code>environmentã€optionsã€parametersã€triggersã€stageã€toolsã€ inputã€when</code> ç­‰é…ç½®ã€‚</p><p>1.Environment</p><p>Environment ä¸»è¦ç”¨äºåœ¨æµæ°´çº¿ä¸­é…ç½®çš„ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œæ ¹æ®é…ç½®çš„ä½ç½®å†³å®šç¯å¢ƒå˜é‡çš„ä½œç”¨åŸŸã€‚</p><p>å¯ä»¥å®šä¹‰åœ¨ pipeline ä¸­ä½œä¸ºå…¨å±€å˜é‡ï¼Œä¹Ÿå¯ä»¥é…ç½®åœ¨ stage ä¸­ä½œä¸ºè¯¥ stage çš„ç¯å¢ƒå˜é‡ã€‚è¯¥æŒ‡ä»¤æ”¯æŒä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³• <code>credentials()</code>ï¼Œ è¯¥æ–¹æ³•å¯ç”¨äºåœ¨ Jenkins ç¯å¢ƒä¸­é€šè¿‡æ ‡è¯†ç¬¦è®¿é—®é¢„å®šä¹‰çš„å‡­è¯ã€‚</p><p>å¯¹äºç±»å‹ä¸º Secret Text çš„å‡­è¯ï¼Œ<code>credentials()</code>å¯ä»¥å°†è¯¥ Secret ä¸­çš„æ–‡æœ¬å†…å®¹èµ‹å€¼ç»™ç¯å¢ƒå˜é‡ã€‚</p><p>å¯¹äºç±»å‹ä¸ºæ ‡å‡†çš„è´¦å·å¯†ç å‹çš„å‡­è¯ï¼ŒæŒ‡å®šçš„ç¯å¢ƒå˜é‡ä¸º username å’Œ passwordï¼Œå¹¶ä¸”ä¹Ÿä¼šå®šä¹‰ä¸¤ä¸ªé¢å¤–çš„ç¯å¢ƒå˜é‡ï¼Œåˆ†åˆ«ä¸º<code>MYVARNAME_USR</code>å’Œ<code>MYVARNAME_PSW</code>ã€‚</p><ul><li>åŸºæœ¬å˜é‡ä½¿ç”¨</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//ç¤ºä¾‹
pipeline {
  agent any
  environment {   //å…¨å±€å˜é‡ï¼Œä¼šåœ¨æ‰€æœ‰stageä¸­ç”Ÿæ•ˆ
    NAME= &#39;zhangzhuo&#39;
  }
  stages {
    stage(&#39;env1&#39;) {
      environment { //å®šä¹‰åœ¨stageä¸­çš„å˜é‡åªä¼šåœ¨å½“å‰stageç”Ÿæ•ˆï¼Œå…¶ä»–çš„stageä¸ä¼šç”Ÿæ•ˆ
        HARBOR = &#39;https://192.168.10.15&#39;
      }
      steps {
        sh &quot;env&quot;
      }
    }
    stage(&#39;env2&#39;) {
      steps {
        sh &quot;env&quot;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä½¿ç”¨å˜é‡å¼•ç”¨ secret çš„å‡­è¯</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//è¿™é‡Œä½¿ç”¨k8sçš„kubeconfigæ–‡ä»¶ç¤ºä¾‹
pipeline {
  agent any
  environment {
    KUBECONFIG = credentials(&#39;kubernetes-cluster&#39;)
  }
  stages {
    stage(&#39;env&#39;) {
      steps {
        sh &quot;env&quot;  //é»˜è®¤æƒ…å†µä¸‹è¾“å‡ºçš„å˜é‡å†…å®¹ä¼šè¢«åŠ å¯†
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨å˜é‡å¼•ç”¨ç±»å‹ä¸ºæ ‡å‡†çš„è´¦å·å¯†ç å‹çš„å‡­è¯</strong></p><p>è¿™é‡Œä½¿ç”¨ HARBOR å˜é‡è¿›è¡Œæ¼”ç¤ºï¼Œé»˜è®¤æƒ…å†µä¸‹è´¦å·å¯†ç å‹çš„å‡­è¯ä¼šè‡ªåŠ¨åˆ›å»º 3 ä¸ªå˜é‡</p><ul><li><strong>HARBOR_USR</strong>: ä¼šæŠŠå‡­è¯ä¸­ username å€¼èµ‹å€¼ç»™è¿™ä¸ªå˜é‡</li><li><strong>HARBOR_PSW</strong>: ä¼šæŠŠå‡­è¯ä¸­ password å€¼èµ‹å€¼ç»™è¿™ä¸ªå˜é‡</li><li><strong>HARBOR</strong>: é»˜è®¤æƒ…å†µä¸‹èµ‹å€¼çš„å€¼ä¸º <code>usernamme:password</code></li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//è¿™é‡Œä½¿ç”¨k8sçš„kubeconfigæ–‡ä»¶ç¤ºä¾‹
pipeline {
  agent any
  environment {
    HARBOR = credentials(&#39;harbor-account&#39;)
  }
  stages {
    stage(&#39;env&#39;) {
      steps {
        sh &quot;env&quot;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.Options</p><p>Jenkins æµæ°´çº¿æ”¯æŒå¾ˆå¤šå†…ç½®æŒ‡ä»¤ï¼Œæ¯”å¦‚ retry å¯ä»¥å¯¹å¤±è´¥çš„æ­¥éª¤è¿›è¡Œé‡å¤æ‰§è¡Œ n æ¬¡ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„æŒ‡ä»¤å®ç°ä¸åŒçš„æ•ˆæœã€‚</p><p>æ¯”è¾ƒå¸¸ç”¨çš„æŒ‡ä»¤å¦‚ä¸‹:</p><ul><li><strong>buildDiscarder</strong>ï¼šä¿ç•™å¤šå°‘ä¸ªæµæ°´çº¿çš„æ„å»ºè®°å½•</li><li><strong>disableConcurrentBuilds</strong>ï¼šç¦æ­¢æµæ°´çº¿å¹¶è¡Œæ‰§è¡Œï¼Œé˜²æ­¢å¹¶è¡Œæµæ°´çº¿åŒæ—¶è®¿é—®å…±äº«èµ„æºå¯¼è‡´æµæ°´çº¿å¤±è´¥ã€‚</li><li><strong>disableResume</strong>ï¼šå¦‚æœæ§åˆ¶å™¨é‡å¯ï¼Œç¦æ­¢æµæ°´çº¿è‡ªåŠ¨æ¢å¤ã€‚</li><li><strong>newContainerPerStage</strong>ï¼šagent ä¸º docker æˆ– dockerfile æ—¶ï¼Œæ¯ä¸ªé˜¶æ®µå°†åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹çš„æ–°å®¹å™¨ä¸­è¿è¡Œï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„é˜¶æ®µéƒ½åœ¨åŒä¸€ä¸ªå®¹å™¨ä¸­è¿è¡Œã€‚</li><li><strong>quietPeriod</strong>ï¼šæµæ°´çº¿é™é»˜æœŸï¼Œä¹Ÿå°±æ˜¯è§¦å‘æµæ°´çº¿åç­‰å¾…ä¸€ä¼šåœ¨æ‰§è¡Œã€‚</li><li><strong>retry</strong>ï¼šæµæ°´çº¿å¤±è´¥åé‡è¯•æ¬¡æ•°ã€‚</li><li><strong>timeout</strong>ï¼šè®¾ç½®æµæ°´çº¿çš„è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡æµæ°´çº¿æ—¶é—´ï¼Œjob ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚å¦‚æœä¸åŠ  unit å‚æ•°é»˜è®¤ä¸º 1 åˆ†ã€‚</li><li><strong>timestamps</strong>ï¼šä¸ºæ§åˆ¶å°è¾“å‡ºæ—¶é—´æˆ³ã€‚</li></ul><p><strong>å®šä¹‰åœ¨ pipeline ä¸­</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
  agent any
  options {
    timeout(time: 1, unit: &#39;HOURS&#39;)  //è¶…æ—¶æ—¶é—´1å°æ—¶ï¼Œå¦‚æœä¸åŠ unitå‚æ•°é»˜è®¤ä¸º1åˆ†
    timestamps()                     //æ‰€æœ‰è¾“å‡ºæ¯è¡Œéƒ½ä¼šæ‰“å°æ—¶é—´æˆ³
    buildDiscarder(logRotator(numToKeepStr: &#39;3&#39;)) //ä¿ç•™ä¸‰ä¸ªå†å²æ„å»ºç‰ˆæœ¬
    quietPeriod(10)  //æ³¨æ„æ‰‹åŠ¨è§¦å‘çš„æ„å»ºä¸ç”Ÿæ•ˆ
    retry(3)    //æµæ°´çº¿å¤±è´¥åé‡è¯•æ¬¡æ•°
  }
  stages {
    stage(&#39;env1&#39;) {
      steps {
        sh &quot;env&quot;
        sleep 2
      }
    }
    stage(&#39;env2&#39;) {
      steps {
        sh &quot;env&quot;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å®šä¹‰åœ¨ stage ä¸­</strong></p><p>Option é™¤äº†å†™åœ¨ Pipeline é¡¶å±‚ï¼Œè¿˜å¯ä»¥å†™åœ¨ stage ä¸­ï¼Œä½†æ˜¯å†™åœ¨ stage ä¸­çš„ option ä»…æ”¯æŒ <code>retryã€ timeoutã€timestamps</code>ï¼Œ æˆ–è€…æ˜¯å’Œ stage ç›¸å…³çš„å£°æ˜å¼é€‰é¡¹ï¼Œæ¯”å¦‚ <code>skipDefaultCheckout</code>ã€‚</p><p>å¤„äº stage çº§åˆ«çš„ options å†™æ³•å¦‚ä¸‹</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
  agent any
  stages {
    stage(&#39;env1&#39;) {
      options {   //å®šä¹‰åœ¨è¿™é‡Œè¿™å¯¹è¿™ä¸ªstageç”Ÿæ•ˆ
        timeout(time: 2, unit: &#39;SECONDS&#39;) //è¶…æ—¶æ—¶é—´2ç§’
        timestamps()                     //æ‰€æœ‰è¾“å‡ºæ¯è¡Œéƒ½ä¼šæ‰“å°æ—¶é—´æˆ³
        retry(3)    //æµæ°´çº¿å¤±è´¥åé‡è¯•æ¬¡æ•°
      }
      steps {
        sh &quot;env &amp;&amp; sleep 2&quot;
      }
    }
    stage(&#39;env2&#39;) {
      steps {
        sh &quot;env&quot;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.Parameters</p><p>Parameters æä¾›äº†ä¸€ä¸ªç”¨æˆ·åœ¨è§¦å‘æµæ°´çº¿æ—¶åº”è¯¥æä¾›çš„å‚æ•°åˆ—è¡¨ï¼Œè¿™äº›ç”¨æˆ·æŒ‡å®šå‚æ•°çš„å€¼å¯ä»¥é€šè¿‡ params å¯¹è±¡æä¾›ç»™æµæ°´çº¿çš„ stepï¼ˆæ­¥éª¤ï¼‰ã€‚ åªèƒ½å®šä¹‰åœ¨ pipeline é¡¶å±‚ã€‚</p><p><strong>ç›®å‰æ”¯æŒçš„å‚æ•°ç±»å‹å¦‚ä¸‹</strong></p><ul><li><strong>string</strong>ï¼šå­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°ã€‚</li><li><strong>text</strong>ï¼šæ–‡æœ¬å‹å‚æ•°ï¼Œä¸€èˆ¬ç”¨äºå®šä¹‰å¤šè¡Œæ–‡æœ¬å†…å®¹çš„å˜é‡ã€‚</li><li><strong>booleanParam</strong>ï¼šå¸ƒå°”å‹å‚æ•°ã€‚</li><li><strong>choice</strong>ï¼šé€‰æ‹©å‹å‚æ•°ï¼Œä¸€èˆ¬ç”¨äºç»™å®šå‡ ä¸ªå¯é€‰çš„å€¼ï¼Œç„¶åé€‰æ‹©å…¶ä¸­ä¸€ä¸ªè¿›è¡Œèµ‹å€¼ã€‚</li><li><strong>password</strong>ï¼šå¯†ç å‹å˜é‡ï¼Œä¸€èˆ¬ç”¨äºå®šä¹‰æ•æ„Ÿå‹å˜é‡ï¼Œåœ¨ Jenkins æ§åˆ¶å°ä¼šè¾“å‡ºä¸º <code>*</code> ã€‚</li></ul><p><strong>æ’ä»¶ Parameters</strong></p><ul><li><strong>imageTag</strong>ï¼šé•œåƒ tagï¼Œéœ€è¦å®‰è£… <code>Image Tag Parameter</code> æ’ä»¶åä½¿ç”¨</li><li><strong>gitParameter</strong>ï¼šè·å– git ä»“åº“åˆ†æ”¯ï¼Œéœ€è¦ <code>Git Parameter</code> æ’ä»¶åä½¿ç”¨</li></ul><p>ç¤ºä¾‹</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
  agent any
  parameters {
    string(name: &#39;DEPLOY_ENV&#39;, defaultValue:  &#39;staging&#39;, description: &#39;1&#39;)   //æ‰§è¡Œæ„å»ºæ—¶éœ€è¦æ‰‹åŠ¨é…ç½®å­—ç¬¦ä¸²ç±»å‹å‚æ•°ï¼Œä¹‹åèµ‹å€¼ç»™å˜é‡
    text(name:  &#39;DEPLOY_TEXT&#39;, defaultValue: &#39;One\nTwo\nThree\n&#39;, description: &#39;2&#39;)  //æ‰§è¡Œæ„å»ºæ—¶éœ€è¦æä¾›æ–‡æœ¬å‚æ•°ï¼Œä¹‹åèµ‹å€¼ç»™å˜é‡
    booleanParam(name: &#39;DEBUG_BUILD&#39;,  defaultValue: true, description: &#39;3&#39;)   //å¸ƒå°”å‹å‚æ•°
    choice(name: &#39;CHOICES&#39;, choices: [&#39;one&#39;, &#39;two&#39;, &#39;three&#39;], description: &#39;4&#39;)  //é€‰æ‹©å½¢å¼åˆ—è¡¨å‚æ•°
    password(name: &#39;PASSWORD&#39;, defaultValue: &#39;SECRET&#39;, description: &#39;A  secret password&#39;)  //å¯†ç ç±»å‹å‚æ•°ï¼Œä¼šè¿›è¡ŒåŠ å¯†
    imageTag(name: &#39;DOCKER_IMAGE&#39;, description: &#39;&#39;, image: &#39;kubernetes/kubectl&#39;, filter: &#39;.*&#39;, defaultTag: &#39;&#39;, registry: &#39;https://192.168.10.15&#39;, credentialId: &#39;harbor-account&#39;, tagOrder: &#39;NATURAL&#39;)   //è·å–é•œåƒåç§°ä¸tag
    gitParameter(branch: &#39;&#39;, branchFilter: &#39;origin/(.*)&#39;, defaultValue: &#39;&#39;, description: &#39;Branch for build and deploy&#39;, name: &#39;BRANCH&#39;, quickFilterEnabled: false, selectedValue: &#39;NONE&#39;, sortMode: &#39;NONE&#39;,  tagFilter: &#39;*&#39;, type: &#39;PT_BRANCH&#39;)
  }  //è·å–gitä»“åº“åˆ†æ”¯åˆ—è¡¨ï¼Œå¿…é¡»æœ‰gitå¼•ç”¨
  stages {
    stage(&#39;env1&#39;) {
      steps {
        sh &quot;env&quot;
      }
    }
    stage(&#39;git&#39;) {
      steps {
        git branch: &quot;$BRANCH&quot;, credentialsId: &#39;gitlab-key&#39;, url: &#39;git@192.168.10.14:root/env.git&#39;   //ä½¿ç”¨gitParameterï¼Œå¿…é¡»æœ‰è¿™ä¸ª
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4.Triggers</p><p>åœ¨ Pipeline ä¸­å¯ä»¥ç”¨ triggers å®ç°è‡ªåŠ¨è§¦å‘æµæ°´çº¿æ‰§è¡Œä»»åŠ¡ï¼Œå¯ä»¥é€šè¿‡ <code>Webhookã€Cronã€ pollSCM</code> å’Œ <code>upstream</code> ç­‰æ–¹å¼è§¦å‘æµæ°´çº¿ã€‚</p><p><strong>Cron</strong></p><p>å®šæ—¶æ„å»ºå‡å¦‚æŸä¸ªæµæ°´çº¿æ„å»ºçš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæˆ–è€…æŸä¸ªæµæ°´çº¿éœ€è¦å®šæœŸåœ¨æŸä¸ªæ—¶é—´æ®µæ‰§è¡Œæ„å»ºï¼Œå¯ä»¥ ä½¿ç”¨ cron é…ç½®è§¦å‘å™¨ï¼Œæ¯”å¦‚å‘¨ä¸€åˆ°å‘¨äº”æ¯éš”å››ä¸ªå°æ—¶æ‰§è¡Œä¸€æ¬¡</p><p>æ³¨æ„ï¼šH çš„æ„æ€ä¸æ˜¯ HOURS çš„æ„æ€ï¼Œè€Œæ˜¯ Hash çš„ç¼©å†™ã€‚ä¸»è¦ä¸ºäº†è§£å†³å¤šä¸ªæµæ°´çº¿åœ¨åŒä¸€æ—¶é—´åŒæ—¶è¿è¡Œå¸¦æ¥çš„ç³»ç»Ÿè´Ÿè½½å‹åŠ›ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
  agent any
  triggers {
    cron(&#39;H */4 * * 1-5&#39;)   //å‘¨ä¸€åˆ°å‘¨äº”æ¯éš”å››ä¸ªå°æ—¶æ‰§è¡Œä¸€æ¬¡
    cron(&#39;H/12 * * * *&#39;)   //æ¯éš”12åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    cron(&#39;H * * * *&#39;)   //æ¯éš”1å°æ—¶æ‰§è¡Œä¸€æ¬¡
  }
  stages {
    stage(&#39;Example&#39;) {
      steps {
        echo &#39;Hello World&#39;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Upstream</strong></p><p>Upstream å¯ä»¥æ ¹æ®ä¸Šæ¸¸ job çš„æ‰§è¡Œç»“æœå†³å®šæ˜¯å¦è§¦å‘è¯¥æµæ°´çº¿ã€‚æ¯”å¦‚å½“ job1 æˆ– job2 æ‰§è¡ŒæˆåŠŸæ—¶è§¦å‘è¯¥æµæ°´çº¿</p><p>ç›®å‰æ”¯æŒçš„çŠ¶æ€æœ‰ <code>SUCCESS</code>ã€<code>UNSTABLE</code>ã€<code>FAILURE</code>ã€<code>NOT_BUILT</code>ã€<code>ABORTED</code>ç­‰ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
  agent any
  triggers {
    upstream(upstreamProjects: &#39;env&#39;, threshold: hudson.model.Result.SUCCESS)  //å½“envæ„å»ºæˆåŠŸæ—¶æ„å»ºè¿™ä¸ªæµæ°´çº¿
  }
  stages {
    stage(&#39;Example&#39;) {
      steps {
        echo &#39;Hello World&#39;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>5.Input</p><p>Input å­—æ®µå¯ä»¥å®ç°åœ¨æµæ°´çº¿ä¸­è¿›è¡Œäº¤äº’å¼æ“ä½œï¼Œæ¯”å¦‚é€‰æ‹©è¦éƒ¨ç½²çš„ç¯å¢ƒã€æ˜¯å¦ç»§ç»­æ‰§è¡ŒæŸä¸ªé˜¶æ®µç­‰ã€‚</p><p>é…ç½® Input æ”¯æŒä»¥ä¸‹é€‰é¡¹</p><ul><li><strong>message</strong>ï¼šå¿…é€‰ï¼Œéœ€è¦ç”¨æˆ·è¿›è¡Œ input çš„æç¤ºä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šâ€œæ˜¯å¦å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Ÿâ€ï¼›</li><li><strong>id</strong>ï¼šå¯é€‰ï¼Œinput çš„æ ‡è¯†ç¬¦ï¼Œé»˜è®¤ä¸º stage çš„åç§°ï¼›</li><li><strong>ok</strong>ï¼šå¯é€‰ï¼Œç¡®è®¤æŒ‰é’®çš„æ˜¾ç¤ºä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šâ€œç¡®å®šâ€ã€â€œå…è®¸â€ï¼›</li><li><strong>submitter</strong>ï¼šå¯é€‰ï¼Œå…è®¸æäº¤ input æ“ä½œçš„ç”¨æˆ·æˆ–ç»„çš„åç§°ï¼Œå¦‚æœä¸ºç©ºï¼Œä»»ä½•ç™»å½•ç”¨æˆ·å‡å¯æäº¤ inputï¼›</li><li><strong>parameters</strong>ï¼šæä¾›ä¸€ä¸ªå‚æ•°åˆ—è¡¨ä¾› input ä½¿ç”¨ã€‚</li></ul><p>å‡å¦‚éœ€è¦é…ç½®ä¸€ä¸ªæç¤ºæ¶ˆæ¯ä¸ºâ€œè¿˜ç»§ç»­ä¹ˆâ€ã€ç¡®è®¤æŒ‰é’®ä¸ºâ€œç»§ç»­â€ã€æä¾›ä¸€ä¸ª PERSON çš„å˜é‡çš„å‚æ•°ï¼Œå¹¶ä¸”åªèƒ½ç”±ç™»å½•ç”¨æˆ·ä¸º alice å’Œ bob æäº¤çš„ input æµæ°´çº¿</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
  agent any
  stages {
    stage(&#39;Example&#39;) {
      input {
        message &quot;è¿˜ç»§ç»­ä¹ˆ?&quot;
        ok &quot;ç»§ç»­&quot;
        submitter &quot;alice,bob&quot;
        parameters {
          string(name: &#39;PERSON&#39;, defaultValue: &#39;Mr Jenkins&#39;, description: &#39;Who should I say hello to?&#39;)
        }
      }
      steps {
        echo &quot;Hello, ${PERSON}, nice to meet you.&quot;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>6.when</p><p>When æŒ‡ä»¤å…è®¸æµæ°´çº¿æ ¹æ®ç»™å®šçš„æ¡ä»¶å†³å®šæ˜¯å¦åº”è¯¥æ‰§è¡Œè¯¥ stageï¼Œwhen æŒ‡ä»¤å¿…é¡»åŒ…å«è‡³å°‘ ä¸€ä¸ªæ¡ä»¶ã€‚ å¦‚æœ when åŒ…å«å¤šä¸ªæ¡ä»¶ï¼Œæ‰€æœ‰çš„å­æ¡ä»¶å¿…é¡»éƒ½è¿”å› Trueï¼Œstage æ‰èƒ½æ‰§è¡Œã€‚</p><p>When ä¹Ÿå¯ä»¥ç»“åˆ <code>notã€allOfã€anyOf</code> è¯­æ³•è¾¾åˆ°æ›´çµæ´»çš„æ¡ä»¶åŒ¹é…ã€‚</p><p><strong>ç›®å‰æ¯”è¾ƒå¸¸ç”¨çš„å†…ç½®æ¡ä»¶å¦‚ä¸‹</strong></p><ul><li><strong>branch</strong>ï¼šå½“æ­£åœ¨æ„å»ºçš„åˆ†æ”¯ä¸ç»™å®šçš„åˆ†æ”¯åŒ¹é…æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ª stageã€‚æ³¨æ„ï¼Œbranch åªé€‚ç”¨äºå¤šåˆ†æ”¯æµæ°´çº¿</li><li><strong>changelog</strong>ï¼šåŒ¹é…æäº¤çš„ changeLog å†³å®šæ˜¯å¦æ„å»ºï¼Œä¾‹å¦‚: <code>when { changelog &#39;.*^\\[DEPENDENCY\\] .+$&#39; }</code></li><li><strong>environment</strong>ï¼šå½“æŒ‡å®šçš„ç¯å¢ƒå˜é‡å’Œç»™å®šçš„å˜é‡åŒ¹é…æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ª stageï¼Œä¾‹å¦‚ï¼š<code>when { environment name: &#39;DEPLOY_TO&#39;, value: &#39;production&#39; }</code></li><li><strong>equals</strong>ï¼šå½“æœŸæœ›å€¼å’Œå®é™…å€¼ç›¸åŒæ—¶ï¼Œæ‰§è¡Œè¿™ä¸ª stageï¼Œä¾‹å¦‚ï¼š<code>when { equals expected: 2, actual: currentBuild.number }ï¼›</code></li><li><strong>expression</strong>ï¼šå½“æŒ‡å®šçš„ Groovy è¡¨è¾¾å¼è¯„ä¼°ä¸º Trueï¼Œæ‰§è¡Œè¿™ä¸ª stageï¼Œä¾‹å¦‚ï¼š<code>when { expression { return params.DEBUG_BUILD } }ï¼›</code></li><li><strong>tag</strong>ï¼šå¦‚æœ TAG_NAME çš„å€¼å’Œç»™å®šçš„æ¡ä»¶åŒ¹é…ï¼Œæ‰§è¡Œè¿™ä¸ª stageï¼Œä¾‹å¦‚ï¼š<code>when { tag &quot;release-&quot; }ï¼›</code></li><li><strong>not</strong>ï¼šå½“åµŒå¥—æ¡ä»¶å‡ºç°é”™è¯¯æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ª stageï¼Œå¿…é¡»åŒ…å«ä¸€ä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚ï¼š<code>when { not { branch &#39;master&#39; } }ï¼›</code></li><li><strong>allOf</strong>ï¼šå½“æ‰€æœ‰çš„åµŒå¥—æ¡ä»¶éƒ½æ­£ç¡®æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ª stageï¼Œå¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚ï¼š<code>when { allOf { branch &#39;master&#39;; environment name: &#39;DEPLOY_TO&#39;, value: &#39;production&#39; } }ï¼›</code></li><li><strong>anyOf</strong>ï¼šå½“è‡³å°‘æœ‰ä¸€ä¸ªåµŒå¥—æ¡ä»¶ä¸º True æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ª stageï¼Œä¾‹å¦‚ï¼š<code>when { anyOf { branch &#39;master&#39;; branch &#39;staging&#39; } })</code>ã€‚</li></ul><p>ç¤ºä¾‹ï¼šå½“åˆ†æ”¯ä¸º main æ—¶æ‰§è¡Œ Example Deploy æ­¥éª¤</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
  agent any
  stages {
    stage(&#39;Example Build&#39;) {
      steps {
        echo &#39;Hello World&#39;
      }
    }
    stage(&#39;Example Deploy&#39;) {
      when {
        branch &#39;main&#39; //å¤šåˆ†æ”¯æµæ°´çº¿ï¼Œåˆ†æ”¯ä¸ºæ‰ä¼šæ‰§è¡Œã€‚
      }
      steps {
        echo &#39;Deploying&#39;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå¯ä»¥åŒæ—¶é…ç½®å¤šä¸ªæ¡ä»¶ï¼Œæ¯”å¦‚åˆ†æ”¯æ˜¯ productionï¼Œè€Œä¸” <code>DEPLOY_TO</code> å˜é‡çš„å€¼ä¸º main æ—¶ï¼Œæ‰æ‰§è¡Œ <code>Example Deploy</code></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
  agent any
  environment {
    DEPLOY_TO = &quot;main&quot;
  }
  stages {
    stage(&#39;Example Deploy&#39;) {
      when {
        branch &#39;main&#39;
        environment name: &#39;DEPLOY_TO&#39;, value: &#39;main&#39;
      }
      steps {
        echo &#39;Deploying&#39;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>anyOf</code> è¿›è¡ŒåŒ¹é…å…¶ä¸­ä¸€ä¸ªæ¡ä»¶å³å¯ï¼Œæ¯”å¦‚åˆ†æ”¯ä¸º main æˆ– <code>DEPLOY_TO</code> ä¸º main æˆ– master æ—¶æ‰§è¡Œ Deploy</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
  agent any
  stages {
    stage(&#39;Example Deploy&#39;) {
      when {
        anyOf {
          branch &#39;main&#39;
          environment name: &#39;DEPLOY_TO&#39;, value: &#39;main&#39;
          environment name: &#39;DEPLOY_TO&#39;, value: &#39;master&#39;
        }
      }
      steps {
        echo &#39;Deploying&#39;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>expression</code> è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œæ¯”å¦‚å½“ <code>BRANCH_NAME</code> ä¸º main æˆ– masterï¼Œå¹¶ä¸” <code>DEPLOY_TO</code> ä¸º master æˆ– main æ—¶æ‰ä¼šæ‰§è¡Œ <code>Example Deploy</code></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
  agent any
  stages {
    stage(&#39;Example Deploy&#39;) {
      when {
        expression { BRANCH_NAME ==~ /(main|master)/ }
        anyOf {
          environment name: &#39;DEPLOY_TO&#39;, value: &#39;main&#39;
          environment name: &#39;DEPLOY_TO&#39;, value: &#39;master&#39;
        }
      }
      steps {
        echo &#39;Deploying&#39;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå®šä¹‰äº†æŸä¸ª stage çš„ agentï¼Œåœ¨è¿›å…¥è¯¥ stage çš„ agent åï¼Œ è¯¥ stage çš„ when æ¡ä»¶æ‰ä¼šè¢«è¯„ä¼°ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä¸€äº›é€‰é¡¹æ›´æ”¹æ­¤é€‰é¡¹ã€‚</p><p>æ¯”å¦‚åœ¨è¿›å…¥ stage çš„ agent å‰è¯„ä¼° whenï¼Œ å¯ä»¥ä½¿ç”¨ beforeAgentï¼Œ å½“ when ä¸º true æ—¶æ‰è¿›è¡Œè¯¥ stage</p><p><strong>ç›®å‰æ”¯æŒçš„å‰ç½®æ¡ä»¶å¦‚ä¸‹</strong></p><ul><li><strong>beforeAgent</strong>ï¼šå¦‚æœ beforeAgent ä¸º trueï¼Œåˆ™ä¼šå…ˆè¯„ä¼° when æ¡ä»¶ã€‚åœ¨ when æ¡ä»¶ä¸º true æ—¶ï¼Œæ‰ä¼šè¿›å…¥è¯¥ stage</li><li><strong>beforeInput</strong>ï¼šå¦‚æœ beforeInput ä¸º trueï¼Œåˆ™ä¼šå…ˆè¯„ä¼° when æ¡ä»¶ã€‚åœ¨ when æ¡ä»¶ä¸º true æ—¶ï¼Œæ‰ä¼šè¿›å…¥åˆ° input é˜¶æ®µï¼›</li><li><strong>beforeOptions</strong>ï¼šå¦‚æœ beforeInput ä¸º trueï¼Œåˆ™ä¼šå…ˆè¯„ä¼° when æ¡ä»¶ã€‚åœ¨ when æ¡ä»¶ä¸º true æ—¶ï¼Œæ‰ä¼šè¿›å…¥åˆ° options é˜¶æ®µï¼›</li></ul><p><code>beforeOptions</code> ä¼˜å…ˆçº§å¤§äº <code>beforeInput</code> å¤§äº <code>beforeAgent</code></p><p>ç¤ºä¾‹</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
  agent none
  stages {
    stage(&#39;Example Build&#39;) {
      steps {
        echo &#39;Hello World&#39;
      }
    }
    stage(&#39;Example Deploy&#39;) {
      when {
        beforeAgent true
        branch &#39;main&#39;
      }
      steps {
        echo &#39;Deploying&#39;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="parallel-å¹¶å‘æ„å»º" tabindex="-1"><a class="header-anchor" href="#parallel-å¹¶å‘æ„å»º" aria-hidden="true">#</a> Parallel å¹¶å‘æ„å»º</h4><p>åœ¨å£°æ˜å¼æµæ°´çº¿ä¸­å¯ä»¥ä½¿ç”¨ Parallel å­—æ®µï¼Œå³å¯å¾ˆæ–¹ä¾¿çš„å®ç°å¹¶å‘æ„å»ºï¼Œæ¯”å¦‚å¯¹åˆ†æ”¯ <code>Aã€Bã€C</code> è¿›è¡Œå¹¶è¡Œå¤„ç†</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
  agent any
  stages {
    stage(&#39;Non-Parallel Stage&#39;) {
      steps {
        echo &#39;This stage will be executed first.&#39;
      }
    }
    stage(&#39;Parallel Stage&#39;) {
      failFast true         //è¡¨ç¤ºå…¶ä¸­åªè¦æœ‰ä¸€ä¸ªåˆ†æ”¯æ„å»ºæ‰§è¡Œå¤±è´¥ï¼Œå°±ç›´æ¥æ¨å‡ºä¸ç­‰å¾…å…¶ä»–åˆ†æ”¯æ„å»º
      parallel {
        stage(&#39;Branch A&#39;) {
          steps {
            echo &quot;On Branch A&quot;
          }
        }
        stage(&#39;Branch B&#39;) {
          steps {
            echo &quot;On Branch B&quot;
          }
        }
        stage(&#39;Branch C&#39;) {
          stages {
            stage(&#39;Nested 1&#39;) {
              steps {
                echo &quot;In stage Nested 1 within Branch C&quot;
              }
            }
            stage(&#39;Nested 2&#39;) {
              steps {
               echo &quot;In stage Nested 2 within Branch C&quot;
              }
            }
          }
        }
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="jenkinsfile-çš„ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#jenkinsfile-çš„ä½¿ç”¨" aria-hidden="true">#</a> Jenkinsfile çš„ä½¿ç”¨</h3><p>ä¸Šé¢è®²è¿‡æµæ°´çº¿æ”¯æŒä¸¤ç§è¯­æ³•ï¼Œå³å£°æ˜å¼å’Œè„šæœ¬å¼ï¼Œè¿™ä¸¤ç§è¯­æ³•éƒ½æ”¯æŒæ„å»ºæŒç»­äº¤ä»˜æµæ°´çº¿ã€‚ å¹¶ä¸”éƒ½å¯ä»¥ç”¨æ¥åœ¨ <code>Web UI</code> æˆ– <code>Jenkinsfile</code> ä¸­å®šä¹‰æµæ°´çº¿ï¼Œä¸è¿‡é€šå¸¸å°† <code>Jenkinsfile</code> æ”¾ç½®äºä»£ç ä»“åº“ä¸­ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æ”¾åœ¨å•ç‹¬çš„ä»£ç ä»“åº“ä¸­è¿›è¡Œç®¡ç†ï¼‰ã€‚</p><p>åˆ›å»ºä¸€ä¸ª Jenkinsfile å¹¶å°†å…¶æ”¾ç½®äºä»£ç ä»“åº“ä¸­ï¼Œæœ‰ä»¥ä¸‹å¥½å¤„</p><ul><li>æ–¹ä¾¿å¯¹æµæ°´çº¿ä¸Šçš„ä»£ç è¿›è¡Œå¤æŸ¥/è¿­ä»£</li><li>å¯¹ç®¡é“è¿›è¡Œå®¡è®¡è·Ÿè¸ª</li><li>æµæ°´çº¿çœŸæ­£çš„æºä»£ç èƒ½å¤Ÿè¢«é¡¹ç›®çš„å¤šä¸ªæˆå‘˜æŸ¥çœ‹å’Œç¼–è¾‘</li></ul><h4 id="ç¯å¢ƒå˜é‡" tabindex="-1"><a class="header-anchor" href="#ç¯å¢ƒå˜é‡" aria-hidden="true">#</a> ç¯å¢ƒå˜é‡</h4><p>1.é™æ€å˜é‡</p><p>Jenkins æœ‰è®¸å¤šå†…ç½®å˜é‡å¯ä»¥ç›´æ¥åœ¨ Jenkinsfile ä¸­ä½¿ç”¨ï¼Œå¯ä»¥é€šè¿‡ <code>JENKINS_URL/pipeline/syntax/globals#env</code> è·å–å®Œæ•´åˆ—è¡¨ã€‚</p><p><strong>ç›®å‰æ¯”è¾ƒå¸¸ç”¨çš„ç¯å¢ƒå˜é‡å¦‚ä¸‹</strong></p><ul><li><strong>BUILD_ID</strong>ï¼šå½“å‰æ„å»ºçš„ IDï¼Œä¸ Jenkins ç‰ˆæœ¬ 1.597+ ä¸­çš„ BUILD_NUMBER å®Œå…¨ç›¸åŒ</li><li><strong>BUILD_NUMBER</strong>ï¼šå½“å‰æ„å»ºçš„ IDï¼Œå’Œ BUILD_ID ä¸€è‡´</li><li><strong>BUILD_TAG</strong>ï¼šç”¨æ¥æ ‡è¯†æ„å»ºçš„ç‰ˆæœ¬å·ï¼Œæ ¼å¼ä¸ºï¼šjenkins-{BUILD_NUMBER}ï¼Œ å¯ä»¥å¯¹äº§ç‰©è¿›è¡Œå‘½åï¼Œæ¯”å¦‚ç”Ÿäº§çš„ jar åŒ…åå­—ã€é•œåƒçš„ TAG ç­‰ï¼›</li><li><strong>BUILD_URL</strong>ï¼šæœ¬æ¬¡æ„å»ºçš„å®Œæ•´ URLï¼Œæ¯”å¦‚ï¼š<code>http://buildserver/jenkins/job/MyJobName/17/%EF%BC%9B</code></li><li><strong>JOB_NAME</strong>ï¼šæœ¬æ¬¡æ„å»ºçš„é¡¹ç›®åç§°</li><li><strong>NODE_NAME</strong>ï¼šå½“å‰æ„å»ºèŠ‚ç‚¹çš„åç§°ï¼›</li><li><strong>JENKINS_URL</strong>ï¼šJenkins å®Œæ•´çš„ URLï¼Œéœ€è¦åœ¨ <code>SystemConfiguration</code> è®¾ç½®ï¼›</li><li><strong>WORKSPACE</strong>ï¼šæ‰§è¡Œæ„å»ºçš„å·¥ä½œç›®å½•ã€‚</li></ul><p>ç¤ºä¾‹å¦‚æœä¸€ä¸ªæµæ°´çº¿åç§°ä¸º <code>print_env</code>ï¼Œç¬¬ 2 æ¬¡æ„å»ºï¼Œå„ä¸ªå˜é‡çš„å€¼ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>BUILD_IDï¼š2
BUILD_NUMBERï¼š2
BUILD_TAGï¼šjenkins-print_env-2
BUILD_URLï¼šhttp://192.168.10.16:8080/job/print_env/2/
JOB_NAMEï¼šprint_env
NODE_NAMEï¼šbuilt-in
JENKINS_URLï¼šhttp://192.168.10.16:8080/
WORKSPACEï¼š/bitnami/jenkins/home/workspace/print_env
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°å˜é‡ä¼šä¿å­˜åœ¨ä¸€ä¸ª Map ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>env.BUILD_ID</code> æˆ– <code>env.JENKINS_URL</code> å¼•ç”¨æŸä¸ªå†…ç½®å˜é‡</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
  agent any
  stages {
    stage(&#39;print env&#39;) {
      parallel {
        stage(&#39;BUILD_ID&#39;) {
          steps {
            echo &quot;$env.BUILD_ID&quot;
          }
        }
        stage(&#39;BUILD_NUMBER&#39;) {
          steps {
            echo &quot;$env.BUILD_NUMBER&quot;
          }
        }
        stage(&#39;BUILD_TAG&#39;) {
          steps {
            echo &quot;$env.BUILD_TAG&quot;
          }
        }
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.åŠ¨æ€å˜é‡</p><p>åŠ¨æ€å˜é‡æ˜¯æ ¹æ®æŸä¸ªæŒ‡ä»¤çš„ç»“æœè¿›è¡ŒåŠ¨æ€èµ‹å€¼ï¼Œå˜é‡çš„å€¼æ ¹æ®æŒ‡ä»¤çš„æ‰§è¡Œç»“æœè€Œä¸åŒã€‚å¦‚ä¸‹æ‰€ç¤º</p><ul><li><strong>returnStdout</strong>ï¼šå°†å‘½ä»¤çš„æ‰§è¡Œç»“æœèµ‹å€¼ç»™å˜é‡ï¼Œæ¯”å¦‚ä¸‹è¿°çš„å‘½ä»¤è¿”å›çš„æ˜¯ clangï¼Œæ­¤æ—¶ CC çš„å€¼ä¸ºâ€œclangâ€ã€‚</li><li><strong>returnStatus</strong>ï¼šå°†å‘½ä»¤çš„æ‰§è¡ŒçŠ¶æ€èµ‹å€¼ç»™å˜é‡ï¼Œæ¯”å¦‚ä¸‹è¿°å‘½ä»¤çš„æ‰§è¡ŒçŠ¶æ€ä¸º 1ï¼Œæ­¤æ—¶ <code>EXIT_STATUS</code> çš„å€¼ä¸º 1ã€‚</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//Jenkinsfile (Declarative Pipeline)
pipeline {
  agent any
  environment {
    // ä½¿ç”¨ returnStdout
    CC = &quot;&quot;&quot;${sh(
         returnStdout: true,
         script: &#39;echo -n &quot;clang&quot;&#39;   //å¦‚æœä½¿ç”¨shellå‘½ä»¤çš„echoèµ‹å€¼å˜é‡æœ€å¥½åŠ -nå–æ¶ˆæ¢è¡Œ
         )}&quot;&quot;&quot;
    // ä½¿ç”¨ returnStatus
    EXIT_STATUS = &quot;&quot;&quot;${sh(
         returnStatus: true,
         script: &#39;exit 1&#39;
         )}&quot;&quot;&quot;
  }
  stages {
    stage(&#39;Example&#39;) {
      environment {
        DEBUG_FLAGS = &#39;-g&#39;
      }
      steps {
        sh &#39;printenv&#39;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å‡­è¯ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#å‡­è¯ç®¡ç†" aria-hidden="true">#</a> å‡­è¯ç®¡ç†</h4><p>Jenkins çš„å£°æ˜å¼æµæ°´çº¿è¯­æ³•æœ‰ä¸€ä¸ª <code>credentials()</code>å‡½æ•°ï¼Œå®ƒæ”¯æŒ <code>secret textï¼ˆåŠ å¯†æ–‡æœ¬ï¼‰</code>ã€<code>username</code> å’Œ <code>passwordï¼ˆç”¨æˆ·åå’Œå¯†ç ï¼‰</code>ä»¥åŠ <code>secret fileï¼ˆåŠ å¯†æ–‡ä»¶ï¼‰</code>ç­‰ã€‚</p><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ä¸€äº›å¸¸ç”¨çš„å‡­è¯å¤„ç†æ–¹æ³•ã€‚</p><p>1.åŠ å¯†æ–‡æœ¬</p><p>æœ¬å®ä¾‹æ¼”ç¤ºå°†ä¸¤ä¸ª Secret æ–‡æœ¬å‡­è¯åˆ†é…ç»™å•ç‹¬çš„ç¯å¢ƒå˜é‡æ¥è®¿é—® <code>Amazon Web</code> æœåŠ¡ï¼Œéœ€è¦æå‰åˆ›å»ºè¿™ä¸¤ä¸ªæ–‡ä»¶çš„ <code>credentialsï¼ˆå®è·µçš„ç« èŠ‚ä¼šæœ‰æ¼”ç¤ºï¼‰</code>ï¼Œ <code>Jenkinsfile</code> æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//Jenkinsfile (Declarative Pipeline)
pipeline {
  agent any
  environment {
    AWS_ACCESS_KEY_ID = credentials(&#39;txt1&#39;)
    AWS_SECRET_ACCESS_KEY = credentials(&#39;txt2&#39;)
  }
  stages {
    stage(&#39;Example stage 1&#39;) {
      steps {
        echo &quot;$AWS_ACCESS_KEY_ID&quot;
      }
    }
    stage(&#39;Example stage 2&#39;) {
      steps {
        echo &quot;$AWS_SECRET_ACCESS_KEY&quot;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.ç”¨æˆ·åå¯†ç </p><p>æœ¬ç¤ºä¾‹ç”¨æ¥æ¼”ç¤º credentials è´¦å·å¯†ç çš„ä½¿ç”¨ï¼Œæ¯”å¦‚ä½¿ç”¨ä¸€ä¸ªå…¬ç”¨è´¦æˆ·è®¿é—® <code>Bitbucket</code>ã€<code>GitLab</code>ã€ <code>Harbor</code> ç­‰ã€‚</p><p>å‡è®¾å·²ç»é…ç½®å®Œæˆäº†ç”¨æˆ·åå¯†ç å½¢å¼çš„ credentialsï¼Œå‡­è¯ ID ä¸º <code>harbor-account</code></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//Jenkinsfile (Declarative Pipeline)
pipeline {
  agent any
  environment {
    BITBUCKET_COMMON_CREDS = credentials(&#39;harbor-account&#39;)
  }
  stages {
    stage(&#39;printenv&#39;) {
      steps {
        sh &quot;env&quot;
      }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¸Šè¿°çš„é…ç½®ä¼šè‡ªåŠ¨ç”Ÿæˆ 3 ä¸ªç¯å¢ƒå˜é‡</strong></p><ul><li><strong>BITBUCKET_COMMON_CREDS</strong>ï¼šåŒ…å«ä¸€ä¸ªä»¥å†’å·åˆ†éš”çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ ¼å¼ä¸º <code>username:password</code></li><li><strong>BITBUCKET_COMMON_CREDS_USR</strong>ï¼šä»…åŒ…å«ç”¨æˆ·åçš„é™„åŠ å˜é‡</li><li><strong>BITBUCKET_COMMON_CREDS_PSW</strong>ï¼šä»…åŒ…å«å¯†ç çš„é™„åŠ å˜é‡ã€‚</li></ul><p>3.åŠ å¯†æ–‡ä»¶</p><p>éœ€è¦åŠ å¯†ä¿å­˜çš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ credentialï¼Œæ¯”å¦‚é“¾æ¥åˆ° Kubernetes é›†ç¾¤çš„ <code>kubeconfig</code> æ–‡ä»¶ç­‰ã€‚</p><p>å‡å¦‚å·²ç»é…ç½®å¥½äº†ä¸€ä¸ª kubeconfig æ–‡ä»¶ï¼Œæ­¤æ—¶å¯ä»¥åœ¨ Pipeline ä¸­å¼•ç”¨è¯¥æ–‡ä»¶</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//Jenkinsfile (Declarative Pipeline)
pipeline {
  agent {
    kubernetes {
      cloud &#39;kubernetes&#39;
      slaveConnectTimeout 1200
      workspaceVolume emptyDirWorkspaceVolume()
      yaml &#39;&#39;&#39;
kind: Pod
metadata:
  name: jenkins-agent
spec:
  containers:
  - args: [\&#39;$(JENKINS_SECRET)\&#39;, \&#39;$(JENKINS_NAME)\&#39;]
    image: &#39;192.168.10.15/kubernetes/jnlp:alpine&#39;
    name: jnlp
    imagePullPolicy: IfNotPresent
  - command:
      - &quot;cat&quot;
    image: &quot;192.168.10.15/kubernetes/kubectl:apline&quot;
    imagePullPolicy: &quot;IfNotPresent&quot;
    name: &quot;kubectl&quot;
    tty: true
  restartPolicy: Never
&#39;&#39;&#39;
    }
  }
  environment {
    MY_KUBECONFIG = credentials(&#39;kubernetes-cluster&#39;)
  }
  stages {
    stage(&#39;kubectl&#39;) {
      steps {
        container(name: &#39;kubectl&#39;) {
          sh &quot;&quot;&quot;
            kubectl get pod -A  --kubeconfig $MY_KUBECONFIG
          &quot;&quot;&quot;
        }
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä»‹ç»å†…å®¹æ¥æºï¼š<a href="http://u.kubeinfo.cn/ozoxB" target="_blank" rel="noopener noreferrer">u.kubeinfo.cn/ozoxB<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/topjf/topjf/edit/main/docs/linux/jenkins.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: topjfk@163.com">jinfang</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><a href="/linux/update-kernel.html" class="nav-link prev" aria-label="centos(kernel)å†…æ ¸å‡çº§"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="font-icon icon iconfont icon-linux" style=""></span>centos(kernel)å†…æ ¸å‡çº§</div></a><!----></nav><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright Â© 2023 topjf</div></footer></div><!--]--><!--]--><!----><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-30d3d221.js" defer></script>
  </body>
</html>
