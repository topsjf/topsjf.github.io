import{_ as i,V as s,W as d,a0 as r,X as t,Y as e,Z as l,$ as a,G as c}from"./framework-ed4f969a.js";const g="/assets/true-image-20210912164842416-a689efdb.png",o="/assets/true-image-20210912165122290-b45ba5e2.png",m="/assets/true-image-20210912170227440-56138597.png",p="/assets/true-image-20210912170316913-f7cc4a33.png",v="/assets/true-image-20210912170626005-835fc2fd.png",x="/assets/true-image-20210912172411783-098df165.png",y="/assets/true-image-20210912172525710-195f86e2.png",u="/assets/true-image-20210912180525701-8ed5513e.png",h="/assets/true-image-20210912184827240-01db0120.png",b="/assets/true-image-20210912180352133-f720a5b7.png",_="/assets/true-image-20210912180334354-f8ddb7d0.png",f="/assets/true-20210912190103-e2d840cc.png",C="/assets/true-image-20210912190440872-6d447cf9.png",L="/assets/true-image-20210912223900240-e50a3900.png",V="/assets/true-image-20210912224327322-76954799.png",j={},E=a('<h2 id="指标" tabindex="-1"><a class="header-anchor" href="#指标" aria-hidden="true">#</a> -- 指标：</h2><p><img src="'+g+'" alt=""><img src="'+o+'" alt=""></p><h2 id="jmeter" tabindex="-1"><a class="header-anchor" href="#jmeter" aria-hidden="true">#</a> -- Jmeter</h2>',3),I={href:"https://dlcdn.apache.org//jmeter/binaries/apache-jmeter-5.4.3.tgz",target:"_blank",rel:"noopener noreferrer"},N={href:"https://dlcdn.apache.org//jmeter/binaries/apache-jmeter-5.4.3.zip",target:"_blank",rel:"noopener noreferrer"},k=a('<p><img src="'+m+'" alt=""></p><p><img src="'+p+'" alt=""></p><p>常用：</p><p><img src="'+v+'" alt=""></p><p><img src="'+x+'" alt=""></p><p><img src="'+y+'" alt=""></p><p>受【cpu,jvm,数据库，网络IO，中间件】分配等影响</p><h2 id="堆内存-垃圾回收" tabindex="-1"><a class="header-anchor" href="#堆内存-垃圾回收" aria-hidden="true">#</a> -- 堆内存&amp;垃圾回收</h2><p>jvm</p><p><img src="'+u+'" alt=""></p><hr><p>堆空间</p><p><img src="'+h+'" alt=""></p><hr><p>堆：</p><p>新生代</p><p><img src="'+b+'" alt=""></p><p>老年代</p><p><img src="'+_+'" alt=""></p><hr><h2 id="性能监控" tabindex="-1"><a class="header-anchor" href="#性能监控" aria-hidden="true">#</a> -- 性能监控</h2><p>jconsole&amp; jvisualvm</p><p><img src="'+f+'" alt=""></p><p><img src="'+C+'" alt=""></p>',24),q={href:"https://visualvm.github.io/pluginscenters.html",target:"_blank",rel:"noopener noreferrer"},S=a(`<p>运行压力测试+visualvm，检测jvm使用情况</p><table><thead><tr><th style="text-align:left;">测试指标</th><th style="text-align:center;">压测线程数</th><th style="text-align:center;">吞吐量/s</th><th style="text-align:center;">90%响应时间</th><th style="text-align:center;">99%响应时间</th></tr></thead><tbody><tr><td style="text-align:left;">Nginx</td><td style="text-align:center;">80</td><td style="text-align:center;">40,063.148</td><td style="text-align:center;">2</td><td style="text-align:center;">3</td></tr><tr><td style="text-align:left;">Gateway</td><td style="text-align:center;">80</td><td style="text-align:center;">36,176.975</td><td style="text-align:center;">4</td><td style="text-align:center;">8</td></tr><tr><td style="text-align:left;">简单服务 8100:hello</td><td style="text-align:center;">80</td><td style="text-align:center;">45,053.433</td><td style="text-align:center;">3</td><td style="text-align:center;">6</td></tr><tr><td style="text-align:left;">Gateway+简单服务</td><td style="text-align:center;">80</td><td style="text-align:center;">12,609.957</td><td style="text-align:center;">10</td><td style="text-align:center;">18</td></tr><tr><td style="text-align:left;">全链路</td><td style="text-align:center;">80</td><td style="text-align:center;">12,444.525</td><td style="text-align:center;">11</td><td style="text-align:center;">18</td></tr><tr><td style="text-align:left;">全链路（Nginx动静分离）</td><td style="text-align:center;">200</td><td style="text-align:center;">16,049.027</td><td style="text-align:center;">18</td><td style="text-align:center;">58</td></tr><tr><td style="text-align:left;">全链路（Nginx动静分离+缓存+去log+索引）</td><td style="text-align:center;">200</td><td style="text-align:center;">16,060.535</td><td style="text-align:center;">18</td><td style="text-align:center;">56</td></tr><tr><td style="text-align:left;">首页1级菜单渲染</td><td style="text-align:center;">80</td><td style="text-align:center;">1,373.826(db,渲染)</td><td style="text-align:center;">66</td><td style="text-align:center;">86</td></tr><tr><td style="text-align:left;">首页渲染(开缓存)</td><td style="text-align:center;">80</td><td style="text-align:center;">2,204.165</td><td style="text-align:center;">53</td><td style="text-align:center;">85</td></tr><tr><td style="text-align:left;">首页渲染(开缓存+去log+sql索引)</td><td style="text-align:center;">80</td><td style="text-align:center;">3,156.914</td><td style="text-align:center;">29</td><td style="text-align:center;">37</td></tr><tr><td style="text-align:left;">3级分类数据获取</td><td style="text-align:center;">80</td><td style="text-align:center;">27.616(db)</td><td style="text-align:center;">3,207</td><td style="text-align:center;">3,414</td></tr><tr><td style="text-align:left;">3级分类数据获取(开缓存+去log+sql索引)</td><td style="text-align:center;">80</td><td style="text-align:center;">49.132</td><td style="text-align:center;">1,703</td><td style="text-align:center;">1,927</td></tr><tr><td style="text-align:left;">3级分类数据获取(业务优化+关缓存+log+sql索引)</td><td style="text-align:center;">80</td><td style="text-align:center;">310.131</td><td style="text-align:center;">436</td><td style="text-align:center;">646</td></tr><tr><td style="text-align:left;">3级分类数据获取(redis+业务优化+关缓存+log+sql索引)</td><td style="text-align:center;">80</td><td style="text-align:center;">4,890.867</td><td style="text-align:center;">25</td><td style="text-align:center;">43</td></tr><tr><td style="text-align:left;">首页全量数据获取</td><td style="text-align:center;">80</td><td style="text-align:center;">19.157</td><td style="text-align:center;">661</td><td style="text-align:center;">798</td></tr><tr><td style="text-align:left;">首页全量数据获取(开缓存+去log+sql索引)</td><td style="text-align:center;">80</td><td style="text-align:center;">65.36</td><td style="text-align:center;">1,513</td><td style="text-align:center;">1,845</td></tr><tr><td style="text-align:left;">首页全量数据获取(Nginx动静分离+开缓存+去log+sql索引)</td><td style="text-align:center;">80/200</td><td style="text-align:center;">17,460.284/16,066.387</td><td style="text-align:center;">8/18</td><td style="text-align:center;">21/59</td></tr><tr><td style="text-align:left;">Nginx+Gateway</td><td style="text-align:center;">80</td><td style="text-align:center;"></td><td style="text-align:center;"></td><td style="text-align:center;"></td></tr></tbody></table><p>1、中间件有多，性能损失越大</p><p>业务：db(MySQL+创建索引)、模板的渲染速度、静态资源</p><h3 id="首页渲染-开缓存-去log-sql" tabindex="-1"><a class="header-anchor" href="#首页渲染-开缓存-去log-sql" aria-hidden="true">#</a> --- 首页渲染(开缓存+去log+sql)：</h3><p>getLevel1Categorys-》db无索引，开缓存，去log：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>消耗时间：56
消耗时间：4
消耗时间：2
消耗时间：2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>getLevel1Categorys-》db有索引，开缓存，去log：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>消耗时间：5
消耗时间：1
消耗时间：1
消耗时间：1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="nginx动静分离" tabindex="-1"><a class="header-anchor" href="#nginx动静分离" aria-hidden="true">#</a> -- Nginx动静分离</h2><p><img src="`+L+'" alt=""></p><p>1、以后将所有项目的静态资源都应该放在nginx里面 2、规则: /static/**所有请求都由nginx直接返回</p><p><img src="'+V+`" alt=""></p><p>配置</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>location / {
	proxy_pass http://yumall;
    #proxy_set_header Host $host;
}

location /static/ {
   #root /usr/share/nginx/html; #docker
   root html; #非docker运行
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,15),w={href:"http://yumall.com/static/index/img/img_01.png",target:"_blank",rel:"noopener noreferrer"},M=a(`<p>压力测试</p><h2 id="示例-getcatalogjson优化" tabindex="-1"><a class="header-anchor" href="#示例-getcatalogjson优化" aria-hidden="true">#</a> -- 示例：getCataLogJson优化</h2><p>将数据库的多次查询放到一次，</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/*
将数据库的多次查询放到一次，
 */
List&lt;CategoryEntity&gt; categoryEntities0 = baseMapper.selectList(null);

//1、查出所有1级分类
List&lt;CategoryEntity&gt; level1Categorys = getParent_cid(categoryEntities0, 0L);
//2、封装数据
Map&lt;String, List&lt;Catalog2Vo&gt;&gt; parent_cid = level1Categorys.stream().collect(Collectors.toMap(k -&gt; k.getCatId().toString(), v -&gt; {
    //1. 每一个的一级分类，查到这个一级分类的二级分类
    List&lt;CategoryEntity&gt; categoryEntities = getParent_cid(categoryEntities0, v.getCatId());
    //封装上面的结果
    List&lt;Catalog2Vo&gt; catalog2VoList = null;
    if (categoryEntities != null) {
        catalog2VoList = categoryEntities.stream().map(l2 -&gt; {
            Catalog2Vo catalog2Vo = new Catalog2Vo(l2.getCatId().toString(), null, l2.getCatId().toString(), l2.getName());
            //查到这个二级分类的三级分类
            List&lt;CategoryEntity&gt; leve3CataLog = getParent_cid(categoryEntities0, l2.getCatId());
            if (leve3CataLog != null) {
                List&lt;Catalog2Vo.Catalog3Vo&gt; collect = leve3CataLog.stream().map(l3 -&gt; {
                    Catalog2Vo.Catalog3Vo catalog3Vo = new Catalog2Vo.Catalog3Vo(l2.getCatId().toString(), l3.getCatId().toString(), l3.getName());

                    return catalog3Vo;
                }).collect(Collectors.toList());
                catalog2Vo.setCatalog3List(collect);
            }
            return catalog2Vo;
        }).collect(Collectors.toList());
    }
    return catalog2VoList;
}));
return parent_cid;

--------------------------------------------
  private List&lt;CategoryEntity&gt; getParent_cid(List&lt;CategoryEntity&gt; selectCategory, Long catId) {
//        return baseMapper.selectList(new QueryWrapper&lt;CategoryEntity&gt;().eq(&quot;parent_cid&quot;, catId));
        return selectCategory.stream().filter(item -&gt; item.getParentCid() == catId).collect(Collectors.toList());
    }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4);function P(z,G){const n=c("ExternalLinkIcon");return s(),d("div",null,[r(" more "),E,t("p",null,[e("下载："),t("a",I,[e("https://dlcdn.apache.org//jmeter/binaries/apache-jmeter-5.4.3.tgz"),l(n)])]),t("p",null,[t("a",N,[e("https://dlcdn.apache.org//jmeter/binaries/apache-jmeter-5.4.3.zip"),l(n)])]),k,t("p",null,[e("安装插件报错地址："),t("a",q,[e("https://visualvm.github.io/pluginscenters.html"),l(n)])]),S,t("p",null,[t("a",w,[e("http://yumall.com/static/index/img/img_01.png"),l(n)])]),M])}const J=i(j,[["render",P],["__file","jmeter.html.vue"]]);export{J as default};
