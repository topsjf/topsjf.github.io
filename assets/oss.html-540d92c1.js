import{_ as o,V as c,W as l,a0 as i,X as n,Y as s,Z as t,$ as e,G as u}from"./framework-ed4f969a.js";const k="/assets/true-policy-288b648c.png",p="/assets/true-p139016-d075ceba.png",r="/assets/true-p140018-554dc96c.png",d={},m={href:"https://help.aliyun.com/document_detail/32009.html",target:"_blank",rel:"noopener noreferrer"},v=n("h1",null,"1，OSS 依赖",-1),b={href:"https://mvnrepository.com/artifact/com.aliyun.oss/aliyun-sdk-oss",target:"_blank",rel:"noopener noreferrer"},g=e(`<div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/com.aliyun.oss/aliyun-sdk-oss --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>oss.version</span><span class="token punctuation">&gt;</span></span>3.13.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>oss.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun.oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-sdk-oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>\${oss.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果使用的是Java 9及以上的版本，则需要添加jaxb相关依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jaxb-api.version</span><span class="token punctuation">&gt;</span></span>2.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jaxb-api.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activation.version</span><span class="token punctuation">&gt;</span></span>1.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activation.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jaxb-runtime.version</span><span class="token punctuation">&gt;</span></span>2.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jaxb-runtime.version</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.xml.bind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jaxb-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>\${jaxb-api.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.activation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>\${activation.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.glassfish.jaxb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jaxb-runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>\${jaxb-runtime.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="创建-获取账户" tabindex="-1"><a class="header-anchor" href="#创建-获取账户" aria-hidden="true">#</a> 创建\\获取账户</h2>`,4),y={href:"https://ram.console.aliyun.com/users/new",target:"_blank",rel:"noopener noreferrer"},h=e(`<div class="language-Java line-numbers-mode" data-ext="Java"><pre class="language-Java"><code>// Endpoint以杭州为例，其它Region请按实际情况填写。
String endpoint = &quot;http://oss-cn-hangzhou.aliyuncs.com&quot;;
// 云账号AccessKey有所有API访问权限
String accessKeyId = &quot;&lt;yourAccessKeyId&gt;&quot;;
String accessKeySecret = &quot;&lt;yourAccessKeySecret&gt;&quot;;

// 创建OSSClient实例。
OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);

// 上传文件流。
InputStream inputStream = new FileInputStream(&quot;&lt;yourlocalFile&gt;&quot;);
ossClient.putObject(&quot;&lt;yourBucketName&gt;&quot;, &quot;&lt;yourObjectName&gt;&quot;, inputStream);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="常用方法" tabindex="-1"><a class="header-anchor" href="#常用方法" aria-hidden="true">#</a> 常用方法</h2><table><thead><tr><th style="text-align:left;">方法</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">new OSSClientBuilder().build(endpoint, accessId, secretKey, conf);</td><td style="text-align:left;">创建OSSClient实例。</td></tr><tr><td style="text-align:left;">new ClientBuilderConfiguration();</td><td style="text-align:left;">配置OSSClient实例</td></tr><tr><td style="text-align:left;">ossClient.createBucket(bucketName);</td><td style="text-align:left;">创建存储空间。</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">关闭OSSClient。</td></tr><tr><td style="text-align:left;">ossClient.putObject()</td><td style="text-align:left;">上传文件</td></tr><tr><td style="text-align:left;">InputStream content =ossClient.getObject(bucketName, objectName).getObjectContent(); <br>content .close();</td><td style="text-align:left;">下载文件(存储空间,文件名路径)<br>流必须关闭,否则会造成连接泄漏</td></tr><tr><td style="text-align:left;">objectListing = ossClient.listObjects(bucketName);<br>objectListing .getObjectSummaries</td><td style="text-align:left;">获取文件list<br>获取所有文件的描述信息</td></tr><tr><td style="text-align:left;">.deleteObject(bucketName, objectName);</td><td style="text-align:left;">删除文件</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"></td></tr></tbody></table><h1>2，oss(跨域+获取签名) 推荐<a name="cloud-oss"></a></h1><h2 id="nacos-yml-配置" tabindex="-1"><a class="header-anchor" href="#nacos-yml-配置" aria-hidden="true">#</a> -- nacos .yml 配置</h2><p>bootstrap.yml</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">spring</span><span class="token punctuation">:</span>
<span class="token key attr-name">  cloud</span><span class="token punctuation">:</span>
<span class="token key attr-name">    nacos</span><span class="token punctuation">:</span>
<span class="token key attr-name">      config</span><span class="token punctuation">:</span>
<span class="token key attr-name">        server-addr</span><span class="token punctuation">:</span> <span class="token value attr-value">127.0.0.1:8848</span>
<span class="token key attr-name">        namespace</span><span class="token punctuation">:</span> <span class="token value attr-value">ec067840-e24c-4f81-a5f1-8bdabbaebac7</span>
<span class="token key attr-name">        file-extension</span><span class="token punctuation">:</span> <span class="token value attr-value">yml</span>
<span class="token key attr-name">        extension-configs</span><span class="token punctuation">:</span>
<span class="token key attr-name">          -</span> <span class="token value attr-value">dataId: oss.yml</span>
<span class="token key attr-name">            group</span><span class="token punctuation">:</span> <span class="token value attr-value">dev</span>
<span class="token key attr-name">            refresh</span><span class="token punctuation">:</span> <span class="token value attr-value">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>nacos -&gt; oss.yml</p>`,8),S={href:"https://ram.console.aliyun.com/users",target:"_blank",rel:"noopener noreferrer"},q=e(`<div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">ali</span><span class="token punctuation">:</span>
    <span class="token key atrule">access-key</span><span class="token punctuation">:</span> LTAI5tP3urnFETKKfZr7wjaS
    <span class="token key atrule">secret-key</span><span class="token punctuation">:</span> yqhaWwBbt<span class="token punctuation">...</span>.
    <span class="token key atrule">oss</span><span class="token punctuation">:</span>
      <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> oss<span class="token punctuation">-</span>cn<span class="token punctuation">-</span>chengdu.aliyuncs.com
      <span class="token key atrule">bucket</span><span class="token punctuation">:</span> ik19
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="consider-defining-a-bean-of-type-com-aliyun-oss-oss-in-your-configuration" tabindex="-1"><a class="header-anchor" href="#consider-defining-a-bean-of-type-com-aliyun-oss-oss-in-your-configuration" aria-hidden="true">#</a> Consider defining a bean of type &#39;com.aliyun.oss.OSS&#39; in your configuration.</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Consider</span> defining a bean of type &#39;com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>oss<span class="token punctuation">.</span><span class="token constant">OSS</span>&#39; in your configuration<span class="token punctuation">.</span>


#########分析 <span class="token constant">OSS</span>：
oss的bean注入冲突，自己注入配置
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>oss<span class="token punctuation">.</span></span><span class="token class-name">OSS</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>oss<span class="token punctuation">.</span></span><span class="token class-name">OSSClientBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Scope</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OssClientConfig</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">OSS</span> ossClient<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">OSSClientBuilder</span> ossClientBuilder<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${spring.ali.oss.endpoint}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> endpoint<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${spring.ali.oss.bucket}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> bucket<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${spring.ali.access-key}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> accessId<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${spring.ali.secret-key}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> secretKey<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token string">&quot;prototype&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">OSS</span> <span class="token function">initOSSClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ossClient <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">OssClientConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ossClient <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    ossClient <span class="token operator">=</span> <span class="token function">initOSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessId<span class="token punctuation">,</span> secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ossClient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">OSSClientBuilder</span> <span class="token function">initOSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ossClientBuilder <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">OssClientConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ossClientBuilder <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    ossClientBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ossClientBuilder<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),f={id:"获取签名",tabindex:"-1"},w=n("a",{class:"header-anchor",href:"#获取签名","aria-hidden":"true"},"#",-1),j={href:"https://help.aliyun.com/document_detail/31926.html",target:"_blank",rel:"noopener noreferrer"},R=n("a",{name:"获取签名"},null,-1),O=n("p",null,[n("img",{src:k,alt:"img"})],-1),x=n("p",null,[n("img",{src:p,alt:"时序图"})],-1),_=n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"left"}},"字段"),n("th",{style:{"text-align":"left"}},"描述")])],-1),C=n("tr",null,[n("td",{style:{"text-align":"left"}},"accessid"),n("td",{style:{"text-align":"left"}},'用户请求的AccessKey ID："LTAI5tBDFVar1hoq****",')],-1),A=n("td",{style:{"text-align":"left"}},"host",-1),K={style:{"text-align":"left"}},P={href:"http://xxx.oss-cn-hangzhou.aliyuncs.com",target:"_blank",rel:"noopener noreferrer"},M=n("tr",null,[n("td",{style:{"text-align":"left"}},"policy"),n("td",{style:{"text-align":"left"}},'用户表单上传的策略（Policy），Policy为经过Base64编码过的字符串。"eyJleH...."')],-1),E=n("tr",null,[n("td",{style:{"text-align":"left"}},"signature"),n("td",{style:{"text-align":"left"}},'对Policy签名后的字符串 "VsxOcOudx******z93CLaXPz+4s=",')],-1),I=n("tr",null,[n("td",{style:{"text-align":"left"}},"expire"),n("td",{style:{"text-align":"left"}},"由服务器端指定的Policy过期时间，格式为Unix时间戳1446727949")],-1),B=n("tr",null,[n("td",{style:{"text-align":"left"}},"dir"),n("td",{style:{"text-align":"left"}},"上传的文件前缀")],-1),N=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OssController</span> <span class="token punctuation">{</span>
    <span class="token comment">//@Autowired</span>
    <span class="token class-name">OSS</span> ossClient<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${spring.ali.oss.endpoint}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> endpoint<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${spring.ali.oss.bucket}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> bucket<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${spring.ali.access-key}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> accessId<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 获取oss签名
     * <span class="token keyword">@return</span> oss签名
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/oss/policy&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">policy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;https://&quot;</span> <span class="token operator">+</span> bucket <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">;</span> <span class="token comment">// host的格式为 bucketname.endpoint</span>
        <span class="token class-name">String</span> format <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dir <span class="token operator">=</span> format <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 用户上传文件时指定的前缀。</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> respMap <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> expireTime <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> expireEndTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> expireTime <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
            <span class="token class-name">Date</span> expiration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>expireEndTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">PolicyConditions</span> policyConds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PolicyConditions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            policyConds<span class="token punctuation">.</span><span class="token function">addConditionItem</span><span class="token punctuation">(</span><span class="token class-name">PolicyConditions</span><span class="token punctuation">.</span><span class="token constant">COND_CONTENT_LENGTH_RANGE</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1048576000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            policyConds<span class="token punctuation">.</span><span class="token function">addConditionItem</span><span class="token punctuation">(</span><span class="token class-name">MatchMode<span class="token punctuation">.</span>StartWith</span><span class="token punctuation">,</span> <span class="token class-name">PolicyConditions</span><span class="token punctuation">.</span><span class="token constant">COND_KEY</span><span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">String</span> postPolicy <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">generatePostPolicy</span><span class="token punctuation">(</span>expiration<span class="token punctuation">,</span> policyConds<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> binaryData <span class="token operator">=</span> postPolicy<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> encodedPolicy <span class="token operator">=</span> <span class="token class-name">BinaryUtil</span><span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>binaryData<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> postSignature <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">calculatePostSignature</span><span class="token punctuation">(</span>postPolicy<span class="token punctuation">)</span><span class="token punctuation">;</span>

            respMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            respMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;accessid&quot;</span><span class="token punctuation">,</span> accessId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            respMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;policy&quot;</span><span class="token punctuation">,</span> encodedPolicy<span class="token punctuation">)</span><span class="token punctuation">;</span>
            respMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;signature&quot;</span><span class="token punctuation">,</span> postSignature<span class="token punctuation">)</span><span class="token punctuation">;</span>
            respMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;dir&quot;</span><span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
            respMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;host&quot;</span><span class="token punctuation">,</span> host<span class="token punctuation">)</span><span class="token punctuation">;</span>
            respMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;expire&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>expireEndTime <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">getStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> respMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="#web%E4%B8%8A%E4%BC%A0%E7%A4%BA%E4%BE%8B">web上传示例</a></p><h2 id="获取签名测试" tabindex="-1"><a class="header-anchor" href="#获取签名测试" aria-hidden="true">#</a> -- 获取签名测试</h2>`,3),T={href:"http://localhost:50000/api/thirdparty/oss/policy",target:"_blank",rel:"noopener noreferrer"},U=e(`<div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;accessid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LTA&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;policy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eyJleHBpdXX0=&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;signature&quot;</span><span class="token operator">:</span> <span class="token string">&quot;n0TsLEPu=&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;dir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2021-06-02/&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://xxx.oss-cn-chengdu.aliyuncs.com&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;expire&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1231....60&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),L={href:"https://help.aliyun.com/document_detail/145203.html",target:"_blank",rel:"noopener noreferrer"},D=e(`<h2 id="创建存储空间-createbucket" tabindex="-1"><a class="header-anchor" href="#创建存储空间-createbucket" aria-hidden="true">#</a> -- 创建存储空间 createBucket</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 创建CreateBucketRequest对象。</span>
<span class="token class-name">CreateBucketRequest</span> createBucketRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateBucketRequest</span><span class="token punctuation">(</span><span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 如果创建存储空间的同时需要指定存储类型和数据容灾类型, 请参考如下代码。</span>
<span class="token comment">// 此处以设置存储空间的存储类型为标准存储为例介绍。</span>
<span class="token comment">//createBucketRequest.setStorageClass(StorageClass.Standard);</span>
<span class="token comment">// 数据容灾类型默认为本地冗余存储，即DataRedundancyType.LRS。</span>
<span class="token comment">//如果需要设置数据容灾类型为同城冗余存储，请设置为DataRedundancyType.ZRS。</span>
<span class="token comment">//createBucketRequest.setDataRedundancyType(DataRedundancyType.ZRS);</span>
<span class="token comment">// 设置存储空间的权限为公共读，默认为私有。</span>
<span class="token comment">//createBucketRequest.setCannedACL(CannedAccessControlList.PublicRead);</span>

<span class="token comment">// 创建存储空间。</span>
ossClient<span class="token punctuation">.</span><span class="token function">createBucket</span><span class="token punctuation">(</span>createBucketRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="列举存储空间" tabindex="-1"><a class="header-anchor" href="#列举存储空间" aria-hidden="true">#</a> -- 列举存储空间</h2><h3 id="列举所有存储空间-listbuckets" tabindex="-1"><a class="header-anchor" href="#列举所有存储空间-listbuckets" aria-hidden="true">#</a> 列举所有存储空间 listBuckets</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 列举当前账号下的所有存储空间。</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Bucket</span><span class="token punctuation">&gt;</span></span> buckets <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">listBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Bucket</span> bucket <span class="token operator">:</span> buckets<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; - &quot;</span> <span class="token operator">+</span> bucket<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="列举指定前缀的存储空间-setprefix" tabindex="-1"><a class="header-anchor" href="#列举指定前缀的存储空间-setprefix" aria-hidden="true">#</a> 列举指定前缀的存储空间 setPrefix</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ListBucketsRequest</span> listBucketsRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListBucketsRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 填写前缀。</span>
listBucketsRequest<span class="token punctuation">.</span><span class="token function">setPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;example&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BucketList</span> bucketList <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">listBuckets</span><span class="token punctuation">(</span>listBucketsRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Bucket</span> bucket <span class="token operator">:</span> bucketList<span class="token punctuation">.</span><span class="token function">getBucketList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; - &quot;</span> <span class="token operator">+</span> bucket<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="列举指定marker之后的存储空间-setmarker" tabindex="-1"><a class="header-anchor" href="#列举指定marker之后的存储空间-setmarker" aria-hidden="true">#</a> 列举指定marker之后的存储空间 setMarker</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>listBucketsRequest<span class="token punctuation">.</span><span class="token function">setMarker</span><span class="token punctuation">(</span><span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BucketList</span> bucketList <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">listBuckets</span><span class="token punctuation">(</span>listBucketsRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Bucket</span> bucket <span class="token operator">:</span> bucketList<span class="token punctuation">.</span><span class="token function">getBucketList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; - &quot;</span> <span class="token operator">+</span> bucket<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="列举指定个数的存储空间-setmaxkeys" tabindex="-1"><a class="header-anchor" href="#列举指定个数的存储空间-setmaxkeys" aria-hidden="true">#</a> 列举指定个数的存储空间 setMaxKeys</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>listBucketsRequest<span class="token punctuation">.</span><span class="token function">setMaxKeys</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BucketList</span> bucketList <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">listBuckets</span><span class="token punctuation">(</span>listBucketsRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Bucket</span> bucket <span class="token operator">:</span> bucketList<span class="token punctuation">.</span><span class="token function">getBucketList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; - &quot;</span> <span class="token operator">+</span> bucket<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="判断存储空间是否存在-doesbucketexist-bucketname" tabindex="-1"><a class="header-anchor" href="#判断存储空间是否存在-doesbucketexist-bucketname" aria-hidden="true">#</a> -- 判断存储空间是否存在 doesBucketExist(&quot;bucketName&quot;);</h2><h2 id="获取存储空间的地域-getbucketlocation-bucketname" tabindex="-1"><a class="header-anchor" href="#获取存储空间的地域-getbucketlocation-bucketname" aria-hidden="true">#</a> -- 获取存储空间的地域 getBucketLocation(&quot;bucketName&quot;);</h2><h2 id="获取存储空间的信息-getbucketinfo-bucketname" tabindex="-1"><a class="header-anchor" href="#获取存储空间的信息-getbucketinfo-bucketname" aria-hidden="true">#</a> -- 获取存储空间的信息 getBucketInfo(&quot;bucketName&quot;);</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 获取地域。</span>
info<span class="token punctuation">.</span><span class="token function">getBucket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取创建日期。</span>
info<span class="token punctuation">.</span><span class="token function">getBucket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCreationDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取拥有者信息。</span>
info<span class="token punctuation">.</span><span class="token function">getBucket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOwner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取容灾类型。</span>
info<span class="token punctuation">.</span><span class="token function">getDataRedundancyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="管理存储空间读写权限" tabindex="-1"><a class="header-anchor" href="#管理存储空间读写权限" aria-hidden="true">#</a> -- 管理存储空间读写权限</h2><h3 id="设置存储空间的访问权限" tabindex="-1"><a class="header-anchor" href="#设置存储空间的访问权限" aria-hidden="true">#</a> 设置存储空间的访问权限</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>ossClient<span class="token punctuation">.</span><span class="token function">setBucketAcl</span><span class="token punctuation">(</span><span class="token string">&quot;yourBucketName&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CannedAccessControlList<span class="token punctuation">.</span>Private</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="获取存储空间读写权限" tabindex="-1"><a class="header-anchor" href="#获取存储空间读写权限" aria-hidden="true">#</a> 获取存储空间读写权限</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>ossClient<span class="token punctuation">.</span><span class="token function">getBucketAcl</span><span class="token punctuation">(</span><span class="token string">&quot;yourBucketName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="删除存储空间" tabindex="-1"><a class="header-anchor" href="#删除存储空间" aria-hidden="true">#</a> -- 删除存储空间</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>ossClient<span class="token punctuation">.</span><span class="token function">deleteBucket</span><span class="token punctuation">(</span><span class="token string">&quot;yourBucketName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,22),F={id:"存储空间标签",tabindex:"-1"},H=n("a",{class:"header-anchor",href:"#存储空间标签","aria-hidden":"true"},"#",-1),z={href:"https://help.aliyun.com/document_detail/119163.html",target:"_blank",rel:"noopener noreferrer"},V=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">SetBucketTaggingRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SetBucketTaggingRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="设置" tabindex="-1"><a class="header-anchor" href="#设置" aria-hidden="true">#</a> 设置</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>request<span class="token punctuation">.</span><span class="token function">setTag</span><span class="token punctuation">(</span><span class="token string">&quot;owner&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">setTag</span><span class="token punctuation">(</span><span class="token string">&quot;location&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hangzhou&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ossClient<span class="token punctuation">.</span><span class="token function">setBucketTagging</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="获取" tabindex="-1"><a class="header-anchor" href="#获取" aria-hidden="true">#</a> 获取</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">TagSet</span> tagSet <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">getBucketTagging</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tags <span class="token operator">=</span> tagSet<span class="token punctuation">.</span><span class="token function">getAllTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span> tag<span class="token operator">:</span>tags<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;key:&quot;</span><span class="token operator">+</span>tag<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; value:&quot;</span><span class="token operator">+</span>tag<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="列举指定标签" tabindex="-1"><a class="header-anchor" href="#列举指定标签" aria-hidden="true">#</a> 列举指定标签</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">TagSet</span> tagSet <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">getBucketTagging</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tags <span class="token operator">=</span> tagSet<span class="token punctuation">.</span><span class="token function">getAllTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span> tag<span class="token operator">:</span>tags<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;key:&quot;</span><span class="token operator">+</span>tag<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; value:&quot;</span><span class="token operator">+</span>tag<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="删除" tabindex="-1"><a class="header-anchor" href="#删除" aria-hidden="true">#</a> 删除</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>ossClient<span class="token punctuation">.</span><span class="token function">deleteBucketTagging</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,9),G={id:"存储空间清单",tabindex:"-1"},X=n("a",{class:"header-anchor",href:"#存储空间清单","aria-hidden":"true"},"#",-1),W={href:"https://help.aliyun.com/document_detail/177804.html",target:"_blank",rel:"noopener noreferrer"},J={id:"授权策略",tabindex:"-1"},$=n("a",{class:"header-anchor",href:"#授权策略","aria-hidden":"true"},"#",-1),Y={href:"https://help.aliyun.com/document_detail/155204.html",target:"_blank",rel:"noopener noreferrer"},Z={id:"合规保留策略",tabindex:"-1"},Q=n("a",{class:"header-anchor",href:"#合规保留策略","aria-hidden":"true"},"#",-1),nn={href:"https://help.aliyun.com/document_detail/181366.html",target:"_blank",rel:"noopener noreferrer"},sn={id:"生命周期",tabindex:"-1"},an=n("a",{class:"header-anchor",href:"#生命周期","aria-hidden":"true"},"#",-1),tn={href:"https://help.aliyun.com/document_detail/32017.html",target:"_blank",rel:"noopener noreferrer"},en=e('<h2 id="请求者付费模式" tabindex="-1"><a class="header-anchor" href="#请求者付费模式" aria-hidden="true">#</a> -- <a href="">请求者付费模式</a></h2><h2 id="防盗链" tabindex="-1"><a class="header-anchor" href="#防盗链" aria-hidden="true">#</a> -- <a href="">防盗链</a></h2><h2 id="访问日志" tabindex="-1"><a class="header-anchor" href="#访问日志" aria-hidden="true">#</a> -- <a href="">访问日志</a></h2><h2 id="静态网站托管-镜像回源" tabindex="-1"><a class="header-anchor" href="#静态网站托管-镜像回源" aria-hidden="true">#</a> -- <a href="">静态网站托管（镜像回源）</a></h2><h2 id="跨区域复制" tabindex="-1"><a class="header-anchor" href="#跨区域复制" aria-hidden="true">#</a> -- <a href="">跨区域复制</a></h2><h2 id="跨域资源共享" tabindex="-1"><a class="header-anchor" href="#跨域资源共享" aria-hidden="true">#</a> -- <a href="">跨域资源共享</a></h2><h2 id="传输加速" tabindex="-1"><a class="header-anchor" href="#传输加速" aria-hidden="true">#</a> -- <a href="">传输加速</a></h2>',7),pn={href:"https://help.aliyun.com/document_detail/84778.html",target:"_blank",rel:"noopener noreferrer"},on={id:"概述",tabindex:"-1"},cn=n("a",{class:"header-anchor",href:"#概述","aria-hidden":"true"},"#",-1),ln={href:"https://help.aliyun.com/document_detail/32013.html",target:"_blank",rel:"noopener noreferrer"},un=n("pre",null,[n("code",null,`简单上传：包括流式上传和文件上传。最大不能超过5GB。
表单上传：最大不能超过5GB。
追加上传：最大不能超过5GB。
断点续传上传：支持并发、断点续传、自定义分片大小。大文件上传推荐使用断点续传。最大不能超过48.8TB。
分片上传：当文件较大时，可以使用分片上传，最大不能超过48.8TB。
`)],-1),kn={id:"简单上传",tabindex:"-1"},rn=n("a",{class:"header-anchor",href:"#简单上传","aria-hidden":"true"},"#",-1),dn={href:"https://help.aliyun.com/document_detail/84781.html",target:"_blank",rel:"noopener noreferrer"},mn=e(`<h3 id="流式上传" tabindex="-1"><a class="header-anchor" href="#流式上传" aria-hidden="true">#</a> 流式上传</h3><p>使用流式上传，您可以将数据流上传到OSS文件。<br><strong>说明</strong> <code>如果OSS文件存在，则上传的数据会覆盖该文件的内容；如果OSS文件不存在，则会新建该文件</code></p><h4 id="上传字符串" tabindex="-1"><a class="header-anchor" href="#上传字符串" aria-hidden="true">#</a> 上传字符串</h4><p>以下代码用于将字符串上传到目标存储空间examplebucket中exampledir目录下的exampleobject.txt文件。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
  <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
  <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 创建OSSClient实例。</span>
  <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 填写字符串。</span>
  <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">&quot;Hello OSS&quot;</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 创建PutObjectRequest对象。</span>
  <span class="token comment">// 依次填写Bucket名称（例如examplebucket）和Object完整路径（例如exampledir/exampleobject.txt）。Object完整路径中不能包含Bucket名称。</span>
  <span class="token class-name">PutObjectRequest</span> putObjectRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PutObjectRequest</span><span class="token punctuation">(</span><span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;exampledir/exampleobject.txt&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 如果需要上传时设置存储类型和访问权限，请参考以下示例代码。</span>
  <span class="token comment">// ObjectMetadata metadata = new ObjectMetadata();</span>
  <span class="token comment">// metadata.setHeader(OSSHeaders.OSS_STORAGE_CLASS, StorageClass.Standard.toString());</span>
  <span class="token comment">// metadata.setObjectAcl(CannedAccessControlList.Private);</span>
  <span class="token comment">// putObjectRequest.setMetadata(metadata);</span>
  
  <span class="token comment">// 上传字符串。</span>
  ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>putObjectRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="上传byte数组" tabindex="-1"><a class="header-anchor" href="#上传byte数组" aria-hidden="true">#</a> 上传Byte数组</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
  <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录 https://ram.console.aliyun.com 创建RAM账号。</span>
  <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 创建OSSClient实例。</span>
  <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span>accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 填写Byte数组。</span>
  <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> content <span class="token operator">=</span> <span class="token string">&quot;Hello OSS&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 依次填写Bucket名称（例如examplebucket）和Object完整路径（例如exampledir/exampleobject.txt）。Object完整路径中不能包含Bucket名称。</span>
  ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span><span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;exampledir/exampleobject.txt&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="上传网络流" tabindex="-1"><a class="header-anchor" href="#上传网络流" aria-hidden="true">#</a> 上传网络流</h4><p>以下代码用于将网络流上传到目标存储空间的exampleobject.txt文件。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
  <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
  <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 创建OSSClient实例。</span>
  <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 填写网络流地址。</span>
  <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">&quot;https://www.aliyun.com/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 依次填写Bucket名称（例如examplebucket）和Object完整路径（例如exampledir/exampleobject.txt）。Object完整路径中不能包含Bucket名称。</span>
  ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span><span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;exampledir/exampleobject.txt&quot;</span><span class="token punctuation">,</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="上传文件流" tabindex="-1"><a class="header-anchor" href="#上传文件流" aria-hidden="true">#</a> 上传文件流</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
  <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
  <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 创建OSSClient实例。</span>
  <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 填写本地文件的完整路径。如果未指定本地路径，则默认从示例程序所属项目对应本地路径中上传文件流。</span>
  <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\\\localpath\\\\examplefile.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 依次填写Bucket名称（例如examplebucket）和Object完整路径（例如exampledir/exampleobject.txt）。Object完整路径中不能包含Bucket名称。</span>
  ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span><span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;exampledir/exampleobject.txt&quot;</span><span class="token punctuation">,</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="文件上传" tabindex="-1"><a class="header-anchor" href="#文件上传" aria-hidden="true">#</a> 文件上传</h3><p>使用文件上传，您可以将本地文件上传到OSS文件。 以下代码用于将本地文件examplefile.txt上传到目标存储空间examplebucket中exampledir目录下的exampleobject.txt文件。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建PutObjectRequest对象。</span>
<span class="token comment">// 依次填写Bucket名称（例如examplebucket）、Object完整路径（例如exampledir/exampleobject.txt）和本地文件的完整路径。Object完整路径中不能包含Bucket名称。</span>
<span class="token comment">// 如果未指定本地路径，则默认从示例程序所属项目对应本地路径中上传文件。</span>
<span class="token class-name">PutObjectRequest</span> putObjectRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PutObjectRequest</span><span class="token punctuation">(</span><span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;exampledir/exampleobject.txt&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\\\localpath\\\\examplefile.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 如果需要上传时设置存储类型和访问权限，请参考以下示例代码。</span>
<span class="token comment">// ObjectMetadata metadata = new ObjectMetadata();</span>
<span class="token comment">// metadata.setHeader(OSSHeaders.OSS_STORAGE_CLASS, StorageClass.Standard.toString());</span>
<span class="token comment">// metadata.setObjectAcl(CannedAccessControlList.Private);</span>
<span class="token comment">// putObjectRequest.setMetadata(metadata);</span>

<span class="token comment">// 上传文件。</span>
ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>putObjectRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="web上传" tabindex="-1"><a class="header-anchor" href="#web上传" aria-hidden="true">#</a> -- web上传</h2><p><code>浏览器或App端上传文件到应用服务器，应用服务器再把文件上传到OSS</code></p><p><img src="`+r+'" alt="时序图"></p><h3 id="缺点" tabindex="-1"><a class="header-anchor" href="#缺点" aria-hidden="true">#</a> 缺点</h3><p>和<code>数据直传</code>到OSS相比，web端：</p><ul><li>上传慢：用户数据需先上传到应用服务器，之后再上传到OSS，网络传输时间比直传到OSS多一倍。如果用户数据不通过应用服务器中转，而是直传到OSS，速度将大大提升。而且OSS采用BGP带宽，能保证各地各运营商之间的传输速度。</li><li>扩展性差：如果后续用户数量逐渐增加，则应用服务器会成为瓶颈。</li><li>费用高：需要准备多台应用服务器。由于OSS上行流量是免费的，如果数据直传到OSS，将节省多台应用服务器的费用。</li></ul><h3 id="vue获取签名后直传" tabindex="-1"><a class="header-anchor" href="#vue获取签名后直传" aria-hidden="true">#</a> VUE获取签名后直传<a name="web上传示例"></a></h3><p><img src="'+p+`" alt="时序图"></p><p><a href="#%E8%8E%B7%E5%8F%96%E7%AD%BE%E5%90%8D">1、2步：获取签名</a></p><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 使用服务端签名后直传 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-upload</span>
        <span class="token attr-name">:action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uploadUrl<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataObj<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">list-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>picture<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:limit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:multiple</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:show-file-list</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showFileList<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:file-list</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileList<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:before-upload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>beforeUpload<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:on-remove</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleRemove<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:on-success</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleUploadSuccess<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:on-preview</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handlePreview<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tip<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>el-upload__tip<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>只能上传jpg/png文件，且不超过10MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-upload</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span> <span class="token attr-name">:visible.sync</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialogVisible<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100%<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileList[0].url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>policy<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./policy&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>getUUID<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/util&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;singleUpload&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> String
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">imageUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">imageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">!==</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">fileList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageName<span class="token punctuation">,</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageUrl
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/*是否显示已上传文件列表*/</span>
    <span class="token literal-property property">showFileList</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">!==</span> <span class="token string">&#39;&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">uploadUrl</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">dataObj</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">policy</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">signature</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">OSSAccessKeyId</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
        <span class="token comment">// callback:&#39;&#39;,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">dialogVisible</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">emitInput</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&#39;input&#39;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">handleRemove</span><span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> fileList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitInput</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">handlePreview</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dialogVisible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/*获取oss签名后，文件上传之前*/</span>
    <span class="token function">beforeUpload</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> _self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//response返回的签名</span>
        <span class="token function">policy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          _self<span class="token punctuation">.</span>uploadUrl <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>host<span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;uploadUrl:::::&quot;</span><span class="token punctuation">,</span> uploadUrl<span class="token punctuation">)</span>
          _self<span class="token punctuation">.</span>dataObj<span class="token punctuation">.</span>policy <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>policy<span class="token punctuation">;</span>
          _self<span class="token punctuation">.</span>dataObj<span class="token punctuation">.</span>signature <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>signature<span class="token punctuation">;</span>
          _self<span class="token punctuation">.</span>dataObj<span class="token punctuation">.</span>OSSAccessKeyId <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>accessid<span class="token punctuation">;</span>
          _self<span class="token punctuation">.</span>dataObj<span class="token punctuation">.</span>key <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>dir <span class="token operator">+</span> <span class="token function">getUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;_\${filename}&#39;</span><span class="token punctuation">;</span>
          _self<span class="token punctuation">.</span>dataObj<span class="token punctuation">.</span>dir <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>dir<span class="token punctuation">;</span>
          _self<span class="token punctuation">.</span>dataObj<span class="token punctuation">.</span>host <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>host<span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">handleUploadSuccess</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//console.log&quot;上传成功...: &quot;, file.name)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>showFileList <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>fileList<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>fileList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> file<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataObj<span class="token punctuation">.</span>host <span class="token operator">+</span> <span class="token string">&#39;/&#39;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataObj<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;\${filename}&quot;</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitInput</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fileList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> http <span class="token keyword">from</span> <span class="token string">&#39;@/util/httpRequest.js&#39;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">policy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">http</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> http<span class="token punctuation">.</span><span class="token function">forUrl</span><span class="token punctuation">(</span><span class="token string">&quot;oss/policy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">params</span><span class="token operator">:</span> http<span class="token punctuation">.</span><span class="token function">getD</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>data<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="java获取签名直传并设置上传回调" tabindex="-1"><a class="header-anchor" href="#java获取签名直传并设置上传回调" aria-hidden="true">#</a> Java获取签名直传并设置上传回调</h3><p><a href="#%E8%8E%B7%E5%8F%96%E7%AD%BE%E5%90%8D">java获取签名</a></p><p><a href="#%E4%B8%8A%E4%BC%A0%E5%9B%9E%E8%B0%83">上传回调</a></p>`,29),vn={id:"表单上传",tabindex:"-1"},bn=n("a",{class:"header-anchor",href:"#表单上传","aria-hidden":"true"},"#",-1),gn={href:"https://help.aliyun.com/document_detail/84788.html",target:"_blank",rel:"noopener noreferrer"},yn=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostObjectSample</span> <span class="token punctuation">{</span>
    <span class="token comment">// 上传文件</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> localFilePath <span class="token operator">=</span> <span class="token string">&quot;&lt;yourLocalFile&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置存储空间名称。</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置文件名称。</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 表单上传。
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token class-name">PostObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在URL中添加存储空间名称，添加后URL如下：http://yourBucketName.oss-cn-hangzhou.aliyuncs.com。</span>
        <span class="token class-name">String</span> urlStr <span class="token operator">=</span> endpoint<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;http://&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://&quot;</span> <span class="token operator">+</span> bucketName<span class="token operator">+</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置表单Map。</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> formFields <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置文件名称。</span>
        formFields<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置Content-Disposition。</span>
        formFields<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Disposition&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;attachment;filename=&quot;</span>
                <span class="token operator">+</span> localFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置回调参数。</span>
        <span class="token class-name">Callback</span> callback <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置回调服务器地址，如http://oss-demo.aliyuncs.com:23450或http://127.0.0.1:9090。</span>
        callback<span class="token punctuation">.</span><span class="token function">setCallbackUrl</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourCallbackServerUrl&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置回调请求消息头中Host的值，如oss-cn-hangzhou.aliyuncs.com。</span>
        callback<span class="token punctuation">.</span><span class="token function">setCallbackHost</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourCallbackServerHost&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置发起回调时请求body的值。</span>
        callback<span class="token punctuation">.</span><span class="token function">setCallbackBody</span><span class="token punctuation">(</span><span class="token string">&quot;{\\\\\\&quot;mimeType\\\\\\&quot;:\${mimeType},\\\\\\&quot;size\\\\\\&quot;:\${size}}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置发起回调请求的Content-Type。</span>
        callback<span class="token punctuation">.</span><span class="token function">setCalbackBodyType</span><span class="token punctuation">(</span><span class="token class-name">CalbackBodyType</span><span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置发起回调请求的自定义参数，由Key和Value组成，Key必须以x:开始，且必须小写。</span>
        callback<span class="token punctuation">.</span><span class="token function">addCallbackVar</span><span class="token punctuation">(</span><span class="token string">&quot;x:var1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        callback<span class="token punctuation">.</span><span class="token function">addCallbackVar</span><span class="token punctuation">(</span><span class="token string">&quot;x:var2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 在表单Map中设置回调参数。</span>
        <span class="token function">setCallBack</span><span class="token punctuation">(</span>formFields<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置OSSAccessKeyId。</span>
        formFields<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;OSSAccessKeyId&quot;</span><span class="token punctuation">,</span> accessKeyId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> policy <span class="token operator">=</span> <span class="token string">&quot;{\\&quot;expiration\\&quot;: \\&quot;2120-01-01T12:00:00.000Z\\&quot;,\\&quot;conditions\\&quot;: [[\\&quot;content-length-range\\&quot;, 0, 104857600]]}&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> encodePolicy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">encodeBase64</span><span class="token punctuation">(</span>policy<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置policy。</span>
        formFields<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;policy&quot;</span><span class="token punctuation">,</span> encodePolicy<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 生成签名。</span>
        <span class="token class-name">String</span> signaturecom <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>oss<span class="token punctuation">.</span>common<span class="token punctuation">.</span>auth<span class="token punctuation">.</span></span>ServiceSignature</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">computeSignature</span><span class="token punctuation">(</span>accessKeySecret<span class="token punctuation">,</span> encodePolicy<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置签名。</span>
        formFields<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;Signature&quot;</span><span class="token punctuation">,</span> signaturecom<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> ret <span class="token operator">=</span> <span class="token function">formUpload</span><span class="token punctuation">(</span>urlStr<span class="token punctuation">,</span> formFields<span class="token punctuation">,</span> localFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Post Object [&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>objectName <span class="token operator">+</span> <span class="token string">&quot;] to bucket [&quot;</span> <span class="token operator">+</span> bucketName <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;post reponse:&quot;</span> <span class="token operator">+</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">formUpload</span><span class="token punctuation">(</span><span class="token class-name">String</span> urlStr<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> formFields<span class="token punctuation">,</span> <span class="token class-name">String</span> localFile<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> res <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpURLConnection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> boundary <span class="token operator">=</span> <span class="token string">&quot;9431149156168&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>urlStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpURLConnection</span><span class="token punctuation">)</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn<span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn<span class="token punctuation">.</span><span class="token function">setReadTimeout</span><span class="token punctuation">(</span><span class="token number">30000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn<span class="token punctuation">.</span><span class="token function">setDoOutput</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn<span class="token punctuation">.</span><span class="token function">setDoInput</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn<span class="token punctuation">.</span><span class="token function">setRequestMethod</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn<span class="token punctuation">.</span><span class="token function">setRequestProperty</span><span class="token punctuation">(</span><span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">,</span> 
                    <span class="token string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; zh-CN; rv:1.9.2.6)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置MD5值。MD5值由整个body计算得出。</span>
            conn<span class="token punctuation">.</span><span class="token function">setRequestProperty</span><span class="token punctuation">(</span><span class="token string">&quot;Content-MD5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourContentMD5&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn<span class="token punctuation">.</span><span class="token function">setRequestProperty</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;multipart/form-data; boundary=&quot;</span> <span class="token operator">+</span> boundary<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>conn<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 遍历读取表单Map中的数据，将数据写入到输出流中。</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>formFields <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">StringBuffer</span> strBuf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> iter <span class="token operator">=</span> formFields<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> inputName <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> inputValue <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>inputValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">continue</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        strBuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;--&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>boundary<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\\r\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        strBuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Disposition: form-data; name=\\&quot;&quot;</span>
                                <span class="token operator">+</span> inputName <span class="token operator">+</span> <span class="token string">&quot;\\&quot;\\r\\n\\r\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        strBuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>inputValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        strBuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\\r\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;--&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>boundary<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\\r\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        strBuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Disposition: form-data; name=\\&quot;&quot;</span>
                                <span class="token operator">+</span> inputName <span class="token operator">+</span> <span class="token string">&quot;\\&quot;\\r\\n\\r\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        strBuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>inputValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    i<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>strBuf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 读取文件信息，将要上传的文件写入到输出流中。</span>
            <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>localFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> filename <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> contentType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MimetypesFileTypeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>contentType <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> contentType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                contentType <span class="token operator">=</span> <span class="token string">&quot;application/octet-stream&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">StringBuffer</span> strBuf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            strBuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\\r\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;--&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>boundary<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\\r\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            strBuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Disposition: form-data; name=\\&quot;file\\&quot;; &quot;</span>
                    <span class="token operator">+</span> <span class="token string">&quot;filename=\\&quot;&quot;</span> <span class="token operator">+</span> filename <span class="token operator">+</span> <span class="token string">&quot;\\&quot;\\r\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            strBuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type: &quot;</span> <span class="token operator">+</span> contentType <span class="token operator">+</span> <span class="token string">&quot;\\r\\n\\r\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>strBuf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> bytes <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bufferOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>bytes <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bufferOut<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bufferOut<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> endData <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;\\r\\n--&quot;</span> <span class="token operator">+</span> boundary <span class="token operator">+</span> <span class="token string">&quot;--\\r\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>endData<span class="token punctuation">)</span><span class="token punctuation">;</span>
            out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 读取返回数据。</span>
            strBuf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>conn<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> line <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                strBuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            res <span class="token operator">=</span> strBuf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            reader <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Send post request exception: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                conn<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
     <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setCallBack</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> formFields<span class="token punctuation">,</span> <span class="token class-name">Callback</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>callback <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> jsonCb <span class="token operator">=</span> <span class="token class-name">OSSUtils</span><span class="token punctuation">.</span><span class="token function">jsonizeCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> base64Cb <span class="token operator">=</span> <span class="token class-name">BinaryUtil</span><span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>jsonCb<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            formFields<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;callback&quot;</span><span class="token punctuation">,</span> base64Cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">.</span><span class="token function">hasCallbackVar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> varMap <span class="token operator">=</span> callback<span class="token punctuation">.</span><span class="token function">getCallbackVar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> varMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    formFields<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">PostObjectSample</span> ossPostObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PostObjectSample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">ossPostObject<span class="token punctuation">.</span></span>PostObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),hn={id:"追加上传",tabindex:"-1"},Sn=n("a",{class:"header-anchor",href:"#追加上传","aria-hidden":"true"},"#",-1),qn={href:"https://help.aliyun.com/document_detail/84784.html",target:"_blank",rel:"noopener noreferrer"},fn=e(`<h3 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项" aria-hidden="true">#</a> 注意事项</h3><ul><li>当文件不存在时，调用AppendObject接口会创建一个追加类型文件。</li><li>当文件已存在时，如果文件为追加类型文件，且设置的追加位置和文件当前长度相等，则直接在该文件末尾追加内容；如果文件为追加类型文件，但是设置的追加位置和文件当前长度不相等，则抛出PositionNotEqualToLength异常；如果文件为非追加类型文件时，则抛出ObjectNotAppendable异常。</li><li>追加类型文件暂不支持CopyObject操作。</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Bucket名称，例如examplebucket。关于Bucket名称命名规范的更多信息，请参见Bucket。</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Object完整路径，例如exampledir/exampleobject.txt。Object完整路径中不能包含Bucket名称。关于Object名称命名规范的更多信息，请参见对象（Object）。</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;exampledir/exampleobject.txt&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> content1 <span class="token operator">=</span> <span class="token string">&quot;Hello OSS A \\n&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> content2 <span class="token operator">=</span> <span class="token string">&quot;Hello OSS B \\n&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> content3 <span class="token operator">=</span> <span class="token string">&quot;Hello OSS C \\n&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ObjectMetadata</span> meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 指定上传的内容类型。</span>
meta<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 指定该Object的网页缓存行为。</span>
<span class="token comment">//meta.setCacheControl(&quot;no-cache&quot;);</span>
<span class="token comment">// 指定该Object被下载时的名称。</span>
<span class="token comment">//meta.setContentDisposition(&quot;attachment;filename=oss_download.txt&quot;);</span>
<span class="token comment">// 指定该Object的内容编码格式。</span>
<span class="token comment">//meta.setContentEncoding(OSSConstants.DEFAULT_CHARSET_NAME);</span>
<span class="token comment">// 该请求头用于检查消息内容是否与发送时一致。</span>
<span class="token comment">//meta.setContentMD5(&quot;ohhnqLBJFiKkPSBO1eNaUA==&quot;);</span>
<span class="token comment">// 指定过期时间。</span>
<span class="token comment">//try {</span>
<span class="token comment">//    meta.setExpirationTime(DateUtil.parseRfc822Date(&quot;Wed, 08 Jul 2022 16:57:01 GMT&quot;));</span>
<span class="token comment">//} catch (ParseException e) {</span>
<span class="token comment">//    e.printStackTrace();</span>
<span class="token comment">//}</span>
<span class="token comment">// 指定服务器端加密方式。此处指定为OSS完全托管密钥进行加密（SSE-OSS）。</span>
<span class="token comment">//meta.setServerSideEncryption(ObjectMetadata.AES_256_SERVER_SIDE_ENCRYPTION);</span>
<span class="token comment">// 指定Object的访问权限。此处指定为私有访问权限。</span>
<span class="token comment">//meta.setObjectAcl(CannedAccessControlList.Private);</span>
<span class="token comment">// 指定Object的存储类型。</span>
<span class="token comment">//meta.setHeader(OSSHeaders.OSS_STORAGE_CLASS, StorageClass.Standard);</span>
<span class="token comment">// 创建AppendObject时可以添加x-oss-meta-*，继续追加时不可以携带此参数。如果配置以x-oss-meta-*为前缀的参数，则该参数视为元数据。</span>
<span class="token comment">//meta.setHeader(&quot;x-oss-meta-author&quot;, &quot;Alice&quot;);</span>

<span class="token comment">// 通过AppendObjectRequest设置多个参数。</span>
<span class="token class-name">AppendObjectRequest</span> appendObjectRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AppendObjectRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>content1<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>meta<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 通过AppendObjectRequest设置单个参数。</span>
<span class="token comment">// 设置Bucket名称。</span>
<span class="token comment">//appendObjectRequest.setBucketName(bucketName);</span>
<span class="token comment">// 设置Object名称。</span>
<span class="token comment">//appendObjectRequest.setKey(objectName);</span>
<span class="token comment">// 设置待追加的内容。可选类型包括InputStream类型和File类型。此处为InputStream类型。</span>
<span class="token comment">//appendObjectRequest.setInputStream(new ByteArrayInputStream(content1.getBytes()));</span>
<span class="token comment">// 设置待追加的内容。可选类型包括InputStream类型和File类型。此处为File类型。</span>
<span class="token comment">//appendObjectRequest.setFile(new File(&quot;D:\\\\localpath\\\\examplefile.txt&quot;));</span>
<span class="token comment">// 指定文件的元信息，第一次追加时有效。</span>
<span class="token comment">//appendObjectRequest.setMetadata(meta);</span>

<span class="token comment">// 第一次追加。</span>
<span class="token comment">// 设置文件的追加位置。</span>
appendObjectRequest<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">AppendObjectResult</span> appendObjectResult <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">appendObject</span><span class="token punctuation">(</span>appendObjectRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 文件的64位CRC值。此值根据ECMA-182标准计算得出。</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>appendObjectResult<span class="token punctuation">.</span><span class="token function">getObjectCRC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 第二次追加。</span>
<span class="token comment">// nextPosition表示下一次请求中应当提供的Position，即文件当前的长度。</span>
appendObjectRequest<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span>appendObjectResult<span class="token punctuation">.</span><span class="token function">getNextPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
appendObjectRequest<span class="token punctuation">.</span><span class="token function">setInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>content2<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
appendObjectResult <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">appendObject</span><span class="token punctuation">(</span>appendObjectRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 第三次追加。</span>
appendObjectRequest<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span>appendObjectResult<span class="token punctuation">.</span><span class="token function">getNextPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
appendObjectRequest<span class="token punctuation">.</span><span class="token function">setInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>content3<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
appendObjectResult <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">appendObject</span><span class="token punctuation">(</span>appendObjectRequest<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),wn={id:"断点续传上传",tabindex:"-1"},jn=n("a",{class:"header-anchor",href:"#断点续传上传","aria-hidden":"true"},"#",-1),Rn={href:"https://help.aliyun.com/document_detail/84785.html",target:"_blank",rel:"noopener noreferrer"},On=e(`<h3 id="参数" tabindex="-1"><a class="header-anchor" href="#参数" aria-hidden="true">#</a> 参数</h3><p>您可以通过ossClient.uploadFile方法实现断点续传上传。此方法的uploadFileRequest请求包含的参数请参见下表。</p><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>BucketName</td><td>存储空间名称。</td></tr><tr><td>Key</td><td>上传到OSS的文件名称。</td></tr><tr><td>UploadFile</td><td>待上传的本地文件路径。</td></tr><tr><td>TaskNum</td><td>上传并发线程数，默认值为1。</td></tr><tr><td>PartSize</td><td>上传的分片大小，单位为Byte，取值范围为100 KB~5 GB。默认值为100 KB。</td></tr><tr><td>EnableCheckpoint</td><td>是否开启断点续传功能，默认关闭。</td></tr><tr><td>CheckpointFile</td><td>记录本地分片上传结果的文件。上传过程中的进度信息会保存在该文件中，如果某一分片上传失败，再次上传时会根据文件中记录的点继续上传。上传完成后，该文件会被删除。如果未设置该值，默认与待上传的本地文件同路径，名称为\${uploadFile}.ucp。</td></tr><tr><td>Callback</td><td>使用上传回调。关于上传回调的更多信息</td></tr></tbody></table><h3 id="示例" tabindex="-1"><a class="header-anchor" href="#示例" aria-hidden="true">#</a> 示例</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">/// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ObjectMetadata</span> meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 指定上传的内容类型。</span>
meta<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 文件上传时设置访问权限ACL。</span>
<span class="token comment">// meta.setObjectAcl(CannedAccessControlList.Private);</span>

<span class="token comment">// 通过UploadFileRequest设置多个参数。</span>
<span class="token comment">// 填写Bucket名称和Object完整路径。Object完整路径中不能包含Bucket名称。</span>
<span class="token class-name">UploadFileRequest</span> uploadFileRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UploadFileRequest</span><span class="token punctuation">(</span><span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;exampleobject.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 通过UploadFileRequest设置单个参数。</span>
<span class="token comment">// 填写Bucket名称。</span>
<span class="token comment">//uploadFileRequest.setBucketName(&quot;examplebucket&quot;);</span>
<span class="token comment">// 填写Object完整路径。Object完整路径中不能包含Bucket名称。</span>
<span class="token comment">//uploadFileRequest.setKey(&quot;exampleobject.txt&quot;);</span>
<span class="token comment">// 填写本地文件的完整路径。如果未指定本地路径，则默认从示例程序所属项目对应本地路径中上传文件。</span>
uploadFileRequest<span class="token punctuation">.</span><span class="token function">setUploadFile</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\\\localpath\\\\examplefile.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 指定上传并发线程数，默认值为1。</span>
uploadFileRequest<span class="token punctuation">.</span><span class="token function">setTaskNum</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 指定上传的分片大小。</span>
uploadFileRequest<span class="token punctuation">.</span><span class="token function">setPartSize</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 开启断点续传，默认关闭。</span>
uploadFileRequest<span class="token punctuation">.</span><span class="token function">setEnableCheckpoint</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 记录本地分片上传结果的文件。上传过程中的进度信息会保存在该文件中。</span>
uploadFileRequest<span class="token punctuation">.</span><span class="token function">setCheckpointFile</span><span class="token punctuation">(</span><span class="token string">&quot;yourCheckpointFile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 文件的元数据。</span>
uploadFileRequest<span class="token punctuation">.</span><span class="token function">setObjectMetadata</span><span class="token punctuation">(</span>meta<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置上传成功回调，参数为Callback类型。</span>
<span class="token comment">//uploadFileRequest.setCallback(&quot;yourCallbackEvent&quot;);</span>

<span class="token comment">// 断点续传上传。</span>
ossClient<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span>uploadFileRequest<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),xn={id:"分片上传",tabindex:"-1"},_n=n("a",{class:"header-anchor",href:"#分片上传","aria-hidden":"true"},"#",-1),Cn={href:"https://help.aliyun.com/document_detail/84786.html",target:"_blank",rel:"noopener noreferrer"},An=e(`<h3 id="分片上传流程" tabindex="-1"><a class="header-anchor" href="#分片上传流程" aria-hidden="true">#</a> 分片上传流程</h3><p>分片上传（Multipart Upload）分为以下三个步骤：</p><ol><li><p>初始化一个分片上传事件。</p><p>调用ossClient.initiateMultipartUpload方法返回OSS创建的全局唯一的uploadId。</p></li><li><p>上传分片。</p><p>调用ossClient.uploadPart方法上传分片数据。</p><p><strong>说明</strong></p><ul><li>对于同一个uploadId，分片号（PartNumber）标识了该分片在整个文件内的相对位置。如果使用同一个分片号上传了新的数据，则OSS上该分片已有的数据将会被覆盖。</li><li>OSS将收到的分片数据的MD5值放在ETag头内返回给用户。</li><li>OSS计算上传数据的MD5值，并与SDK计算的MD5值比较，如果不一致则返回InvalidDigest错误码。</li></ul></li><li><p>完成分片上传。</p><p>所有分片上传完成后，调用ossClient.completeMultipartUpload方法将所有分片合并成完整的文件。</p></li></ol><h3 id="分片上传完整示例" tabindex="-1"><a class="header-anchor" href="#分片上传完整示例" aria-hidden="true">#</a> 分片上传完整示例</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Object完整路径，例如exampledir/exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;exampledir/exampleobject.txt&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建InitiateMultipartUploadRequest对象。</span>
<span class="token class-name">InitiateMultipartUploadRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InitiateMultipartUploadRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 如果需要在初始化分片时设置请求头，请参考以下示例代码。</span>
<span class="token comment">// ObjectMetadata metadata = new ObjectMetadata();</span>
<span class="token comment">// metadata.setHeader(OSSHeaders.OSS_STORAGE_CLASS, StorageClass.Standard.toString());</span>
<span class="token comment">// 指定该Object的网页缓存行为。</span>
<span class="token comment">// metadata.setCacheControl(&quot;no-cache&quot;);</span>
<span class="token comment">// 指定该Object被下载时的名称。</span>
<span class="token comment">// metadata.setContentDisposition(&quot;attachment;filename=oss_MultipartUpload.txt&quot;);</span>
<span class="token comment">// 指定该Object的内容编码格式。</span>
<span class="token comment">// metadata.setContentEncoding(OSSConstants.DEFAULT_CHARSET_NAME);</span>
<span class="token comment">// 指定过期时间，单位为毫秒。</span>
<span class="token comment">// metadata.setHeader(HttpHeaders.EXPIRES, &quot;1000&quot;);</span>
<span class="token comment">// 指定初始化分片上传时是否覆盖同名Object。此处设置为true，表示禁止覆盖同名Object。</span>
<span class="token comment">// metadata.setHeader(&quot;x-oss-forbid-overwrite&quot;, &quot;true&quot;);</span>
<span class="token comment">// 指定上传该Object的每个part时使用的服务器端加密方式。</span>
<span class="token comment">// metadata.setHeader(OSSHeaders.OSS_SERVER_SIDE_ENCRYPTION, ObjectMetadata.KMS_SERVER_SIDE_ENCRYPTION);</span>
<span class="token comment">// 指定Object的加密算法。如果未指定此选项，表明Object使用AES256加密算法。</span>
<span class="token comment">// metadata.setHeader(OSSHeaders.OSS_SERVER_SIDE_DATA_ENCRYPTION, ObjectMetadata.KMS_SERVER_SIDE_ENCRYPTION);</span>
<span class="token comment">// 指定KMS托管的用户主密钥。</span>
<span class="token comment">// metadata.setHeader(OSSHeaders.OSS_SERVER_SIDE_ENCRYPTION_KEY_ID, &quot;9468da86-3509-4f8d-a61e-6eab1eac****&quot;);</span>
<span class="token comment">// 指定Object的存储类型。</span>
<span class="token comment">// metadata.setHeader(OSSHeaders.OSS_STORAGE_CLASS, StorageClass.Standard);</span>
<span class="token comment">// 指定Object的对象标签，可同时设置多个标签。</span>
<span class="token comment">// metadata.setHeader(OSSHeaders.OSS_TAGGING, &quot;a:1&quot;);</span>
<span class="token comment">// request.setObjectMetadata(metadata);</span>

<span class="token comment">// 初始化分片。</span>
<span class="token class-name">InitiateMultipartUploadResult</span> upresult <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">initiateMultipartUpload</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回uploadId，它是分片上传事件的唯一标识。您可以根据该uploadId发起相关的操作，例如取消分片上传、查询分片上传等。</span>
<span class="token class-name">String</span> uploadId <span class="token operator">=</span> upresult<span class="token punctuation">.</span><span class="token function">getUploadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// partETags是PartETag的集合。PartETag由分片的ETag和分片号组成。</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PartETag</span><span class="token punctuation">&gt;</span></span> partETags <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PartETag</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 每个分片的大小，用于计算文件有多少个分片。单位为字节。</span>
<span class="token keyword">final</span> <span class="token keyword">long</span> partSize <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024L</span><span class="token punctuation">;</span>   <span class="token comment">//1 MB。</span>

<span class="token comment">// 填写本地文件的完整路径。如果未指定本地路径，则默认从示例程序所属项目对应本地路径中上传文件。</span>
<span class="token keyword">final</span> <span class="token class-name">File</span> sampleFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\\\localpath\\\\examplefile.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> fileLength <span class="token operator">=</span> sampleFile<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> partCount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>fileLength <span class="token operator">/</span> partSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>fileLength <span class="token operator">%</span> partSize <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    partCount<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 遍历分片上传。</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> partCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> startPos <span class="token operator">=</span> i <span class="token operator">*</span> partSize<span class="token punctuation">;</span>
    <span class="token keyword">long</span> curPartSize <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">==</span> partCount<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>fileLength <span class="token operator">-</span> startPos<span class="token punctuation">)</span> <span class="token operator">:</span> partSize<span class="token punctuation">;</span>
    <span class="token class-name">InputStream</span> instream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>sampleFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 跳过已经上传的分片。</span>
    instream<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span>startPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UploadPartRequest</span> uploadPartRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UploadPartRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadPartRequest<span class="token punctuation">.</span><span class="token function">setBucketName</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadPartRequest<span class="token punctuation">.</span><span class="token function">setKey</span><span class="token punctuation">(</span>objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadPartRequest<span class="token punctuation">.</span><span class="token function">setUploadId</span><span class="token punctuation">(</span>uploadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadPartRequest<span class="token punctuation">.</span><span class="token function">setInputStream</span><span class="token punctuation">(</span>instream<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置分片大小。除了最后一个分片没有大小限制，其他的分片最小为100 KB。</span>
    uploadPartRequest<span class="token punctuation">.</span><span class="token function">setPartSize</span><span class="token punctuation">(</span>curPartSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置分片号。每一个上传的分片都有一个分片号，取值范围是1~10000，如果超出此范围，OSS将返回InvalidArgument错误码。</span>
    uploadPartRequest<span class="token punctuation">.</span><span class="token function">setPartNumber</span><span class="token punctuation">(</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 每个分片不需要按顺序上传，甚至可以在不同客户端上传，OSS会按照分片号排序组成完整的文件。</span>
    <span class="token class-name">UploadPartResult</span> uploadPartResult <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">uploadPart</span><span class="token punctuation">(</span>uploadPartRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 每次上传分片之后，OSS的返回结果包含PartETag。PartETag将被保存在partETags中。</span>
    partETags<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>uploadPartResult<span class="token punctuation">.</span><span class="token function">getPartETag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// 创建CompleteMultipartUploadRequest对象。</span>
<span class="token comment">// 在执行完成分片上传操作时，需要提供所有有效的partETags。OSS收到提交的partETags后，会逐一验证每个分片的有效性。当所有的数据分片验证通过后，OSS将把这些分片组合成一个完整的文件。</span>
<span class="token class-name">CompleteMultipartUploadRequest</span> completeMultipartUploadRequest <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">CompleteMultipartUploadRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> uploadId<span class="token punctuation">,</span> partETags<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 如果需要在完成分片上传的同时设置文件访问权限，请参考以下示例代码。</span>
<span class="token comment">// completeMultipartUploadRequest.setObjectACL(CannedAccessControlList.Private);</span>
<span class="token comment">// 指定是否列举当前UploadId已上传的所有Part。如果通过服务端List分片数据来合并完整文件时，以上CompleteMultipartUploadRequest中的partETags可为null。</span>
<span class="token comment">// Map&lt;String, String&gt; headers = new HashMap&lt;String, String&gt;();</span>
<span class="token comment">// 如果指定了x-oss-complete-all:yes，则OSS会列举当前UploadId已上传的所有Part，然后按照PartNumber的序号排序并执行CompleteMultipartUpload操作。</span>
<span class="token comment">// 如果指定了x-oss-complete-all:yes，则不允许继续指定body，否则报错。</span>
<span class="token comment">// headers.put(&quot;x-oss-complete-all&quot;,&quot;yes&quot;);</span>
<span class="token comment">// completeMultipartUploadRequest.setHeaders(headers);</span>

<span class="token comment">// 完成分片上传。</span>
<span class="token class-name">CompleteMultipartUploadResult</span> completeMultipartUploadResult <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">completeMultipartUpload</span><span class="token punctuation">(</span>completeMultipartUploadRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>completeMultipartUploadResult<span class="token punctuation">.</span><span class="token function">getETag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="取消分片上传事件" tabindex="-1"><a class="header-anchor" href="#取消分片上传事件" aria-hidden="true">#</a> 取消分片上传事件</h3><p>您可以调用ossClient.abortMultipartUpload方法来取消分片上传事件。当一个分片上传事件被取消后，无法再使用该uploadId进行任何操作，已上传的分片数据会被删除。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Object完整路径，例如exampledir/exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;exampledir/exampleobject.txt&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写uploadId，例如0004B999EF518A1FE585B0C9360D****。uploadId来自于InitiateMultipartUpload返回的结果。</span>
<span class="token class-name">String</span> uploadId <span class="token operator">=</span> <span class="token string">&quot;0004B999EF518A1FE585B0C9360D****&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 取消分片上传。</span>
<span class="token class-name">AbortMultipartUploadRequest</span> abortMultipartUploadRequest <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">AbortMultipartUploadRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> uploadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
ossClient<span class="token punctuation">.</span><span class="token function">abortMultipartUpload</span><span class="token punctuation">(</span>abortMultipartUploadRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

         
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="列举已上传的分片" tabindex="-1"><a class="header-anchor" href="#列举已上传的分片" aria-hidden="true">#</a> 列举已上传的分片</h3><h4 id="简单列举已上传的分片" tabindex="-1"><a class="header-anchor" href="#简单列举已上传的分片" aria-hidden="true">#</a> 简单列举已上传的分片</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Object完整路径，例如exampledir/exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;exampledir/exampleobject.txt&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写uploadId，例如0004B999EF518A1FE585B0C9360D****。uploadId来自于InitiateMultipartUpload返回的结果。</span>
<span class="token class-name">String</span> uploadId <span class="token operator">=</span> <span class="token string">&quot;0004B999EF518A1FE585B0C9360D****&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 列举已上传的分片。</span>
<span class="token class-name">ListPartsRequest</span> listPartsRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListPartsRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> uploadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置uploadId。</span>
<span class="token comment">//listPartsRequest.setUploadId(uploadId);</span>
<span class="token comment">// 设置分页时每一页中分片数量为100个。默认列举1000个分片。</span>
listPartsRequest<span class="token punctuation">.</span><span class="token function">setMaxParts</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 指定List的起始位置。只有分片号大于此参数值的分片会被列举。</span>
listPartsRequest<span class="token punctuation">.</span><span class="token function">setPartNumberMarker</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">PartListing</span> partListing <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">listParts</span><span class="token punctuation">(</span>listPartsRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PartSummary</span> part <span class="token operator">:</span> partListing<span class="token punctuation">.</span><span class="token function">getParts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取分片号。</span>
    part<span class="token punctuation">.</span><span class="token function">getPartNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取分片数据大小。</span>
    part<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取分片的ETag。</span>
    part<span class="token punctuation">.</span><span class="token function">getETag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取分片的最后修改时间。</span>
    part<span class="token punctuation">.</span><span class="token function">getLastModified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="列举所有已上传的分片" tabindex="-1"><a class="header-anchor" href="#列举所有已上传的分片" aria-hidden="true">#</a> 列举所有已上传的分片</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Object完整路径，例如exampledir/exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;exampledir/exampleobject.txt&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写uploadId，例如0004B999EF518A1FE585B0C9360D****。uploadId来自于InitiateMultipartUpload返回的结果。</span>
<span class="token class-name">String</span> uploadId <span class="token operator">=</span> <span class="token string">&quot;0004B999EF518A1FE585B0C9360D****&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 列举所有已上传的分片。</span>
<span class="token class-name">PartListing</span> partListing<span class="token punctuation">;</span>
<span class="token class-name">ListPartsRequest</span> listPartsRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListPartsRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> uploadId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">do</span> <span class="token punctuation">{</span>
    partListing <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">listParts</span><span class="token punctuation">(</span>listPartsRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PartSummary</span> part <span class="token operator">:</span> partListing<span class="token punctuation">.</span><span class="token function">getParts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取分片号。</span>
        part<span class="token punctuation">.</span><span class="token function">getPartNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取分片数据大小。</span>
        part<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取分片的ETag。</span>
        part<span class="token punctuation">.</span><span class="token function">getETag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取分片的最后修改时间。</span>
        part<span class="token punctuation">.</span><span class="token function">getLastModified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">// 指定List的起始位置，只有分片号大于此参数值的分片会被列出。</span>
listPartsRequest<span class="token punctuation">.</span><span class="token function">setPartNumberMarker</span><span class="token punctuation">(</span>partListing<span class="token punctuation">.</span><span class="token function">getNextPartNumberMarker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>partListing<span class="token punctuation">.</span><span class="token function">isTruncated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="分页列举所有已上传的分片" tabindex="-1"><a class="header-anchor" href="#分页列举所有已上传的分片" aria-hidden="true">#</a> 分页列举所有已上传的分片</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Object完整路径，例如exampledir/exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;exampledir/exampleobject.txt&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写uploadId，例如0004B999EF518A1FE585B0C9360D****。uploadId来自于InitiateMultipartUpload返回的结果。</span>
<span class="token class-name">String</span> uploadId <span class="token operator">=</span> <span class="token string">&quot;0004B999EF518A1FE585B0C9360D****&quot;</span><span class="token punctuation">;</span>


<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 分页列举已上传的分片。</span>
<span class="token class-name">PartListing</span> partListing<span class="token punctuation">;</span>
<span class="token class-name">ListPartsRequest</span> listPartsRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListPartsRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> uploadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置分页列举时，每页列举100个分片。</span>
listPartsRequest<span class="token punctuation">.</span><span class="token function">setMaxParts</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">do</span> <span class="token punctuation">{</span>
    partListing <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">listParts</span><span class="token punctuation">(</span>listPartsRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PartSummary</span> part <span class="token operator">:</span> partListing<span class="token punctuation">.</span><span class="token function">getParts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取分片号。</span>
        part<span class="token punctuation">.</span><span class="token function">getPartNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取分片数据大小。</span>
        part<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取分片的ETag。</span>
        part<span class="token punctuation">.</span><span class="token function">getETag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取分片的最后修改时间。</span>
        part<span class="token punctuation">.</span><span class="token function">getLastModified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    listPartsRequest<span class="token punctuation">.</span><span class="token function">setPartNumberMarker</span><span class="token punctuation">(</span>partListing<span class="token punctuation">.</span><span class="token function">getNextPartNumberMarker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>partListing<span class="token punctuation">.</span><span class="token function">isTruncated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="列举分片上传事件" tabindex="-1"><a class="header-anchor" href="#列举分片上传事件" aria-hidden="true">#</a> 列举分片上传事件</h3><table><thead><tr><th>参数</th><th>作用</th><th>设置方法</th></tr></thead><tbody><tr><td>prefix</td><td>限定返回的文件名称必须以指定的prefix作为前缀。注意使用prefix查询时，返回的文件名称中仍会包含prefix。</td><td>ListMultipartUploadsRequest.setPrefix(String prefix)</td></tr><tr><td>delimiter</td><td>用于对文件名称进行分组的一个字符。所有名称包含指定的前缀且第一次出现delimiter字符之间的文件作为一组元素。</td><td>ListMultipartUploadsRequest.setDelimiter(String delimiter)</td></tr><tr><td>maxUploads</td><td>限定此次返回分片上传事件的最大个数，默认值和最大值均为1000。</td><td>ListMultipartUploadsRequest.setMaxUploads(Integer maxUploads)</td></tr><tr><td>keyMarker</td><td>所有文件名称的字典序大于keyMarker参数值的分片上传事件。与uploadIdMarker参数一同使用，用于指定返回结果的起始位置。</td><td>ListMultipartUploadsRequest.setKeyMarker(String keyMarker)</td></tr><tr><td>uploadIdMarker</td><td>与keyMarker参数一同使用，用于指定返回结果的起始位置。 如果未设置keyMarker参数，则此参数无效。如果设置了keyMarker参数，则查询结果中包含： 文件名称的字典序大于keyMarker参数值的所有文件。 文件名称等于keyMarker参数值且uploadId比uploadIdMarker参数值大的所有分片上传事件。</td><td>ListMultipartUploadsRequest.setUploadIdMarker(String uploadIdMarker)</td></tr></tbody></table><h4 id="简单列举分片上传事件" tabindex="-1"><a class="header-anchor" href="#简单列举分片上传事件" aria-hidden="true">#</a> 简单列举分片上传事件</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 列举分片上传事件。默认列举1000个分片。</span>
<span class="token class-name">ListMultipartUploadsRequest</span> listMultipartUploadsRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListMultipartUploadsRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">MultipartUploadListing</span> multipartUploadListing <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">listMultipartUploads</span><span class="token punctuation">(</span>listMultipartUploadsRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MultipartUpload</span> multipartUpload <span class="token operator">:</span> multipartUploadListing<span class="token punctuation">.</span><span class="token function">getMultipartUploads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取uploadId。</span>
    multipartUpload<span class="token punctuation">.</span><span class="token function">getUploadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取Key。</span>
    multipartUpload<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取分片上传的初始化时间。</span>
    multipartUpload<span class="token punctuation">.</span><span class="token function">getInitiated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="列举全部分片上传事件" tabindex="-1"><a class="header-anchor" href="#列举全部分片上传事件" aria-hidden="true">#</a> 列举全部分片上传事件</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 列举分片上传事件。</span>
<span class="token class-name">MultipartUploadListing</span> multipartUploadListing<span class="token punctuation">;</span>
<span class="token class-name">ListMultipartUploadsRequest</span> listMultipartUploadsRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListMultipartUploadsRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">do</span> <span class="token punctuation">{</span>
    multipartUploadListing <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">listMultipartUploads</span><span class="token punctuation">(</span>listMultipartUploadsRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MultipartUpload</span> multipartUpload <span class="token operator">:</span> multipartUploadListing<span class="token punctuation">.</span><span class="token function">getMultipartUploads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取uploadId。</span>
        multipartUpload<span class="token punctuation">.</span><span class="token function">getUploadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取文件名称。</span>
        multipartUpload<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取分片上传的初始化时间。</span>
        multipartUpload<span class="token punctuation">.</span><span class="token function">getInitiated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    listMultipartUploadsRequest<span class="token punctuation">.</span><span class="token function">setKeyMarker</span><span class="token punctuation">(</span>multipartUploadListing<span class="token punctuation">.</span><span class="token function">getNextKeyMarker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    listMultipartUploadsRequest<span class="token punctuation">.</span><span class="token function">setUploadIdMarker</span><span class="token punctuation">(</span>multipartUploadListing<span class="token punctuation">.</span><span class="token function">getNextUploadIdMarker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>multipartUploadListing<span class="token punctuation">.</span><span class="token function">isTruncated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="分页列举全部上传事件" tabindex="-1"><a class="header-anchor" href="#分页列举全部上传事件" aria-hidden="true">#</a> 分页列举全部上传事件</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 列举分片上传事件。</span>
<span class="token class-name">MultipartUploadListing</span> multipartUploadListing<span class="token punctuation">;</span>
<span class="token class-name">ListMultipartUploadsRequest</span> listMultipartUploadsRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListMultipartUploadsRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置每页列举的分片上传事件个数。</span>
listMultipartUploadsRequest<span class="token punctuation">.</span><span class="token function">setMaxUploads</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">do</span> <span class="token punctuation">{</span>
    multipartUploadListing <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">listMultipartUploads</span><span class="token punctuation">(</span>listMultipartUploadsRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MultipartUpload</span> multipartUpload <span class="token operator">:</span> multipartUploadListing<span class="token punctuation">.</span><span class="token function">getMultipartUploads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取uploadId。</span>
        multipartUpload<span class="token punctuation">.</span><span class="token function">getUploadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取Key。</span>
        multipartUpload<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取分片上传的初始化时间。</span>
        multipartUpload<span class="token punctuation">.</span><span class="token function">getInitiated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    listMultipartUploadsRequest<span class="token punctuation">.</span><span class="token function">setKeyMarker</span><span class="token punctuation">(</span>multipartUploadListing<span class="token punctuation">.</span><span class="token function">getNextKeyMarker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    listMultipartUploadsRequest<span class="token punctuation">.</span><span class="token function">setUploadIdMarker</span><span class="token punctuation">(</span>multipartUploadListing<span class="token punctuation">.</span><span class="token function">getNextUploadIdMarker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>multipartUploadListing<span class="token punctuation">.</span><span class="token function">isTruncated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,23),Kn={id:"进度条",tabindex:"-1"},Pn=n("a",{class:"header-anchor",href:"#进度条","aria-hidden":"true"},"#",-1),Mn={href:"https://help.aliyun.com/document_detail/84796.html",target:"_blank",rel:"noopener noreferrer"},En=e(`<p>ossClient.putObject、ossClient.getObject、ossClient.uploadPart、ossClient.uploadFile以及ossClient.downloadFile方法均支持进度条功能，使用方法与ossClient.putObject类似。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PutObjectProgressListener</span> <span class="token keyword">implements</span> <span class="token class-name">ProgressListener</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> bytesWritten <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> totalBytes <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> succeed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">progressChanged</span><span class="token punctuation">(</span><span class="token class-name">ProgressEvent</span> progressEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> bytes <span class="token operator">=</span> progressEvent<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ProgressEventType</span> eventType <span class="token operator">=</span> progressEvent<span class="token punctuation">.</span><span class="token function">getEventType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>eventType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token constant">TRANSFER_STARTED_EVENT</span><span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Start to upload......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">REQUEST_CONTENT_LENGTH_EVENT</span><span class="token operator">:</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>totalBytes <span class="token operator">=</span> bytes<span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>totalBytes <span class="token operator">+</span> <span class="token string">&quot; bytes in total will be uploaded to OSS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">REQUEST_BYTE_TRANSFER_EVENT</span><span class="token operator">:</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>bytesWritten <span class="token operator">+=</span> bytes<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>totalBytes <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> percent <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bytesWritten <span class="token operator">*</span> <span class="token number">100.0</span> <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bytes <span class="token operator">+</span> <span class="token string">&quot; bytes have been written at this time, upload progress: &quot;</span> <span class="token operator">+</span> percent <span class="token operator">+</span> <span class="token string">&quot;%(&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bytesWritten <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalBytes <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bytes <span class="token operator">+</span> <span class="token string">&quot; bytes have been written at this time, upload ratio: unknown&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;(&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bytesWritten <span class="token operator">+</span> <span class="token string">&quot;/...)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">TRANSFER_COMPLETED_EVENT</span><span class="token operator">:</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>succeed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Succeed to upload, &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bytesWritten <span class="token operator">+</span> <span class="token string">&quot; bytes have been transferred in total&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">TRANSFER_FAILED_EVENT</span><span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to upload, &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bytesWritten <span class="token operator">+</span> <span class="token string">&quot; bytes have been transferred&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSucceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> succeed<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
        <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
        <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建OSSClient实例。</span>
        <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 上传文件的同时指定了进度条参数。</span>
            ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PutObjectRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourLocalFile&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PutObjectRequest</span><span class="token punctuation">&gt;</span></span><span class="token function">withProgressListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PutObjectProgressListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),In={id:"上传回调",tabindex:"-1"},Bn=n("a",{class:"header-anchor",href:"#上传回调","aria-hidden":"true"},"#",-1),Nn={href:"https://help.aliyun.com/document_detail/84798.html",target:"_blank",rel:"noopener noreferrer"},Tn=n("a",{name:"上传回调"},null,-1),Un=e(`<p>OSS会在文件上传完成后，把文件上传信息通过此回调URL发送给应用服务器。</p><h3 id="例子1" tabindex="-1"><a class="header-anchor" href="#例子1" aria-hidden="true">#</a> 例子1</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 您的回调服务器地址，如http://oss-demo.aliyuncs.com:23450或http://127.0.0.1:9090。</span>
<span class="token class-name">String</span> callbackUrl <span class="token operator">=</span> <span class="token string">&quot;&lt;yourCallbackServerUrl&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">&quot;Hello OSS&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">PutObjectRequest</span> putObjectRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PutObjectRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 上传回调参数。</span>
<span class="token class-name">Callback</span> callback <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
callback<span class="token punctuation">.</span><span class="token function">setCallbackUrl</span><span class="token punctuation">(</span>callbackUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//（可选）设置回调请求消息头中Host的值，即您的服务器配置Host的值。</span>
<span class="token comment">// callback.setCallbackHost(&quot;yourCallbackHost&quot;);</span>
<span class="token comment">// 设置发起回调时请求body的值。</span>
callback<span class="token punctuation">.</span><span class="token function">setCallbackBody</span><span class="token punctuation">(</span><span class="token string">&quot;{\\\\\\&quot;mimeType\\\\\\&quot;:\${mimeType},\\\\\\&quot;size\\\\\\&quot;:\${size}}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置发起回调请求的Content-Type。</span>
callback<span class="token punctuation">.</span><span class="token function">setCalbackBodyType</span><span class="token punctuation">(</span><span class="token class-name">CalbackBodyType</span><span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置发起回调请求的自定义参数，由Key和Value组成，Key必须以x:开始。</span>
callback<span class="token punctuation">.</span><span class="token function">addCallbackVar</span><span class="token punctuation">(</span><span class="token string">&quot;x:var1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
callback<span class="token punctuation">.</span><span class="token function">addCallbackVar</span><span class="token punctuation">(</span><span class="token string">&quot;x:var2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
putObjectRequest<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">PutObjectResult</span> putObjectResult <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>putObjectRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 读取上传回调返回的消息内容。</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
putObjectResult<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 数据读取完成后，获取的流必须关闭，否则会造成连接泄漏，导致请求无连接可用，程序无法正常工作。</span>
putObjectResult<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="例子2" tabindex="-1"><a class="header-anchor" href="#例子2" aria-hidden="true">#</a> 例子2</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token class-name">VerifyOSSCallbackRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">String</span> ossCallbackBody<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">NumberFormatException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> ret <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> autorizationInput <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> pubKeyInput <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;x-oss-pub-key-url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> authorization <span class="token operator">=</span> <span class="token class-name">BinaryUtil</span><span class="token punctuation">.</span><span class="token function">fromBase64String</span><span class="token punctuation">(</span>autorizationInput<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pubKey <span class="token operator">=</span> <span class="token class-name">BinaryUtil</span><span class="token punctuation">.</span><span class="token function">fromBase64String</span><span class="token punctuation">(</span>pubKeyInput<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> pubKeyAddr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>pubKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pubKeyAddr<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;https://gosspublic.alicdn.com/&quot;</span><span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>pubKeyAddr<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;https://gosspublic.alicdn.com/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;pub key addr must be oss addrss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> retString <span class="token operator">=</span> <span class="token function">executeGet</span><span class="token punctuation">(</span>pubKeyAddr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        retString <span class="token operator">=</span> retString<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;-----BEGIN PUBLIC KEY-----&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        retString <span class="token operator">=</span> retString<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;-----END PUBLIC KEY-----&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> queryString <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> uri <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> decodeUri <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URLDecoder</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> authStr <span class="token operator">=</span> decodeUri<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>queryString <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>queryString<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            authStr <span class="token operator">+=</span> <span class="token string">&quot;?&quot;</span> <span class="token operator">+</span> queryString<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        authStr <span class="token operator">+=</span> <span class="token string">&quot;\\n&quot;</span> <span class="token operator">+</span> ossCallbackBody<span class="token punctuation">;</span>
        ret <span class="token operator">=</span> <span class="token function">doCheck</span><span class="token punctuation">(</span>authStr<span class="token punctuation">,</span> authorization<span class="token punctuation">,</span> retString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> ossCallbackBody <span class="token operator">=</span> <span class="token class-name">GetPostBody</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-length&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> ret <span class="token operator">=</span> <span class="token class-name">VerifyOSSCallbackRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> ossCallbackBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;verify result : &quot;</span> <span class="token operator">+</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// System.out.println(&quot;OSS Callback Body:&quot; + ossCallbackBody);</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">response</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token string">&quot;{\\&quot;Status\\&quot;:\\&quot;OK\\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span><span class="token punctuation">.</span><span class="token constant">SC_OK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">response</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token string">&quot;{\\&quot;Status\\&quot;:\\&quot;verify not ok\\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span><span class="token punctuation">.</span><span class="token constant">SC_BAD_REQUEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),Ln={href:"https://help.aliyun.com/document_detail/84822.html",target:"_blank",rel:"noopener noreferrer"},Dn={id:"流式下载",tabindex:"-1"},Fn=n("a",{class:"header-anchor",href:"#流式下载","aria-hidden":"true"},"#",-1),Hn={href:"https://help.aliyun.com/document_detail/84823.html",target:"_blank",rel:"noopener noreferrer"},zn=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Bucket名称。</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Object的完整路径。Object完整路径中不能包含Bucket名称。</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;exampleobject.txt&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ossObject包含文件所在的存储空间名称、文件名称、文件元信息以及一个输入流。</span>
<span class="token class-name">OSSObject</span> ossObject <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 读取文件内容。</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Object content:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>ossObject<span class="token punctuation">.</span><span class="token function">getObjectContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>line <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\\n&quot;</span> <span class="token operator">+</span> line<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 数据读取完成后，获取的流必须关闭，否则会造成连接泄漏，导致请求无连接可用，程序无法正常工作。</span>
reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),Vn={id:"下载到本地文件",tabindex:"-1"},Gn=n("a",{class:"header-anchor",href:"#下载到本地文件","aria-hidden":"true"},"#",-1),Xn={href:"https://help.aliyun.com/document_detail/84824.html",target:"_blank",rel:"noopener noreferrer"},Wn=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Bucket名称。</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写不包含Bucket名称在内的Object完整路径，例如testfolder/exampleobject.txt。</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;testfolder/exampleobject.txt&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 下载Object到本地文件，并保存到指定的本地路径中。如果指定的本地文件存在会覆盖，不存在则新建。</span>
<span class="token comment">// 如果未指定本地路径，则下载后的文件默认保存到示例程序所属项目对应本地路径中。</span>
ossClient<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GetObjectRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\\\localpath\\\\examplefile.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),Jn={id:"范围下载",tabindex:"-1"},$n=n("a",{class:"header-anchor",href:"#范围下载","aria-hidden":"true"},"#",-1),Yn={href:"https://help.aliyun.com/document_detail/84825.html",target:"_blank",rel:"noopener noreferrer"},Zn=e(`<h3 id="指定正常的下载范围" tabindex="-1"><a class="header-anchor" href="#指定正常的下载范围" aria-hidden="true">#</a> 指定正常的下载范围</h3><p>流式读取一次可能无法读取全部数据。如果您需要流式读取64 KB的数据，请使用如下的方式多次读取，直到读取到64 KB或者文件结束</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//&lt;yourObjectName&gt;表示从OSS下载文件时需要指定包含文件后缀在内的完整路径，例如abc/efg/123.jpg。</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">GetObjectRequest</span> getObjectRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetObjectRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 对于大小为1000 Bytes的文件，正常的字节范围为0~999。</span>
<span class="token comment">// 获取0~999字节范围内的数据，包括0和999，共1000个字节的数据。如果指定的范围无效（比如开始或结束位置的指定值为负数，或指定值大于文件大小），则下载整个文件。</span>
getObjectRequest<span class="token punctuation">.</span><span class="token function">setRange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 范围下载。</span>
<span class="token class-name">OSSObject</span> ossObject <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>getObjectRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 读取数据。</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name">InputStream</span> in <span class="token operator">=</span> ossObject<span class="token punctuation">.</span><span class="token function">getObjectContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    n <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 数据读取完成后，获取的流必须关闭，否则会造成连接泄漏，导致请求无连接可用，程序无法正常工作。</span>
in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="指定异常的下载范围" tabindex="-1"><a class="header-anchor" href="#指定异常的下载范围" aria-hidden="true">#</a> 指定异常的下载范围</h3><p>假设现有大小为1000 Bytes的Object，则指定的正常下载范围应为0~999。如果指定范围不在有效区间，会导致Range不生效，响应返回值为200，并传送整个Object的内容。请求不合法的示例及返回说明如下：</p><ul><li>若指定了Range: bytes=500~2000，此时范围末端取值不在有效区间，返回整个文件的内容，且HTTP Code为200。</li><li>若指定了Range: bytes=1000~2000，此时范围首端取值不在有效区间，返回整个文件的内容，且HTTP Code为200。</li></ul><h3 id="兼容行为范围下载" tabindex="-1"><a class="header-anchor" href="#兼容行为范围下载" aria-hidden="true">#</a> 兼容行为范围下载</h3><p>假设现有大小为1000 Bytes的Object，则指定的正常下载范围应为0~999。如果指定范围不在有效区间，会导致Range不生效，响应返回值为200，并传送整个Object的内容。请求不合法的示例及返回说明如下：</p><ul><li>若指定了Range: bytes=500~2000，此时范围末端取值不在有效区间，返回整个文件的内容，且HTTP Code为200。</li><li>若指定了Range: bytes=1000~2000，此时范围首端取值不在有效区间，返回整个文件的内容，且HTTP Code为200。</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 指定大小为1000 Bytes的文件。</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 指定兼容行为。</span>
<span class="token comment">// 范围末端取值不在有效区间，返回500~999字节范围内容，且HTTP Code为206。</span>
getObjectRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetObjectRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
getObjectRequest<span class="token punctuation">.</span><span class="token function">setRange</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
getObjectRequest<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token string">&quot;x-oss-range-behavior&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;standard&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">OSSObject</span> ossObject <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>getObjectRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
ossObject<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;standard get &quot;</span> <span class="token operator">+</span> <span class="token string">&quot;500~2000 &quot;</span><span class="token operator">+</span> <span class="token string">&quot;statusCode:&quot;</span>  <span class="token operator">+</span> ossObject<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;standard get &quot;</span> <span class="token operator">+</span> <span class="token string">&quot;500~2000 &quot;</span> <span class="token operator">+</span> <span class="token string">&quot;contentLength:&quot;</span> <span class="token operator">+</span> ossObject<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContentLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// 范围首端取值不在有效区间，以下代码会抛出异常。返回HTTP Code为416，错误码为InvalidRange。</span>
    getObjectRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetObjectRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    getObjectRequest<span class="token punctuation">.</span><span class="token function">setRange</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    getObjectRequest<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token string">&quot;x-oss-range-behavior&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;standard&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ossClient<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>getObjectRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">OSSException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;standard get &quot;</span> <span class="token operator">+</span> <span class="token string">&quot;1000~2000:&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;error code:&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getErrorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,10),Qn={id:"断点续传下载",tabindex:"-1"},ns=n("a",{class:"header-anchor",href:"#断点续传下载","aria-hidden":"true"},"#",-1),ss={href:"https://help.aliyun.com/document_detail/84827.html",target:"_blank",rel:"noopener noreferrer"},as=e(`<table><thead><tr><th>参数</th><th>是否必选</th><th>示例值</th><th>描述</th><th>如何设置</th></tr></thead><tbody><tr><td>bucketName</td><td>是</td><td>examplebucket</td><td>存储空间（Bucket）名称。</td><td>通过构造方法设置。</td></tr><tr><td>key</td><td>是</td><td>exampledir/exampleobject.txt</td><td>Object完整路径。Object完整路径中不能包含Bucket名称。</td><td>通过构造方法设置。</td></tr><tr><td>downloadFile</td><td>否</td><td>D:\\localpath\\examplefile.txt</td><td>本地文件的完整路径。OSS文件将下载到该本地文件。</td><td>通过构造方法或setDownloadFile设置。</td></tr><tr><td>partSize</td><td>否</td><td>1 * 1024 * 1024</td><td>分片大小，取值范围为1 B~5 GB。</td><td>通过setPartSize设置。</td></tr><tr><td>taskNum</td><td>否</td><td>10</td><td>分片下载的并发数。默认值为1。</td><td>通过setTaskNum设置。</td></tr><tr><td>enableCheckpoint</td><td>否</td><td>true</td><td>是否开启断点续传功能。取值范围如下： false（默认）：关闭 true：开启</td><td>通过setEnableCheckpoint设置。</td></tr><tr><td>checkpointFile</td><td>否</td><td>D:\\localpath\\examplefile.txt.dcp</td><td>记录本地分片下载结果的文件。开启断点续传功能时需要设置此参数。下载过程中的进度信息会保存在该文件中，如果某一分片下载失败，再次下载时会根据文件中记录的点继续下载。下载完成后，该文件会被删除。 文件默认名称为downloadFile.dcp，且与downloadFile处于相同路径。</td><td>通过setCheckpointFile设置。</td></tr></tbody></table><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Object完整路径，例如exampledir/exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;exampledir/exampleobject.txt&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 下载请求，10个任务并发下载，启动断点续传。</span>
<span class="token class-name">DownloadFileRequest</span> downloadFileRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DownloadFileRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
downloadFileRequest<span class="token punctuation">.</span><span class="token function">setDownloadFile</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\\\localpath\\\\examplefile.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
downloadFileRequest<span class="token punctuation">.</span><span class="token function">setPartSize</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
downloadFileRequest<span class="token punctuation">.</span><span class="token function">setTaskNum</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
downloadFileRequest<span class="token punctuation">.</span><span class="token function">setEnableCheckpoint</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置断点记录文件的完整路径。只有当Object下载中断产生了断点记录文件后，如果需要继续下载该Object，才需要设置对应的断点记录文件。</span>
<span class="token comment">//downloadFileRequest.setCheckpointFile(&quot;D:\\\\localpath\\\\examplefile.txt.dcp&quot;);</span>

<span class="token comment">// 下载文件。</span>
<span class="token class-name">DownloadFileResult</span> downloadRes <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">downloadFile</span><span class="token punctuation">(</span>downloadFileRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 下载成功时，会返回文件元信息。</span>
<span class="token class-name">ObjectMetadata</span> objectMetadata <span class="token operator">=</span> downloadRes<span class="token punctuation">.</span><span class="token function">getObjectMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>objectMetadata<span class="token punctuation">.</span><span class="token function">getETag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>objectMetadata<span class="token punctuation">.</span><span class="token function">getLastModified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>objectMetadata<span class="token punctuation">.</span><span class="token function">getUserMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;meta&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),ts={id:"限定条件下载",tabindex:"-1"},es=n("a",{class:"header-anchor",href:"#限定条件下载","aria-hidden":"true"},"#",-1),ps={href:"https://help.aliyun.com/document_detail/84828.html",target:"_blank",rel:"noopener noreferrer"},os=e(`<p>下载文件时，可以指定一个或多个限定条件。满足限定条件则下载，不满足则返回错误，不下载。可以使用的限定条件如下：</p><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>If-Modified-Since</td><td>如果指定的时间早于实际修改时间，则正常传输文件，否则返回错误（304 Not modified）。</td></tr><tr><td>If-Unmodified-Since</td><td>如果指定的时间等于或者晚于文件实际修改时间，则正常传输文件，否则返回错误（412 Precondition failed）。</td></tr><tr><td>If-Match</td><td>如果指定的ETag和OSS文件的ETag匹配，则正常传输文件，否则返回错误（412 Precondition failed）。</td></tr><tr><td>If-None-Match</td><td>如果指定的ETag和OSS文件的ETag不匹配，则正常传输文件，否则返回错误（304 Not modified）。</td></tr></tbody></table><p>If-Modified-Since和If-Unmodified-Since可以同时存在。If-Match和If-None-Match可以同时存在。</p><p>ETag可以通过ossClient.getObjectMeta方法获取。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录 https://ram.console.aliyun.com 创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">GetObjectRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetObjectRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置限定条件。</span>
request<span class="token punctuation">.</span><span class="token function">setModifiedSinceConstraint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 下载OSS文件到本地文件。</span>
ossClient<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourLocalFile&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),cs={id:"进度条-1",tabindex:"-1"},ls=n("a",{class:"header-anchor",href:"#进度条-1","aria-hidden":"true"},"#",-1),is={href:"https://help.aliyun.com/document_detail/84829.html",target:"_blank",rel:"noopener noreferrer"},us=e(`<p>ossClient.putObject、ossClient.getObject、ossClient.uploadPart、ossClient.uploadFile以及ossClient.downloadFile方法均支持进度条功能，使用方法与ossClient.getObject类似。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">GetObjectProgressListener</span> <span class="token keyword">implements</span> <span class="token class-name">ProgressListener</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">long</span> bytesRead <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">long</span> totalBytes <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">boolean</span> succeed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">progressChanged</span><span class="token punctuation">(</span><span class="token class-name">ProgressEvent</span> progressEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> bytes <span class="token operator">=</span> progressEvent<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ProgressEventType</span> eventType <span class="token operator">=</span> progressEvent<span class="token punctuation">.</span><span class="token function">getEventType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>eventType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token constant">TRANSFER_STARTED_EVENT</span><span class="token operator">:</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Start to download......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">RESPONSE_CONTENT_LENGTH_EVENT</span><span class="token operator">:</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>totalBytes <span class="token operator">=</span> bytes<span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>totalBytes <span class="token operator">+</span> <span class="token string">&quot; bytes in total will be downloaded to a local file&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">RESPONSE_BYTE_TRANSFER_EVENT</span><span class="token operator">:</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>bytesRead <span class="token operator">+=</span> bytes<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>totalBytes <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">int</span> percent <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bytesRead <span class="token operator">*</span> <span class="token number">100.0</span> <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bytes <span class="token operator">+</span> <span class="token string">&quot; bytes have been read at this time, download progress: &quot;</span> <span class="token operator">+</span>
                            percent <span class="token operator">+</span> <span class="token string">&quot;%(&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bytesRead <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalBytes <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bytes <span class="token operator">+</span> <span class="token string">&quot; bytes have been read at this time, download ratio: unknown&quot;</span> <span class="token operator">+</span>
                            <span class="token string">&quot;(&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bytesRead <span class="token operator">+</span> <span class="token string">&quot;/...)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">TRANSFER_COMPLETED_EVENT</span><span class="token operator">:</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>succeed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Succeed to download, &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bytesRead <span class="token operator">+</span> <span class="token string">&quot; bytes have been transferred in total&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">TRANSFER_FAILED_EVENT</span><span class="token operator">:</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to download, &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bytesRead <span class="token operator">+</span> <span class="token string">&quot; bytes have been transferred&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSucceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> succeed<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
    <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
    <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>            
            <span class="token comment">// 下载文件的同时指定了进度条参数。</span>
            ossClient<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GetObjectRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">.</span>
                    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GetObjectRequest</span><span class="token punctuation">&gt;</span></span><span class="token function">withProgressListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GetObjectProgressListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourLocalFile&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),ks={href:"https://help.aliyun.com/document_detail/84835.html",target:"_blank",rel:"noopener noreferrer"},rs={id:"判断文件是否存在",tabindex:"-1"},ds=n("a",{class:"header-anchor",href:"#判断文件是否存在","aria-hidden":"true"},"#",-1),ms={href:"https://help.aliyun.com/document_detail/84837.html",target:"_blank",rel:"noopener noreferrer"},vs=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 判断文件是否存在。如果返回值为true，则文件存在，否则存储空间或者文件不存在。</span>
<span class="token comment">// 设置是否进行重定向或者镜像回源。默认值为true，表示忽略302重定向和镜像回源；如果设置isINoss为false，则进行302重定向或者镜像回源。</span>
<span class="token comment">//boolean isINoss = true;</span>
<span class="token comment">// 填写Bucket名称和Object完整路径。Object完整路径中不能包含Bucket名称。</span>
<span class="token keyword">boolean</span> found <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">doesObjectExist</span><span class="token punctuation">(</span><span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;exampleobject.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//boolean found = ossClient.doesObjectExist(&quot;examplebucket&quot;, &quot;exampleobject.txt&quot;, isINoss);</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),bs={id:"管理文件访问权限",tabindex:"-1"},gs=n("a",{class:"header-anchor",href:"#管理文件访问权限","aria-hidden":"true"},"#",-1),ys={href:"https://help.aliyun.com/document_detail/84838.html",target:"_blank",rel:"noopener noreferrer"},hs=e(`<table><thead><tr><th>访问权限</th><th>描述</th><th>访问权限值</th></tr></thead><tbody><tr><td>继承Bucket</td><td>文件遵循存储空间的访问权限。</td><td>CannedAccessControlList.Default</td></tr><tr><td>私有</td><td>文件的拥有者和授权用户有该文件的读写权限，其他用户没有权限操作该文件。</td><td>CannedAccessControlList.Private</td></tr><tr><td>公共读</td><td>文件的拥有者和授权用户有该文件的读写权限，其他用户只有文件的读权限。请谨慎使用该权限。</td><td>CannedAccessControlList.PublicRead</td></tr><tr><td>公共读写</td><td>所有用户都有该文件的读写权限。请谨慎使用该权限。</td><td>CannedAccessControlList.PublicReadWrite</td></tr></tbody></table><h3 id="设置文件访问权限" tabindex="-1"><a class="header-anchor" href="#设置文件访问权限" aria-hidden="true">#</a> 设置文件访问权限</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录 https://ram.console.aliyun.com 创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置文件的访问权限为公共读。</span>
ossClient<span class="token punctuation">.</span><span class="token function">setObjectAcl</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CannedAccessControlList<span class="token punctuation">.</span>PublicRead</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="获取文件访问权限" tabindex="-1"><a class="header-anchor" href="#获取文件访问权限" aria-hidden="true">#</a> 获取文件访问权限</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录 https://ram.console.aliyun.com 创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSSClient</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClient</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取文件的访问权限。</span>
<span class="token class-name">ObjectAcl</span> objectAcl <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">getObjectAcl</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>objectAcl<span class="token punctuation">.</span><span class="token function">getPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



			
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),Ss={id:"管理文件元信息",tabindex:"-1"},qs=n("a",{class:"header-anchor",href:"#管理文件元信息","aria-hidden":"true"},"#",-1),fs={href:"https://help.aliyun.com/document_detail/84840.html",target:"_blank",rel:"noopener noreferrer"},ws=e(`<h3 id="设置文件元信息" tabindex="-1"><a class="header-anchor" href="#设置文件元信息" aria-hidden="true">#</a> 设置文件元信息</h3><h4 id="设置http-header" tabindex="-1"><a class="header-anchor" href="#设置http-header" aria-hidden="true">#</a> 设置HTTP header</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">&quot;Hello OSS&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建上传文件的元信息，可以通过文件元信息设置HTTP header。</span>
<span class="token class-name">ObjectMetadata</span> meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> md5 <span class="token operator">=</span> <span class="token class-name">BinaryUtil</span><span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span><span class="token class-name">BinaryUtil</span><span class="token punctuation">.</span><span class="token function">calculateMd5</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 开启文件内容MD5校验。开启后OSS会把您提供的MD5与文件的MD5比较，不一致则抛出异常。</span>
meta<span class="token punctuation">.</span><span class="token function">setContentMD5</span><span class="token punctuation">(</span>md5<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 指定上传的内容类型。内容类型决定浏览器将以什么形式、什么编码读取文件。如果没有指定则根据文件的扩展名生成，如果没有扩展名则为默认值application/octet-stream。</span>
meta<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置内容被下载时的名称。</span>
meta<span class="token punctuation">.</span><span class="token function">setContentDisposition</span><span class="token punctuation">(</span><span class="token string">&quot;attachment; filename=\\&quot;DownloadFilename\\&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置上传文件的长度。如超过此长度，则上传文件会被截断，上传的文件长度为设置的长度。如小于此长度，则为上传文件的实际长度。</span>
meta<span class="token punctuation">.</span><span class="token function">setContentLength</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置内容被下载时网页的缓存行为。</span>
meta<span class="token punctuation">.</span><span class="token function">setCacheControl</span><span class="token punctuation">(</span><span class="token string">&quot;Download Action&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置缓存过期时间，格式是格林威治时间（GMT）。</span>
meta<span class="token punctuation">.</span><span class="token function">setExpirationTime</span><span class="token punctuation">(</span><span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">parseIso8601Date</span><span class="token punctuation">(</span><span class="token string">&quot;2022-10-12T00:00:00.000Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置内容被下载时的编码格式。</span>
meta<span class="token punctuation">.</span><span class="token function">setContentEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置header。</span>
meta<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourHeader&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourHeaderValue&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 上传文件。</span>
ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> meta<span class="token punctuation">)</span><span class="token punctuation">;</span>



                    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="设置自定义元信息" tabindex="-1"><a class="header-anchor" href="#设置自定义元信息" aria-hidden="true">#</a> 设置自定义元信息</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">&quot;Hello OSS&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建文件元信息。</span>
<span class="token class-name">ObjectMetadata</span> meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置自定义元信息property值为property-value。建议使用Base64编码。</span>
meta<span class="token punctuation">.</span><span class="token function">addUserMetadata</span><span class="token punctuation">(</span><span class="token string">&quot;property&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;property-value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 上传文件。</span>
ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> meta<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取文件元信息。</span>
ossClient<span class="token punctuation">.</span><span class="token function">getObjectMetadata</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改文件元信息" tabindex="-1"><a class="header-anchor" href="#修改文件元信息" aria-hidden="true">#</a> 修改文件元信息</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> sourceBucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourSourceBucketName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> sourceObjectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourSourceObjectName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> destinationBucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourDestinationBucketName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> destinationObjectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourDestinationObjectName&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span>accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置源文件与目标文件相同，调用ossClient.copyObject方法修改文件元信息。</span>
<span class="token class-name">CopyObjectRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyObjectRequest</span><span class="token punctuation">(</span>sourceBucketName<span class="token punctuation">,</span> sourceObjectName<span class="token punctuation">,</span> destinationBucketName<span class="token punctuation">,</span> destinationObjectName<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ObjectMetadata</span> meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 指定上传的内容类型。内容类型决定浏览器将以什么形式、什么编码读取文件。如果没有指定则根据文件的扩展名生成，如果没有扩展名则为默认值application/octet-stream。</span>
meta<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置内容被下载时的名称。</span>
meta<span class="token punctuation">.</span><span class="token function">setContentDisposition</span><span class="token punctuation">(</span><span class="token string">&quot;Download File Name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置内容被下载时网页的缓存行为。</span>
meta<span class="token punctuation">.</span><span class="token function">setCacheControl</span><span class="token punctuation">(</span><span class="token string">&quot;Download Action&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置缓存过期时间，格式是格林威治时间（GMT）。</span>
meta<span class="token punctuation">.</span><span class="token function">setExpirationTime</span><span class="token punctuation">(</span><span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">parseIso8601Date</span><span class="token punctuation">(</span><span class="token string">&quot;2022-10-12T00:00:00.000Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置内容被下载时的编码格式。</span>
meta<span class="token punctuation">.</span><span class="token function">setContentEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置header。</span>
meta<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourHeader&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourHeaderValue&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置自定义元信息property值为property-value。</span>
meta<span class="token punctuation">.</span><span class="token function">addUserMetadata</span><span class="token punctuation">(</span><span class="token string">&quot;property&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;property-value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">setNewObjectMetadata</span><span class="token punctuation">(</span>meta<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 修改元信息。</span>
ossClient<span class="token punctuation">.</span><span class="token function">copyObject</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>


  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="获取文件元信息" tabindex="-1"><a class="header-anchor" href="#获取文件元信息" aria-hidden="true">#</a> 获取文件元信息</h3><table><thead><tr><th>方法</th><th>描述</th><th>优势</th></tr></thead><tbody><tr><td>ossClient.getSimplifiedObjectMeta</td><td>获取文件的ETag、Size（文件大小）、 LastModified（最后修改时间）。</td><td>更轻量、更快</td></tr><tr><td>ossClient.getObjectMetadata</td><td>获取文件的全部元信息。</td><td>无</td></tr></tbody></table><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取文件的部分元信息。</span>
<span class="token class-name">SimplifiedObjectMeta</span> objectMeta <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">getSimplifiedObjectMeta</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>objectMeta<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>objectMeta<span class="token punctuation">.</span><span class="token function">getETag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>objectMeta<span class="token punctuation">.</span><span class="token function">getLastModified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取文件的全部元信息。</span>
<span class="token class-name">ObjectMetadata</span> metadata <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">getObjectMetadata</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>metadata<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>metadata<span class="token punctuation">.</span><span class="token function">getLastModified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>metadata<span class="token punctuation">.</span><span class="token function">getExpirationTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



            
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,10),js={id:"转换文件存储类型",tabindex:"-1"},Rs=n("a",{class:"header-anchor",href:"#转换文件存储类型","aria-hidden":"true"},"#",-1),Os={href:"https://help.aliyun.com/document_detail/116556.html",target:"_blank",rel:"noopener noreferrer"},xs=e(`<h3 id="用于将object的存储类型从标准或低频访问转换为归档类型" tabindex="-1"><a class="header-anchor" href="#用于将object的存储类型从标准或低频访问转换为归档类型" aria-hidden="true">#</a> 用于将Object的存储类型从标准或低频访问转换为归档类型：</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 本示例中的Bucket与Object需提前创建好, 且Object类型为标准或低频访问存储类型。</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建CopyObjectRequest对象。</span>
<span class="token class-name">CopyObjectRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyObjectRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token comment">// 创建ObjectMetadata对象。</span>
<span class="token class-name">ObjectMetadata</span> objectMetadata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 封装header，此处以设置存储类型为归档类型为例。</span>
objectMetadata<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;x-oss-storage-class&quot;</span><span class="token punctuation">,</span> <span class="token class-name">StorageClass<span class="token punctuation">.</span>Archive</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">setNewObjectMetadata</span><span class="token punctuation">(</span>objectMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 更改文件存储类型。</span>
<span class="token class-name">CopyObjectResult</span> result <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">copyObject</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="用于将object的存储类型从归档转换为低频访问类型" tabindex="-1"><a class="header-anchor" href="#用于将object的存储类型从归档转换为低频访问类型" aria-hidden="true">#</a> 用于将Object的存储类型从归档转换为低频访问类型：</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 本示例中的Bucket与Object需提前创建好, 且Object类型为归档存储类型。</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取文件元信息。</span>
<span class="token class-name">ObjectMetadata</span> objectMetadata <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">getObjectMetadata</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 检查目标文件是否为归档类型。如果是，则需要先解冻才能更改存储类型。</span>
<span class="token class-name">StorageClass</span> storageClass <span class="token operator">=</span> objectMetadata<span class="token punctuation">.</span><span class="token function">getObjectStorageClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;storage type:&quot;</span> <span class="token operator">+</span> storageClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>storageClass <span class="token operator">==</span> <span class="token class-name">StorageClass<span class="token punctuation">.</span>Archive</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 解冻文件。</span>
    ossClient<span class="token punctuation">.</span><span class="token function">restoreObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 等待解冻完成。</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectMetadata <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">getObjectMetadata</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>objectMetadata<span class="token punctuation">.</span><span class="token function">isRestoreCompleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

 <span class="token comment">// 创建CopyObjectRequest对象。</span>
<span class="token class-name">CopyObjectRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyObjectRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token comment">// 创建ObjectMetadata对象。</span>
objectMetadata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 封装header，此处以设置存储类型为低频访问类型为例。</span>
objectMetadata<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;x-oss-storage-class&quot;</span><span class="token punctuation">,</span> <span class="token class-name">StorageClass</span><span class="token punctuation">.</span><span class="token constant">IA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">setNewObjectMetadata</span><span class="token punctuation">(</span>objectMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 更改文件存储类型。</span>
<span class="token class-name">CopyObjectResult</span> result <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">copyObject</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),_s={id:"列举文件",tabindex:"-1"},Cs=n("a",{class:"header-anchor",href:"#列举文件","aria-hidden":"true"},"#",-1),As={href:"https://help.aliyun.com/document_detail/84841.html",target:"_blank",rel:"noopener noreferrer"},Ks={id:"查询文件",tabindex:"-1"},Ps=n("a",{class:"header-anchor",href:"#查询文件","aria-hidden":"true"},"#",-1),Ms={href:"https://help.aliyun.com/document_detail/123634.html",target:"_blank",rel:"noopener noreferrer"},Es={id:"删除文件",tabindex:"-1"},Is=n("a",{class:"header-anchor",href:"#删除文件","aria-hidden":"true"},"#",-1),Bs={href:"https://help.aliyun.com/document_detail/84842.html",target:"_blank",rel:"noopener noreferrer"},Ns={id:"拷贝文件",tabindex:"-1"},Ts=n("a",{class:"header-anchor",href:"#拷贝文件","aria-hidden":"true"},"#",-1),Us={href:"https://help.aliyun.com/document_detail/84843.html",target:"_blank",rel:"noopener noreferrer"},Ls={id:"禁止覆盖同名文件",tabindex:"-1"},Ds=n("a",{class:"header-anchor",href:"#禁止覆盖同名文件","aria-hidden":"true"},"#",-1),Fs={href:"https://help.aliyun.com/document_detail/146172.html",target:"_blank",rel:"noopener noreferrer"},Hs={id:"解冻文件",tabindex:"-1"},zs=n("a",{class:"header-anchor",href:"#解冻文件","aria-hidden":"true"},"#",-1),Vs={href:"https://help.aliyun.com/document_detail/84846.html",target:"_blank",rel:"noopener noreferrer"},Gs={id:"管理软链接",tabindex:"-1"},Xs=n("a",{class:"header-anchor",href:"#管理软链接","aria-hidden":"true"},"#",-1),Ws={href:"https://help.aliyun.com/document_detail/84848.html",target:"_blank",rel:"noopener noreferrer"},Js={href:"https://help.aliyun.com/document_detail/119164.html",target:"_blank",rel:"noopener noreferrer"},$s={id:"管理版本控制",tabindex:"-1"},Ys=n("a",{class:"header-anchor",href:"#管理版本控制","aria-hidden":"true"},"#",-1),Zs={href:"https://help.aliyun.com/document_detail/119165.html",target:"_blank",rel:"noopener noreferrer"},Qs={id:"上传文件",tabindex:"-1"},na=n("a",{class:"header-anchor",href:"#上传文件","aria-hidden":"true"},"#",-1),sa={href:"https://help.aliyun.com/document_detail/119173.html",target:"_blank",rel:"noopener noreferrer"},aa={id:"下载文件",tabindex:"-1"},ta=n("a",{class:"header-anchor",href:"#下载文件","aria-hidden":"true"},"#",-1),ea={href:"https://help.aliyun.com/document_detail/119175.html",target:"_blank",rel:"noopener noreferrer"},pa={id:"拷贝文件-1",tabindex:"-1"},oa=n("a",{class:"header-anchor",href:"#拷贝文件-1","aria-hidden":"true"},"#",-1),ca={href:"https://help.aliyun.com/document_detail/119177.html",target:"_blank",rel:"noopener noreferrer"},la={id:"列举文件-1",tabindex:"-1"},ia=n("a",{class:"header-anchor",href:"#列举文件-1","aria-hidden":"true"},"#",-1),ua={href:"https://help.aliyun.com/document_detail/190262.html",target:"_blank",rel:"noopener noreferrer"},ka={id:"删除文件-1",tabindex:"-1"},ra=n("a",{class:"header-anchor",href:"#删除文件-1","aria-hidden":"true"},"#",-1),da={href:"https://help.aliyun.com/document_detail/119178.html",target:"_blank",rel:"noopener noreferrer"},ma={id:"解冻文件-1",tabindex:"-1"},va=n("a",{class:"header-anchor",href:"#解冻文件-1","aria-hidden":"true"},"#",-1),ba={href:"https://help.aliyun.com/document_detail/119181.html",target:"_blank",rel:"noopener noreferrer"},ga={id:"获取文件元信息-1",tabindex:"-1"},ya=n("a",{class:"header-anchor",href:"#获取文件元信息-1","aria-hidden":"true"},"#",-1),ha={href:"https://help.aliyun.com/document_detail/119182.html",target:"_blank",rel:"noopener noreferrer"},Sa={id:"管理文件访问权限-1",tabindex:"-1"},qa=n("a",{class:"header-anchor",href:"#管理文件访问权限-1","aria-hidden":"true"},"#",-1),fa={href:"https://help.aliyun.com/document_detail/119183.html",target:"_blank",rel:"noopener noreferrer"},wa={id:"管理软链接-1",tabindex:"-1"},ja=n("a",{class:"header-anchor",href:"#管理软链接-1","aria-hidden":"true"},"#",-1),Ra={href:"https://help.aliyun.com/document_detail/119185.html",target:"_blank",rel:"noopener noreferrer"},Oa={href:"https://help.aliyun.com/document_detail/162791.html",target:"_blank",rel:"noopener noreferrer"},xa={id:"服务器端加密",tabindex:"-1"},_a=n("a",{class:"header-anchor",href:"#服务器端加密","aria-hidden":"true"},"#",-1),Ca={href:"https://help.aliyun.com/document_detail/119162.html",target:"_blank",rel:"noopener noreferrer"},Aa=e(`<h3 id="配置bucket加密" tabindex="-1"><a class="header-anchor" href="#配置bucket加密" aria-hidden="true">#</a> 配置Bucket加密</h3><p>您可以通过以下代码设置Bucket默认加密方式，设置成功之后，所有上传至该Bucket但未设置加密方式的Object都会使用Bucket默认加密方式进行加密：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置Bucket加密。</span>
<span class="token class-name">ServerSideEncryptionByDefault</span> applyServerSideEncryptionByDefault <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSideEncryptionByDefault</span><span class="token punctuation">(</span><span class="token class-name">SSEAlgorithm</span><span class="token punctuation">.</span><span class="token constant">KMS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
applyServerSideEncryptionByDefault<span class="token punctuation">.</span><span class="token function">setKMSMasterKeyID</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourTestKmsId&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ServerSideEncryptionConfiguration</span> sseConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSideEncryptionConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sseConfig<span class="token punctuation">.</span><span class="token function">setApplyServerSideEncryptionByDefault</span><span class="token punctuation">(</span>applyServerSideEncryptionByDefault<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SetBucketEncryptionRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SetBucketEncryptionRequest</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">,</span> sseConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
ossClient<span class="token punctuation">.</span><span class="token function">setBucketEncryption</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>


      
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="获取bucket加密配置" tabindex="-1"><a class="header-anchor" href="#获取bucket加密配置" aria-hidden="true">#</a> 获取Bucket加密配置</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取Bucket加密配置。</span>
<span class="token class-name">ServerSideEncryptionConfiguration</span> sseConfig <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">getBucketEncryption</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;get Algorithm: &quot;</span> <span class="token operator">+</span> sseConfig<span class="token punctuation">.</span><span class="token function">getApplyServerSideEncryptionByDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSSEAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;get kmsid: &quot;</span> <span class="token operator">+</span> sseConfig<span class="token punctuation">.</span><span class="token function">getApplyServerSideEncryptionByDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKMSMasterKeyID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="删除bucket加密配置" tabindex="-1"><a class="header-anchor" href="#删除bucket加密配置" aria-hidden="true">#</a> 删除Bucket加密配置</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 删除Bucket加密配置。</span>
ossClient<span class="token punctuation">.</span><span class="token function">deleteBucketEncryption</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),Ka={id:"客户端加密",tabindex:"-1"},Pa=n("a",{class:"header-anchor",href:"#客户端加密","aria-hidden":"true"},"#",-1),Ma={href:"https://help.aliyun.com/document_detail/162792.html",target:"_blank",rel:"noopener noreferrer"},Ea=e(`<h2 id="加密方式" tabindex="-1"><a class="header-anchor" href="#加密方式" aria-hidden="true">#</a> -- 加密方式</h2><p>对于主密钥的使用，目前支持如下两种方式：</p><ul><li>使用KMS托管用户主密钥 <br> 当使用KMS托管用户主密钥用于客户端数据加密时，需要将KMS用户主密钥ID（即CMK ID）传递给SDK。</li><li>使用用户自主管理的主密钥（RSA） <br> 主密钥信息由用户提供，需要用户将主密钥的公钥、私钥信息当做参数传递给SDK。 使用以上两种加密方式能够有效地避免数据泄漏，保护客户端数据安全。即使数据泄漏，其他人也无法解密得到原始数据。</li></ul><h3 id="加密元信息" tabindex="-1"><a class="header-anchor" href="#加密元信息" aria-hidden="true">#</a> 加密元信息</h3><table><thead><tr><th>参数</th><th>描述</th><th>是否必须</th></tr></thead><tbody><tr><td>x-oss-meta-client-side-encryption-key</td><td>加密后的密钥。 经过主密钥加密后再经过base64编码的字符串。</td><td>是</td></tr><tr><td>x-oss-meta-client-side-encryption-start</td><td>随机产生的用于加密数据的初始值 。经过主密钥加密后再经过base64编码的字符串。</td><td>是</td></tr><tr><td>x-oss-meta-client-side-encryption-cek-alg</td><td>数据的加密算法。</td><td>是</td></tr><tr><td>x-oss-meta-client-side-encryption-wrap-alg</td><td>数据密钥的加密算法。</td><td>是</td></tr><tr><td>x-oss-meta-client-side-encryption-matdesc</td><td>主密钥的描述信息。JSON格式。 <strong>警告</strong> 强烈建议为每个主密钥都配置描述信息，并保存好主密钥和描述信息之间的对应关系。否则加密之后不支持更换主密钥进行加密。</td><td>否</td></tr><tr><td>x-oss-meta-client-side-encryption-unencrypted-content-length</td><td>加密前的数据长度。若未指定content-length，则不生成该参数。</td><td>否</td></tr><tr><td>x-oss-meta-client-side-encryption-unencrypted-content-md5</td><td>加密前数据的MD5。若未指定MD5，则不生成该参数。</td><td>否</td></tr><tr><td>x-oss-meta-client-side-encryption-data-size</td><td>若加密Multipart文件，则需要在init_multipart时传入整个大文件的总大小。</td><td>是（分片上传）</td></tr><tr><td>x-oss-meta-client-side-encryption-part-size</td><td>若加密Multipart文件，则需要在init_multipart时传入分片大小。 <strong>注意</strong> 目前分片大小必须是16的整数倍。</td><td>是（分片上传）</td></tr></tbody></table><h2 id="创建加密客户端" tabindex="-1"><a class="header-anchor" href="#创建加密客户端" aria-hidden="true">#</a> -- 创建加密客户端</h2><p><strong>说明</strong> 使用客户端加密时，需确保您使用了OSS Java SDK 3.9.1及以上版本，同时在工程里添加Bouncy Castle Crypto包，例如在pom.xml中加入如下依赖。</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.bouncycastle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>bcprov-jdk15on<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.62<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果运行时报<code>java.security.InvalidKeyException: Illegal key size or default parameters</code>异常，则需要补充Oracle的JCE文件，将其部署在JRE的环境中。 请根据使用的JDK版本分别下载对应的文件，将其解压后保存在jre/lib/security目录下。</p>`,9),Ia={href:"https://www.oracle.com/java/technologies/jce-6-download.html",target:"_blank",rel:"noopener noreferrer"},Ba={href:"https://www.oracle.com/java/technologies/javase-jce7-downloads.html",target:"_blank",rel:"noopener noreferrer"},Na={href:"https://www.oracle.com/java/technologies/javase-jce8-downloads.html",target:"_blank",rel:"noopener noreferrer"},Ta=e(`<p>以下提供了创建RSA、KMS加密客户端的完整示例。</p><h3 id="创建rsa加密客户端" tabindex="-1"><a class="header-anchor" href="#创建rsa加密客户端" aria-hidden="true">#</a> 创建RSA加密客户端</h3><p>创建RSA加密客户端之前，需要创建非对称密钥KeyPair对象。OSS Java SDK提供了从PKCS1编码或PKCS8编码的pem格式私钥字符串到RSAPrivateKey对象的转换，以及从X509编码pem格式公钥字符串到RSAPublicKey对象的转换。</p><p><code>RSAPrivateKey SimpleRSAEncryptionMaterials.getPrivateKeyFromPemPKCS1(String privateKeyStr);</code></p><p><code>RSAPrivateKey SimpleRSAEncryptionMaterials.getPrivateKeyFromPemPKCS8(String privateKeyStr);</code></p><p><code>RSAPublicKey SimpleRSAEncryptionMaterials.getPublicKeyFromPemX509(String publicKeyStr);</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
  <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
  <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 您可以使用以下命令分别生成私钥与公钥pem文件，然后复制pem文件中的字符串到PRIVATE_PKCS1_PEM，PUBLIC_X509_PEM变量中。</span>
  <span class="token comment">// openssl genrsa -out private_key.pem 2048</span>
  <span class="token comment">// openssl rsa -in private_key.pem -out rsa_public_key.pem -pubout</span>
  
  <span class="token comment">// 填写您的RSA私钥字符串。</span>
  <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PRIVATE_PKCS1_PEM</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;yourPrivateKeyWithPKCS1PemString&gt;&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 填写您的RSA公钥字符串。</span>
  <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PUBLIC_X509_PEM</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;yourPublicKeyWithX509PemString&gt;&quot;</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 创建一个RSA密钥对。</span>
  <span class="token class-name">RSAPrivateKey</span> privateKey <span class="token operator">=</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">.</span><span class="token function">getPrivateKeyFromPemPKCS1</span><span class="token punctuation">(</span><span class="token constant">PRIVATE_PKCS1_PEM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">RSAPublicKey</span> publicKey <span class="token operator">=</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">.</span><span class="token function">getPublicKeyFromPemX509</span><span class="token punctuation">(</span><span class="token constant">PUBLIC_X509_PEM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">KeyPair</span> keyPair <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeyPair</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 创建主密钥RSA的描述信息，创建后不允许修改。主密钥描述信息和主密钥一一对应。</span>
  <span class="token comment">// 如果所有的Object都使用相同的主密钥，主密钥描述信息可以为空，但后续不支持更换主密钥。</span>
  <span class="token comment">// 如果主密钥描述信息为空，解密时无法判断文件使用的是哪个主密钥进行加密。</span>
  <span class="token comment">// 强烈建议为每个主密钥都配置描述信息，由客户端保存主密钥和描述信息之间的对应关系（服务端不保存两者之间的对应关系）。</span>
  <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> matDesc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  matDesc<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourDescriptionKey&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourDescriptionValue&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 创建RSA加密材料。</span>
  <span class="token class-name">SimpleRSAEncryptionMaterials</span> encryptionMaterials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">(</span>keyPair<span class="token punctuation">,</span> matDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果要下载并解密其他RSA密钥加密的文件，请将其他主密钥及其描述信息添加到加密材料中。</span>
  <span class="token comment">// encryptionMaterials.addKeyPairDescMaterial(&lt;otherKeyPair&gt;, &lt;otherKeyPairMatDesc&gt;);</span>
  
  <span class="token comment">// 创建RSA加密客户端。</span>
  <span class="token class-name">OSSEncryptionClient</span> ossEncryptionClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSEncryptionClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                          <span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> encryptionMaterials<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建kms加密客户端" tabindex="-1"><a class="header-anchor" href="#创建kms加密客户端" aria-hidden="true">#</a> 创建KMS加密客户端</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
  <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
  <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 用户主密钥。</span>
  <span class="token class-name">String</span> cmk <span class="token operator">=</span> <span class="token string">&quot;&lt;yourCmkId&gt;&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// cmk所在的region。</span>
  <span class="token class-name">String</span> region <span class="token operator">=</span> <span class="token string">&quot;&lt;yourKmsRegion&gt;&quot;</span><span class="token punctuation">;</span>
  
  
  <span class="token comment">// 创建主密钥KMS的描述信息，创建后不允许修改。主密钥描述信息、region以及用户主密钥（cmk)是一一对应关系。</span>
  <span class="token comment">// 如果所有的object都使用相同的cmk，主密钥描述信息可以为空，但后续不支持更换主密钥。</span>
  <span class="token comment">// 如果主密钥描述信息为空，解密时无法判断文件使用的是哪个主密钥进行加密。</span>
  <span class="token comment">// 强烈建议为每个主密钥都配置主密钥描述信息，由客户端保存主密钥和描述信息之间的对应关系（服务端不保存两者之间的对应关系）。</span>
  <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> matDesc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  matDesc<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourDescriptionKey&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourDescriptionValue&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 创建KMS加密材料。</span>
  <span class="token class-name">KmsEncryptionMaterials</span> encryptionMaterials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KmsEncryptionMaterials</span><span class="token punctuation">(</span>region<span class="token punctuation">,</span> cmk<span class="token punctuation">,</span> matDesc<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
  <span class="token comment">// 如果要下载并解密其他cmk加密的文件，请把cmk的region名称以及描述信息添加到KMS加密材料中。</span>
  <span class="token comment">// encryptionMaterials.addKmsDescMaterial(&lt;otherKmsRegion&gt;, &lt;otherKmsMatDesc&gt;);</span>
  <span class="token comment">// 如果要下载并解密其他cmk加密的文件，并且kms的账号不同于OSS客户端账号，请把Kms的region名称、凭证以及描述信息添加到加密材料中。</span>
  <span class="token comment">// encryptionMaterials.addKmsDescMaterial(&lt;otherKmsRegion&gt;, &lt;otherKmsCredentialsProvider&gt;, &lt;otherKmsMatDesc&gt;);</span>
  
  <span class="token comment">// 创建加密客户端。</span>
  <span class="token class-name">OSSEncryptionClient</span> ossEncryptionClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSEncryptionClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                      <span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> encryptionMaterials<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以下提供了如何使用用户自主管理的主密钥（RSA）进行普通上传和下载文件、分片上传、范围下载等场景的完整示例。</p><p><strong>说明</strong> 使用主密钥KMS与使用主密钥RSA的方式，区别仅在于OSSEncryptionClient的创建过程。</p><h2 id="普通上传和下载文件" tabindex="-1"><a class="header-anchor" href="#普通上传和下载文件" aria-hidden="true">#</a> -- 普通上传和下载文件</h2><p>使用<strong>主密钥RSA</strong>进行普通上传和下载Object示例代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">&quot;Hello OSS!&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 填写您的RSA私钥字符串。</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PRIVATE_PKCS1_PEM</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;yourPrivateKeyWithPKCS1PemString&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写您的RSA公钥字符串。</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PUBLIC_X509_PEM</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;yourPublicKeyWithX509PemString&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个RSA密钥对。</span>
<span class="token class-name">RSAPrivateKey</span> privateKey <span class="token operator">=</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">.</span><span class="token function">getPrivateKeyFromPemPKCS1</span><span class="token punctuation">(</span><span class="token constant">PRIVATE_PKCS1_PEM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">RSAPublicKey</span> publicKey <span class="token operator">=</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">.</span><span class="token function">getPublicKeyFromPemX509</span><span class="token punctuation">(</span><span class="token constant">PUBLIC_X509_PEM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">KeyPair</span> keyPair <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeyPair</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建主密钥RSA的描述信息。创建后不允许修改。主密钥描述信息和主密钥一一对应。</span>
<span class="token comment">// 如果所有的object都使用相同的主密钥，主密钥描述信息可以为空，但后续不支持更换主密钥。</span>
<span class="token comment">// 如果主密钥描述信息为空，解密时无法判断文件使用的是哪个主密钥进行加密。</span>
<span class="token comment">// 强烈建议为每个主密钥都配置描述信息，由客户端保存主密钥和描述信息之间的对应关系（服务端不保存两者之间的对应关系）。</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> matDesc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
matDesc<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourDescriptionKey&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourDescriptionValue&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建RSA加密材料。</span>
<span class="token class-name">SimpleRSAEncryptionMaterials</span> encryptionMaterials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">(</span>keyPair<span class="token punctuation">,</span> matDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果要下载并解密其他RSA密钥加密的文件，请将其他主密钥及其描述信息添加到加密材料中。</span>
<span class="token comment">// encryptionMaterials.addKeyPairDescMaterial(&lt;otherKeyPair&gt;, &lt;otherKeyPairMatDesc&gt;);</span>

<span class="token comment">// 创建加密客户端。</span>
<span class="token class-name">OSSEncryptionClient</span> ossEncryptionClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSEncryptionClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> encryptionMaterials<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 加密上传文件。</span>
ossEncryptionClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 下载文件时自动解密。</span>
<span class="token class-name">OSSObject</span> ossObject <span class="token operator">=</span> ossEncryptionClient<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>ossObject<span class="token punctuation">.</span><span class="token function">getObjectContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">StringBuffer</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> line<span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    buffer<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 查看解密后的内容是否与上传的明文一致。</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Put plain text: &quot;</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Get and decrypted text: &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="分片上传-1" tabindex="-1"><a class="header-anchor" href="#分片上传-1" aria-hidden="true">#</a> -- 分片上传</h2><p>使用<strong>主密钥RSA</strong>进行分片上传的示例代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> localFile <span class="token operator">=</span> <span class="token string">&quot;&lt;yourLocalFilePath&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 填写您的RSA私钥字符串。</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PRIVATE_PKCS1_PEM</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;yourPrivateKeyWithPKCS1PemString&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写您的RSA公钥字符串。</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PUBLIC_X509_PEM</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;yourPublicKeyWithX509PemString&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个RSA密钥对。</span>
<span class="token class-name">RSAPrivateKey</span> privateKey <span class="token operator">=</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">.</span><span class="token function">getPrivateKeyFromPemPKCS1</span><span class="token punctuation">(</span><span class="token constant">PRIVATE_PKCS1_PEM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">RSAPublicKey</span> publicKey <span class="token operator">=</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">.</span><span class="token function">getPublicKeyFromPemX509</span><span class="token punctuation">(</span><span class="token constant">PUBLIC_X509_PEM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">KeyPair</span> keyPair <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeyPair</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 创建主密钥RSA的描述信息，创建后不允许修改。主密钥描述信息和主密钥一一对应。</span>
<span class="token comment">// 如果所有的Object都使用相同的主密钥，主密钥描述信息可以为空，但后续不支持更换主密钥。</span>
<span class="token comment">// 如果主密钥描述信息为空，解密时无法判断文件使用的是哪个主密钥进行加密。</span>
<span class="token comment">// 强烈建议为每个主密钥都配置描述信息，由客户端保存主密钥和描述信息之间的对应关系（服务端不保存两者之间的对应关系）。</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> matDesc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
matDesc<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourDescriptionKey&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourDescriptionValue&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建RSA加密材料。</span>
<span class="token class-name">SimpleRSAEncryptionMaterials</span> encryptionMaterials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">(</span>keyPair<span class="token punctuation">,</span> matDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果要下载并解密其他RSA密钥加密的文件，请将其他主密钥及其描述信息添加到加密材料中。</span>
<span class="token comment">// encryptionMaterials.addKeyPairDescMaterial(&lt;otherKeyPair&gt;, &lt;otherKeyPairMatDesc&gt;);</span>

<span class="token comment">// 创建加密客户端。</span>
<span class="token class-name">OSSEncryptionClient</span> ossEncryptionClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSEncryptionClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> encryptionMaterials<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建MultipartUploadCryptoContext对象，指定分片大小与文件大小。分片大小需16字节对齐。</span>
<span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>localFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> fileLength <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token keyword">long</span> partSize <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">1024L</span><span class="token punctuation">;</span>   <span class="token comment">// 100K</span>
<span class="token class-name">MultipartUploadCryptoContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultipartUploadCryptoContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">setPartSize</span><span class="token punctuation">(</span>partSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">setDataSize</span><span class="token punctuation">(</span>fileLength<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 初始化一个分片上传事件。</span>
<span class="token class-name">InitiateMultipartUploadRequest</span> initiateMultipartUploadRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InitiateMultipartUploadRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 传入MultipartUploadCryptoContext对象。</span>
<span class="token class-name">InitiateMultipartUploadResult</span> upresult <span class="token operator">=</span> ossEncryptionClient<span class="token punctuation">.</span><span class="token function">initiateMultipartUpload</span><span class="token punctuation">(</span>initiateMultipartUploadRequest<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> uploadId <span class="token operator">=</span> upresult<span class="token punctuation">.</span><span class="token function">getUploadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建PartETag的集合。PartETag由分片的ETag和分片号组成。</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PartETag</span><span class="token punctuation">&gt;</span></span> partETags <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PartETag</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> partCount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>fileLength <span class="token operator">/</span> partSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>fileLength <span class="token operator">%</span> partSize <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    partCount<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 遍历分片上传。</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> partCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> startPos <span class="token operator">=</span> i <span class="token operator">*</span> partSize<span class="token punctuation">;</span>
    <span class="token keyword">long</span> curPartSize <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">==</span> partCount<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>fileLength <span class="token operator">-</span> startPos<span class="token punctuation">)</span> <span class="token operator">:</span> partSize<span class="token punctuation">;</span>
    <span class="token class-name">InputStream</span> instream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    instream<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span>startPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UploadPartRequest</span> uploadPartRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UploadPartRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadPartRequest<span class="token punctuation">.</span><span class="token function">setBucketName</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadPartRequest<span class="token punctuation">.</span><span class="token function">setKey</span><span class="token punctuation">(</span>objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadPartRequest<span class="token punctuation">.</span><span class="token function">setUploadId</span><span class="token punctuation">(</span>uploadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadPartRequest<span class="token punctuation">.</span><span class="token function">setInputStream</span><span class="token punctuation">(</span>instream<span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadPartRequest<span class="token punctuation">.</span><span class="token function">setPartSize</span><span class="token punctuation">(</span>curPartSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadPartRequest<span class="token punctuation">.</span><span class="token function">setPartNumber</span><span class="token punctuation">(</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 传入MultipartUploadCryptoContext对象。</span>
    <span class="token class-name">UploadPartResult</span> uploadPartResult <span class="token operator">=</span> ossEncryptionClient<span class="token punctuation">.</span><span class="token function">uploadPart</span><span class="token punctuation">(</span>uploadPartRequest<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    partETags<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>uploadPartResult<span class="token punctuation">.</span><span class="token function">getPartETag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 完成分片上传。</span>
<span class="token class-name">CompleteMultipartUploadRequest</span> completeMultipartUploadRequest <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">CompleteMultipartUploadRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> uploadId<span class="token punctuation">,</span> partETags<span class="token punctuation">)</span><span class="token punctuation">;</span>
ossEncryptionClient<span class="token punctuation">.</span><span class="token function">completeMultipartUpload</span><span class="token punctuation">(</span>completeMultipartUploadRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 关闭OSSEncryptionClient。</span>
ossEncryptionClient<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="断点续传上传-1" tabindex="-1"><a class="header-anchor" href="#断点续传上传-1" aria-hidden="true">#</a> -- 断点续传上传</h2><p>使用<strong>主密钥RSA</strong>进行断点续传上传的示例代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> localFile <span class="token operator">=</span> <span class="token string">&quot;&lt;yourLocalFilePath&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 填写您的RSA私钥字符串，可以使用OpenSSL工具生成。</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PRIVATE_PKCS1_PEM</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;yourPrivateKeyWithPKCS1PemString&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写您的RSA公钥字符串，可以使用OpenSSL工具生成。</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PUBLIC_X509_PEM</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;yourPublicKeyWithX509PemString&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个RSA密钥对。</span>
<span class="token class-name">RSAPrivateKey</span> privateKey <span class="token operator">=</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">.</span><span class="token function">getPrivateKeyFromPemPKCS1</span><span class="token punctuation">(</span><span class="token constant">PRIVATE_PKCS1_PEM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">RSAPublicKey</span> publicKey <span class="token operator">=</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">.</span><span class="token function">getPublicKeyFromPemX509</span><span class="token punctuation">(</span><span class="token constant">PUBLIC_X509_PEM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">KeyPair</span> keyPair <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeyPair</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建主密钥RSA的描述信息，创建后不允许修改。主密钥描述信息和主密钥一一对应。</span>
<span class="token comment">// 如果所有的Object都使用相同的主密钥，主密钥描述信息可以为空，但后续不支持更换主密钥。</span>
<span class="token comment">// 如果主密钥描述信息为空，解密时无法判断文件使用的是哪个主密钥进行加密。</span>
<span class="token comment">// 强烈建议为每个主密钥都配置描述信息，由客户端保存主密钥和描述信息之间的对应关系（服务端不保存两者之间的对应关系）。</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> matDesc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
matDesc<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourDescriptionKey&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourDescriptionValue&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建RSA加密材料。</span>
<span class="token class-name">SimpleRSAEncryptionMaterials</span> encryptionMaterials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">(</span>keyPair<span class="token punctuation">,</span> matDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果要下载并解密其他RSA密钥加密的文件，请将RSA密钥加密的文件及其描述信息添加至加密材料中。</span>
<span class="token comment">// encryptionMaterials.addKeyPairDescMaterial(&lt;otherKeyPair&gt;, &lt;otherKeyPairMatDesc&gt;);</span>

<span class="token comment">// 创建加密客户端。</span>
<span class="token class-name">OSSEncryptionClient</span> ossEncryptionClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSEncryptionClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> encryptionMaterials<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建UploadFileRequest对象。   </span>
<span class="token class-name">UploadFileRequest</span> uploadFileRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UploadFileRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置要上传的文件的路径。</span>
uploadFileRequest<span class="token punctuation">.</span><span class="token function">setUploadFile</span><span class="token punctuation">(</span>localFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 指定上传的分片大小，范围为100 KB~5 GB，默认为文件大小的1/10000。</span>
uploadFileRequest<span class="token punctuation">.</span><span class="token function">setPartSize</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 开启断点续传，默认关闭。</span>
uploadFileRequest<span class="token punctuation">.</span><span class="token function">setEnableCheckpoint</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置断点记录文件。如未指定，则默认名称为localfile + &quot;.ucp&quot;，与localfile同目录。</span>
<span class="token comment">// 上传过程中的进度信息会保存在该文件中，如果某一分片上传失败，再次上传时会根据文件中记录的点继续上传。上传完成后，该文件会被删除。</span>
uploadFileRequest<span class="token punctuation">.</span><span class="token function">setCheckpointFile</span><span class="token punctuation">(</span><span class="token string">&quot;test-upload.ucp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 开始断点续传上传。</span>
ossEncryptionClient<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span>uploadFileRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 关闭OSSEncryptionClient。</span>
ossEncryptionClient<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="断点续传下载-1" tabindex="-1"><a class="header-anchor" href="#断点续传下载-1" aria-hidden="true">#</a> -- 断点续传下载</h2><p>使用<strong>主密钥RSA</strong>进行断点续传下载的示例代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 填写您的RSA私钥字符串，可以使用OpenSSL工具生成。</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PRIVATE_PKCS1_PEM</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;yourPrivateKeyWithPKCS1PemString&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写您的RSA公钥字符串，可以使用OpenSSL工具生成。</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PUBLIC_X509_PEM</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;yourPublicKeyWithX509PemString&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个RSA密钥对。</span>
<span class="token class-name">RSAPrivateKey</span> privateKey <span class="token operator">=</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">.</span><span class="token function">getPrivateKeyFromPemPKCS1</span><span class="token punctuation">(</span><span class="token constant">PRIVATE_PKCS1_PEM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">RSAPublicKey</span> publicKey <span class="token operator">=</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">.</span><span class="token function">getPublicKeyFromPemX509</span><span class="token punctuation">(</span><span class="token constant">PUBLIC_X509_PEM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">KeyPair</span> keyPair <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeyPair</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建主密钥RSA的描述信息，创建后不允许修改。主密钥描述信息和主密钥一一对应。</span>
<span class="token comment">// 如果所有的Object都使用相同的主密钥，主密钥描述信息可以为空，但后续不支持更换主密钥。</span>
<span class="token comment">// 如果主密钥描述信息为空，解密时无法判断文件使用的是哪个主密钥进行加密。</span>
<span class="token comment">// 强烈建议为每个主密钥都配置描述信息，由客户端保存主密钥和描述信息之间的对应关系（服务端不保存两者之间的对应关系）。</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> matDesc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
matDesc<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourDescriptionKey&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourDescriptionValue&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建RSA加密材料。</span>
<span class="token class-name">SimpleRSAEncryptionMaterials</span> encryptionMaterials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">(</span>keyPair<span class="token punctuation">,</span> matDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果要下载并解密其他RSA密钥加密的文件，请把它以及其描述信息添加到加密材料里。</span>
<span class="token comment">// encryptionMaterials.addKeyPairDescMaterial(&lt;otherKeyPair&gt;, &lt;otherKeyPairMatDesc&gt;);</span>

<span class="token comment">// 创建加密客户端。</span>
<span class="token class-name">OSSEncryptionClient</span> ossEncryptionClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSEncryptionClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> encryptionMaterials<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 发起下载请求，指定10个任务并发下载，启动断点续传下载。</span>
<span class="token class-name">DownloadFileRequest</span> downloadFileRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DownloadFileRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
downloadFileRequest<span class="token punctuation">.</span><span class="token function">setDownloadFile</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourDownloadFile&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
downloadFileRequest<span class="token punctuation">.</span><span class="token function">setPartSize</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
downloadFileRequest<span class="token punctuation">.</span><span class="token function">setTaskNum</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
downloadFileRequest<span class="token punctuation">.</span><span class="token function">setEnableCheckpoint</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
downloadFileRequest<span class="token punctuation">.</span><span class="token function">setCheckpointFile</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourCheckpointFile&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 开始断点续传下载。</span>
<span class="token class-name">DownloadFileResult</span> downloadRes <span class="token operator">=</span> ossEncryptionClient<span class="token punctuation">.</span><span class="token function">downloadFile</span><span class="token punctuation">(</span>downloadFileRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 关闭OSSEncryptionClient。</span>
ossEncryptionClient<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="范围下载-1" tabindex="-1"><a class="header-anchor" href="#范围下载-1" aria-hidden="true">#</a> -- 范围下载</h2><p>使用<strong>主密钥RSA</strong>对范围下载的文件进行解密的示例代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录RAM控制台创建RAM账号。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">&quot;test-range-get-content-82042795hlnf12s8yhfs976y2nfoshhnsdfsf235bvsmnhtskbcfd!&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 填写您的RSA私钥字符串。</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PRIVATE_PKCS1_PEM</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;yourPrivateKeyWithPKCS1PemString&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写您的RSA公钥字符串。</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PUBLIC_X509_PEM</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;yourPublicKeyWithX509PemString&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个RSA密钥对。</span>
<span class="token class-name">RSAPrivateKey</span> privateKey <span class="token operator">=</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">.</span><span class="token function">getPrivateKeyFromPemPKCS1</span><span class="token punctuation">(</span><span class="token constant">PRIVATE_PKCS1_PEM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">RSAPublicKey</span> publicKey <span class="token operator">=</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">.</span><span class="token function">getPublicKeyFromPemX509</span><span class="token punctuation">(</span><span class="token constant">PUBLIC_X509_PEM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">KeyPair</span> keyPair <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeyPair</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建主密钥RSA的描述信息，创建后不允许修改。主密钥描述信息和主密钥一一对应。</span>
<span class="token comment">// 如果所有的Object都使用相同的主密钥，主密钥描述信息可以为空，但后续不支持更换主密钥。</span>
<span class="token comment">// 如果主密钥描述信息为空，解密时无法判断文件使用的是哪个主密钥进行加密。</span>
<span class="token comment">// 强烈建议为每个主密钥都配置描述信息，由客户端保存主密钥和描述信息之间的对应关系（服务端不保存两者之间的对应关系）。</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> matDesc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
matDesc<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;yourDescriptionKey&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;yourDescriptionValue&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建RSA加密材料。</span>
<span class="token class-name">SimpleRSAEncryptionMaterials</span> encryptionMaterials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleRSAEncryptionMaterials</span><span class="token punctuation">(</span>keyPair<span class="token punctuation">,</span> matDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果要下载并解密其他RSA密钥加密的文件，请将其他主密钥及其描述信息添加到加密材料中。</span>
<span class="token comment">// encryptionMaterials.addKeyPairDescMaterial(&lt;otherKeyPair&gt;, &lt;otherKeyPairMatDesc&gt;);</span>

<span class="token comment">// 创建加密客户端。</span>
<span class="token class-name">OSSEncryptionClient</span> ossEncryptionClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSEncryptionClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> encryptionMaterials<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 加密上传文件。</span>
ossEncryptionClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 范围下载。</span>
<span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> end <span class="token operator">=</span> <span class="token number">35</span><span class="token punctuation">;</span>
<span class="token class-name">GetObjectRequest</span> getObjectRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetObjectRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
getObjectRequest<span class="token punctuation">.</span><span class="token function">setRange</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
ossObject <span class="token operator">=</span> ossEncryptionClient<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>getObjectRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>ossObject<span class="token punctuation">.</span><span class="token function">getObjectContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    buffer<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 查看范围下载结果。</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Range-Get plain text:&quot;</span> <span class="token operator">+</span> content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Range-Get decrypted text: &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 关闭OSSEncryptionClient。</span>
ossEncryptionClient<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,26),Ua={href:"https://help.aliyun.com/document_detail/32016.html",target:"_blank",rel:"noopener noreferrer"},La=e(`<h2 id="使用sts进行临时授权" tabindex="-1"><a class="header-anchor" href="#使用sts进行临时授权" aria-hidden="true">#</a> 使用STS进行临时授权</h2><p>STS的优势如下：</p><ul><li>您无需透露您的长期密钥（AccessKey）给第三方应用，只需生成一个访问令牌并将令牌交给第三方应用。您可以自定义这个令牌的访问权限及有效期限。</li><li>您无需关心权限撤销问题，访问令牌过期后自动失效。</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 从STS服务获取的临时访问密钥（AccessKey ID和AccessKey Secret）。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 从STS服务获取的安全令牌（SecurityToken）。</span>
<span class="token class-name">String</span> securityToken <span class="token operator">=</span> <span class="token string">&quot;yourSecurityToken&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
<span class="token comment">//String bucketName = &quot;examplebucket&quot;;</span>
<span class="token comment">// 填写Object完整路径，例如exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
<span class="token comment">//String objectName = &quot;exampleobject.txt&quot;;</span>

<span class="token comment">// 从STS服务获取临时访问凭证后，您可以通过临时访问密钥和安全令牌生成OSSClient。</span>
<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> securityToken<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 执行OSS相关操作，例如上传、下载文件等。</span>
<span class="token comment">// 上传文件，此处以上传本地文件为例介绍。</span>
<span class="token comment">// 填写本地文件的完整路径。如果未指定本地路径，则默认从示例程序所属项目对应本地路径中上传文件。</span>
<span class="token comment">//PutObjectRequest putObjectRequest = new PutObjectRequest(bucketName, objectName, new File(&quot;D:\\\\localpath\\\\examplefile.txt&quot;));</span>
<span class="token comment">//ossClient.putObject(putObjectRequest);</span>

<span class="token comment">// 下载OSS文件到本地文件。如果指定的本地文件存在则覆盖，不存在则新建。</span>
<span class="token comment">// 如果未指定本地路径，则下载后的文件默认保存到示例程序所属项目对应本地路径中。</span>
<span class="token comment">//ossClient.getObject(new GetObjectRequest(bucketName, objectName), new File(&quot;D:\\\\localpath\\\\examplefile.txt&quot;));</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="使用签名url进行临时授权" tabindex="-1"><a class="header-anchor" href="#使用签名url进行临时授权" aria-hidden="true">#</a> 使用签名URL进行临时授权</h2><p><strong>说明</strong> <code>由于STS临时账号以及签名URL均需设置有效时长，当您使用STS临时账号生成签名URL执行相关操作（例如上传、下载文件）时，以最小的有效时长为准。例如您的STS临时账号的有效时长设置为1200秒、签名URL设置为3600秒时，当有效时长超过1200秒后，您无法使用此STS临时账号生成的签名URL上传文件。</code></p><ul><li>生成签名URL 您可以将生成的签名URL提供给访客进行临时访问。生成签名URL时，您可以通过指定URL的过期时间来限制访客的访问时长。签名URL的默认过期时间为3600秒，最大值为32400秒。 在URL中加入签名信息，以便将该URL转给第三方实现授权访问。</li><li>生成以GET方法访问的签名URL</li></ul><h3 id="生成单个以get方法访问的签名url" tabindex="-1"><a class="header-anchor" href="#生成单个以get方法访问的签名url" aria-hidden="true">#</a> 生成单个以GET方法访问的签名URL</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
  <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 从STS服务获取的临时访问密钥（AccessKey ID和AccessKey Secret）。</span>
  <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 从STS服务获取的安全令牌（SecurityToken）。</span>
  <span class="token class-name">String</span> securityToken <span class="token operator">=</span> <span class="token string">&quot;yourSecurityToken&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
  <span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 填写Object完整路径，例如exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
  <span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;exampleobject.txt&quot;</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 创建OSSClient实例。</span>
  <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> securityToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 设置签名URL过期时间为3600秒（1小时）。</span>
  <span class="token class-name">Date</span> expiration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 生成以GET方法访问的签名URL，访客可以直接通过浏览器访问相关内容。</span>
  <span class="token class-name">URL</span> url <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">generatePresignedUrl</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> expiration<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="生成多个以get方法访问的签名url" tabindex="-1"><a class="header-anchor" href="#生成多个以get方法访问的签名url" aria-hidden="true">#</a> 生成多个以GET方法访问的签名URL</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
    <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 从STS服务获取的临时访问密钥（AccessKey ID和AccessKey Secret）。</span>
    <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 从STS服务获取的安全令牌（SecurityToken）。</span>
    <span class="token class-name">String</span> securityToken <span class="token operator">=</span> <span class="token string">&quot;yourSecurityToken&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
    <span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Object完整路径，例如exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
    <span class="token comment">// 此处请填写多个Object完整路径，用于一次性获取多个Object的签名URL。</span>
    <span class="token class-name">String</span> objectNameList <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;exampleobject.txt&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;exampleimage.jpg&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 创建OSSClient实例。</span>
    <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> securityToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 设置签名URL过期时间为3600秒（1小时）。</span>
    <span class="token class-name">Date</span> expiration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> urlList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>objectNameList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">URL</span> url <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">generatePresignedUrl</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectNameList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> expiration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        urlList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 打印签名URL。</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token constant">URL</span> url<span class="token operator">:</span>urlList<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>生成以其他HTTP方法访问的签名URL<br> 如果您要授权其他用户临时执行其他操作（例如上传、删除文件等），需要生成对应的签名URL，例如生成以PUT方法访问的签名URL来上传文件。您可以根据需要一次生成单个或者多个以其他HTTP方法访问的签名URL。</li></ul><h3 id="生成单个以其他http方法访问的签名url" tabindex="-1"><a class="header-anchor" href="#生成单个以其他http方法访问的签名url" aria-hidden="true">#</a> 生成单个以其他HTTP方法访问的签名URL</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
    <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 从STS服务获取的临时访问密钥（AccessKey ID和AccessKey Secret）。</span>
    <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 从STS服务获取的安全令牌（SecurityToken）。</span>
    <span class="token class-name">String</span> securityToken <span class="token operator">=</span> <span class="token string">&quot;yourSecurityToken&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
    <span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Object完整路径，例如exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
    <span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;exampleobject.txt&quot;</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 从STS服务获取临时访问凭证后，您可以通过临时访问密钥和安全令牌生成OSSClient。</span>
    <span class="token comment">// 创建OSSClient实例。</span>
    <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> securityToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">GeneratePresignedUrlRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeneratePresignedUrlRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置签名URL过期时间为3600秒（1小时）。</span>
    <span class="token class-name">Date</span> expiration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span>expiration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置ContentType。</span>
    request<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置自定义元信息。</span>
    request<span class="token punctuation">.</span><span class="token function">addUserMetadata</span><span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;aliy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 生成签名URL。</span>
    <span class="token class-name">URL</span> signedUrl <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">generatePresignedUrl</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>signedUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> requestHeaders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置ContentType，必须和生成签名URL时设置的ContentType一致。</span>
    requestHeaders<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span><span class="token constant">CONTENT_TYPE</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置自定义元信息。</span>
    requestHeaders<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token constant">OSS_USER_METADATA_PREFIX</span> <span class="token operator">+</span> <span class="token string">&quot;author&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;aliy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 使用签名URL上传文件。</span>
    ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>signedUrl<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;Hello OSS&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> requestHeaders<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="生成多个以其他http方法访问的签名url" tabindex="-1"><a class="header-anchor" href="#生成多个以其他http方法访问的签名url" aria-hidden="true">#</a> 生成多个以其他HTTP方法访问的签名URL</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
    <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 从STS服务获取的临时访问密钥（AccessKey ID和AccessKey Secret）。</span>
    <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 从STS服务获取的安全令牌（SecurityToken）。</span>
    <span class="token class-name">String</span> securityToken <span class="token operator">=</span> <span class="token string">&quot;yourSecurityToken&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
    <span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Object完整路径，例如exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
    <span class="token comment">// 此处请填写多个Object完整路径，用于一次性获取多个Object的签名URL。</span>
    <span class="token class-name">String</span> objectNameList <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;exampleobject.txt&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;exampleimage.jpg&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> upLoadNameArray <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;D:\\\\localpath\\\\examplefile1.txt&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;D:\\\\localpath\\\\examplefile2.jpg&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    
    <span class="token comment">// 从STS服务获取临时访问凭证后，您可以通过临时访问密钥和安全令牌生成OSSClient。</span>
    <span class="token comment">// 创建OSSClient实例。</span>
    <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> securityToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 设置签名URL过期时间为3600秒（1小时）。</span>
    <span class="token class-name">Date</span> expiration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>objectNameList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">GeneratePresignedUrlRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeneratePresignedUrlRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectNameList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span>expiration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置ContentType。</span>
        request<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_OBJECT_CONTENT_TYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置自定义元信息。</span>
        request<span class="token punctuation">.</span><span class="token function">addUserMetadata</span><span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;aliy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token comment">// 生成签名URL。</span>
        <span class="token class-name">URL</span> signedUrl <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">generatePresignedUrl</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 打印签名URL。</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>signedUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> requestHeaders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestHeaders<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span><span class="token constant">CONTENT_TYPE</span><span class="token punctuation">,</span> <span class="token constant">DEFAULT_OBJECT_CONTENT_TYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestHeaders<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token constant">OSS_USER_METADATA_PREFIX</span> <span class="token operator">+</span> <span class="token string">&quot;author&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;aliy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token comment">// 如果要上传字符串，请使用如下方式。</span>
        <span class="token comment">//ossClient.putObject(signedUrl, new ByteArrayInputStream(&quot;Hello OSS&quot;.getBytes()), -1, requestHeaders, true);</span>
       
        <span class="token comment">// 使用签名URL上传文件。</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>signedUrl<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>upLoadNameArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> requestHeaders<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过传入HttpMethod.PUT参数，访客可以使用生成的签名URL上传文件。</p><ul><li><p>生成带有指定参数的签名URL</p><p>您可以根据需要一次生成单个或者多个带有指定参数的签名URL。</p></li></ul><h3 id="生成单个带有指定参数的签名url" tabindex="-1"><a class="header-anchor" href="#生成单个带有指定参数的签名url" aria-hidden="true">#</a> 生成单个带有指定参数的签名URL</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
    <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 从STS服务获取的临时访问密钥（AccessKey ID和AccessKey Secret）。</span>
    <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 从STS服务获取的安全令牌（SecurityToken）。</span>
    <span class="token class-name">String</span> securityToken <span class="token operator">=</span> <span class="token string">&quot;yourSecurityToken&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
    <span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Object完整路径，例如exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
    <span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;exampleobject.txt&quot;</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 创建OSSClient实例。</span>
    <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> securityToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 创建请求。</span>
    <span class="token class-name">GeneratePresignedUrlRequest</span> generatePresignedUrlRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeneratePresignedUrlRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置HttpMethod为PUT。</span>
    generatePresignedUrlRequest<span class="token punctuation">.</span><span class="token function">setMethod</span><span class="token punctuation">(</span><span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 添加用户自定义元信息。</span>
    generatePresignedUrlRequest<span class="token punctuation">.</span><span class="token function">addUserMetadata</span><span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;baymax&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置ContentType。</span>
    generatePresignedUrlRequest<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置签名URL过期时间为3600秒（1小时）。</span>
    <span class="token class-name">Date</span> expiration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    generatePresignedUrlRequest<span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span>expiration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 生成签名URL。</span>
    <span class="token class-name">URL</span> url <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">generatePresignedUrl</span><span class="token punctuation">(</span>generatePresignedUrlRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="生成多个带有指定参数的签名url" tabindex="-1"><a class="header-anchor" href="#生成多个带有指定参数的签名url" aria-hidden="true">#</a> 生成多个带有指定参数的签名URL</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
    <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 从STS服务获取的临时访问密钥（AccessKey ID和AccessKey Secret）。</span>
    <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 从STS服务获取的安全令牌（SecurityToken）。</span>
    <span class="token class-name">String</span> securityToken <span class="token operator">=</span> <span class="token string">&quot;yourSecurityToken&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
    <span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Object完整路径，例如exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
    <span class="token comment">// 此处请填写多个Object完整路径，用于一次性获取多个Object的签名URL。</span>
    <span class="token class-name">String</span> objectNameList <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;exampleobject.txt&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;exampleimage.jpg&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 创建OSSClient实例。</span>
    <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> securityToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置签名URL过期时间为3600秒（1小时）。</span>
    <span class="token class-name">Date</span> expiration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>objectNameList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 创建请求。</span>
        <span class="token class-name">GeneratePresignedUrlRequest</span> generatePresignedUrlRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeneratePresignedUrlRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectNameList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置HttpMethod为PUT。</span>
        generatePresignedUrlRequest<span class="token punctuation">.</span><span class="token function">setMethod</span><span class="token punctuation">(</span><span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加用户自定义元信息。</span>
        generatePresignedUrlRequest<span class="token punctuation">.</span><span class="token function">addUserMetadata</span><span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;baymax&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置ContentType。</span>
        generatePresignedUrlRequest<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        generatePresignedUrlRequest<span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span>expiration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 生成签名URL。</span>
        <span class="token class-name">URL</span> url <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">generatePresignedUrl</span><span class="token punctuation">(</span>generatePresignedUrlRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 打印签名URL。</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="使用签名url上传文件" tabindex="-1"><a class="header-anchor" href="#使用签名url上传文件" aria-hidden="true">#</a> 使用签名URL上传文件</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
    <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 从STS服务获取的临时访问密钥（AccessKey ID和AccessKey Secret）。</span>
    <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 从STS服务获取的安全令牌（SecurityToken）。</span>
    <span class="token class-name">String</span> securityToken <span class="token operator">=</span> <span class="token string">&quot;yourSecurityToken&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
    <span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Object完整路径，例如exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
    <span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;exampleobject.txt&quot;</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 创建OSSClient实例。</span>
    <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> securityToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 填写签名URL的过期时间。</span>
    <span class="token class-name">Date</span> expiration <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        expiration <span class="token operator">=</span> <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">parseRfc822Date</span><span class="token punctuation">(</span><span class="token string">&quot;Wed, 18 Mar 2022 14:20:00 GMT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ParseException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 生成签名URL。</span>
    <span class="token class-name">GeneratePresignedUrlRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeneratePresignedUrlRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置过期时间。</span>
    request<span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span>expiration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置ContentType。</span>
    request<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 添加用户自定义元信息。</span>
    request<span class="token punctuation">.</span><span class="token function">addUserMetadata</span><span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;aliy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 通过HTTP PUT请求生成签名URL。</span>
    <span class="token class-name">URL</span> signedUrl <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">generatePresignedUrl</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;signed url for putObject: &quot;</span> <span class="token operator">+</span> signedUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 使用签名URL发送请求。</span>
    <span class="token comment">// 填写本地文件的完整路径。如果未指定本地路径，则默认从示例程序所属项目对应本地路径中上传文件。</span>
    <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\\\localpath\\\\examplefile.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileInputStream</span> fin <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        fin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 添加PutObject请求头。</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> customHeaders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    customHeaders<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    customHeaders<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-oss-meta-author&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;aliy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">PutObjectResult</span> result <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>signedUrl<span class="token punctuation">,</span> fin<span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> customHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="使用签名url获取文件" tabindex="-1"><a class="header-anchor" href="#使用签名url获取文件" aria-hidden="true">#</a> 使用签名URL获取文件</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span>
    <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;yourEndpoint&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 从STS服务获取的临时访问密钥（AccessKey ID和AccessKey Secret）。</span>
    <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeyId&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;yourAccessKeySecret&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 从STS服务获取的安全令牌（SecurityToken）。</span>
    <span class="token class-name">String</span> securityToken <span class="token operator">=</span> <span class="token string">&quot;yourSecurityToken&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
    <span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;examplebucket&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Object完整路径，例如exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
    <span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">&quot;exampleobject.txt&quot;</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 创建OSSClient实例。</span>
    <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> securityToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 填写签名URL的过期时间。</span>
    <span class="token class-name">Date</span> expiration <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        expiration <span class="token operator">=</span> <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">parseRfc822Date</span><span class="token punctuation">(</span><span class="token string">&quot;Wed, 18 Mar 2022 14:20:00 GMT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ParseException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 生成签名URL。</span>
    <span class="token class-name">GeneratePresignedUrlRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeneratePresignedUrlRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置过期时间。</span>
    request<span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span>expiration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 通过HTTP GET请求生成签名URL。</span>
    <span class="token class-name">URL</span> signedUrl <span class="token operator">=</span> ossClient <span class="token punctuation">.</span><span class="token function">generatePresignedUrl</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;signed url for getObject: &quot;</span> <span class="token operator">+</span> signedUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 使用签名URL发送请求。</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> customHeaders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 添加GetObject请求头。</span>
    customHeaders<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;Range&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bytes=100-1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">OSSObject</span> object <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>signedUrl<span class="token punctuation">,</span>customHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,26),Da={href:"https://help.aliyun.com/document_detail/85170.html",target:"_blank",rel:"noopener noreferrer"},Fa={href:"https://help.aliyun.com/document_detail/47505.html",target:"_blank",rel:"noopener noreferrer"},Ha={href:"https://github.com/aliyun/aliyun-oss-java-sdk/blob/master/src/samples/ImageSample.java?spm=a2c4g.11186623.0.0.79e460b3gmbYI7&file=ImageSample.java",target:"_blank",rel:"noopener noreferrer"},za=e("<h1>12、OSS常见错误码</h1><table><thead><tr><th>错误码</th><th>描述</th><th>HTTP状态码</th></tr></thead><tbody><tr><td>AccessDenied</td><td>拒绝访问</td><td>403</td></tr><tr><td>BucketAlreadyExists</td><td>存储空间已经存在</td><td>409</td></tr><tr><td>BucketNotEmpty</td><td>存储空间非空</td><td>409</td></tr><tr><td>EntityTooLarge</td><td>实体过大</td><td>400</td></tr><tr><td>EntityTooSmall</td><td>实体过小</td><td>400</td></tr><tr><td>FileGroupTooLarge</td><td>文件组过大</td><td>400</td></tr><tr><td>FilePartNotExist</td><td>文件分片不存在</td><td>400</td></tr><tr><td>FilePartStale</td><td>文件分片过时</td><td>400</td></tr><tr><td>InvalidArgument</td><td>参数格式错误</td><td>400</td></tr><tr><td>InvalidAccessKeyId</td><td>AccessKeyId不存在</td><td>403</td></tr><tr><td>InvalidBucketName</td><td>无效的存储空间名称</td><td>400</td></tr><tr><td>InvalidDigest</td><td>无效的摘要</td><td>400</td></tr><tr><td>InvalidObjectName</td><td>无效的文件名称</td><td>400</td></tr><tr><td>InvalidPart</td><td>无效的分片</td><td>400</td></tr><tr><td>InvalidPartOrder</td><td>无效的分片顺序</td><td>400</td></tr><tr><td>InvalidTargetBucketForLogging</td><td>Logging操作中有无效的目标存储空间</td><td>400</td></tr><tr><td>InternalError</td><td>OSS内部错误</td><td>500</td></tr><tr><td>MalformedXML</td><td>XML格式非法</td><td>400</td></tr><tr><td>MethodNotAllowed</td><td>不支持的方法</td><td>405</td></tr><tr><td>MissingArgument</td><td>缺少参数</td><td>411</td></tr><tr><td>MissingContentLength</td><td>缺少内容长度</td><td>411</td></tr><tr><td>NoSuchBucket</td><td>存储空间不存在</td><td>404</td></tr><tr><td>NoSuchKey</td><td>文件不存在</td><td>404</td></tr><tr><td>NoSuchUpload</td><td>分片上传ID不存在</td><td>404</td></tr><tr><td>NotImplemented</td><td>无法处理的方法</td><td>501</td></tr><tr><td>PreconditionFailed</td><td>预处理错误</td><td>412</td></tr><tr><td>RequestTimeTooSkewed</td><td>客户端本地时间和OSS服务器时间相差超过15分钟</td><td>403</td></tr><tr><td>RequestTimeout</td><td>请求超时</td><td>400</td></tr><tr><td>SignatureDoesNotMatch</td><td>签名错误</td><td>403</td></tr><tr><td>InvalidEncryptionAlgorithmError</td><td>指定的熵编码加密算法错误</td><td>400</td></tr></tbody></table>",2);function Va(Ga,Xa){const a=u("ExternalLinkIcon");return c(),l("div",null,[i(" more "),n("p",null,[s("[阿里文档]( "),n("a",m,[s("https://help.aliyun.com/document_detail/32009.html"),t(a)])]),v,n("p",null,[n("a",b,[s("https://mvnrepository.com/artifact/com.aliyun.oss/aliyun-sdk-oss"),t(a)])]),g,n("p",null,[n("a",y,[s("https://ram.console.aliyun.com/users/new"),t(a)]),s(" ,+ 分配权限")]),h,n("p",null,[s("access申请："),n("a",S,[s("https://ram.console.aliyun.com/users"),t(a)])]),q,n("h2",f,[w,s(" -- "),n("a",j,[s("获取签名"),t(a)]),R]),O,x,n("table",null,[_,n("tbody",null,[C,n("tr",null,[A,n("td",K,[s('用户发送上传请求的域名"'),n("a",P,[s("http://xxx.oss-cn-hangzhou.aliyuncs.com"),t(a)]),s('",')])]),M,E,I,B])]),N,n("p",null,[n("a",T,[s("http://localhost:50000/api/thirdparty/oss/policy"),t(a)])]),U,n("h1",null,[n("a",L,[s("3，存储空间（Bucket）"),t(a)])]),D,n("h2",F,[H,s(" -- "),n("a",z,[s("存储空间标签"),t(a)])]),V,n("h2",G,[X,s(" -- "),n("a",W,[s("存储空间清单"),t(a)])]),n("h2",J,[$,s(" -- "),n("a",Y,[s("授权策略"),t(a)])]),n("h2",Z,[Q,s(" -- "),n("a",nn,[s("合规保留策略"),t(a)])]),n("h2",sn,[an,s(" -- "),n("a",tn,[s("生命周期"),t(a)])]),en,n("h1",null,[n("a",pn,[s("4，上传文件"),t(a)])]),n("h2",on,[cn,s(" -- "),n("a",ln,[s("概述"),t(a)])]),un,n("h2",kn,[rn,s(" -- "),n("a",dn,[s("简单上传"),t(a)])]),mn,n("h2",vn,[bn,s(" -- "),n("a",gn,[s("表单上传"),t(a)])]),yn,n("h2",hn,[Sn,s(" -- "),n("a",qn,[s("追加上传"),t(a)])]),fn,n("h2",wn,[jn,s(" -- "),n("a",Rn,[s("断点续传上传"),t(a)])]),On,n("h2",xn,[_n,s(" -- "),n("a",Cn,[s("分片上传"),t(a)])]),An,n("h2",Kn,[Pn,s(" -- "),n("a",Mn,[s("进度条"),t(a)])]),En,n("h2",In,[Bn,s(" -- "),n("a",Nn,[s("上传回调"),t(a)]),Tn]),Un,n("h1",null,[n("a",Ln,[s("5，下载文件"),t(a)])]),n("h2",Dn,[Fn,s(" -- "),n("a",Hn,[s("流式下载"),t(a)])]),zn,n("h2",Vn,[Gn,s(" -- "),n("a",Xn,[s("下载到本地文件"),t(a)])]),Wn,n("h2",Jn,[$n,s(" -- "),n("a",Yn,[s("范围下载"),t(a)])]),Zn,n("h2",Qn,[ns,s(" -- "),n("a",ss,[s("断点续传下载"),t(a)])]),as,n("h2",ts,[es,s(" -- "),n("a",ps,[s("限定条件下载"),t(a)])]),os,n("h2",cs,[ls,s(" -- "),n("a",is,[s("进度条"),t(a)])]),us,n("h1",null,[n("a",ks,[s("6，管理文件"),t(a)])]),n("h2",rs,[ds,s(" -- "),n("a",ms,[s("判断文件是否存在"),t(a)])]),vs,n("h2",bs,[gs,s(" -- "),n("a",ys,[s("管理文件访问权限"),t(a)])]),hs,n("h2",Ss,[qs,s(" -- "),n("a",fs,[s("管理文件元信息"),t(a)])]),ws,n("h2",js,[Rs,s(" -- "),n("a",Os,[s("转换文件存储类型"),t(a)])]),xs,n("h2",_s,[Cs,s(" -- "),n("a",As,[s("列举文件"),t(a)])]),n("h2",Ks,[Ps,s(" -- "),n("a",Ms,[s("查询文件"),t(a)])]),n("h2",Es,[Is,s(" -- "),n("a",Bs,[s("删除文件"),t(a)])]),n("h2",Ns,[Ts,s(" -- "),n("a",Us,[s("拷贝文件"),t(a)])]),n("h2",Ls,[Ds,s(" -- "),n("a",Fs,[s("禁止覆盖同名文件"),t(a)])]),n("h2",Hs,[zs,s(" -- "),n("a",Vs,[s("解冻文件"),t(a)])]),n("h2",Gs,[Xs,s(" -- "),n("a",Ws,[s("管理软链接"),t(a)])]),n("h1",null,[n("a",Js,[s("7，管理版本控制"),t(a)])]),n("h2",$s,[Ys,s(" -- "),n("a",Zs,[s("管理版本控制"),t(a)])]),n("h2",Qs,[na,s(" -- "),n("a",sa,[s("上传文件"),t(a)])]),n("h2",aa,[ta,s(" -- "),n("a",ea,[s("下载文件"),t(a)])]),n("h2",pa,[oa,s(" -- "),n("a",ca,[s("拷贝文件"),t(a)])]),n("h2",la,[ia,s(" -- "),n("a",ua,[s("列举文件"),t(a)])]),n("h2",ka,[ra,s(" -- "),n("a",da,[s("删除文件"),t(a)])]),n("h2",ma,[va,s(" -- "),n("a",ba,[s("解冻文件"),t(a)])]),n("h2",ga,[ya,s(" -- "),n("a",ha,[s("获取文件元信息"),t(a)])]),n("h2",Sa,[qa,s(" -- "),n("a",fa,[s("管理文件访问权限"),t(a)])]),n("h2",wa,[ja,s(" -- "),n("a",Ra,[s("管理软链接"),t(a)])]),n("h1",null,[n("a",Oa,[s("8，数据加密"),t(a)])]),n("h2",xa,[_a,s(" -- "),n("a",Ca,[s("服务器端加密"),t(a)])]),Aa,n("h2",Ka,[Pa,s(" -- "),n("a",Ma,[s("客户端加密"),t(a)])]),Ea,n("ul",null,[n("li",null,[n("a",Ia,[s("JDK6 JCE补充包"),t(a)])]),n("li",null,[n("a",Ba,[s("JDK7 JCE补充包"),t(a)])]),n("li",null,[n("a",Na,[s("JDK8 JCE补充包"),t(a)])])]),Ta,n("h1",null,[n("a",Ua,[s("9、授权访问"),t(a)])]),La,n("h1",null,[n("a",Da,[s("10、数据安全性"),t(a)])]),n("h1",null,[n("a",Fa,[s("11、图片处理"),t(a)])]),n("p",null,[n("a",Ha,[s("项目"),t(a)])]),za])}const Ja=o(d,[["render",Va],["__file","oss.html.vue"]]);export{Ja as default};
