import{_ as a,V as s,W as n,a0 as e,$ as p}from"./framework-ed4f969a.js";const t={},o=p(`<h1>常用Linux命令实例</h1><h2 id="_1、查看有多少个ip访问" tabindex="-1"><a class="header-anchor" href="#_1、查看有多少个ip访问" aria-hidden="true">#</a> 1、查看有多少个IP访问：</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span> log_file<span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span><span class="token operator">|</span><span class="token function">wc</span> <span class="token parameter variable">-l</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_2、查看某一个页面被访问的次数" tabindex="-1"><a class="header-anchor" href="#_2、查看某一个页面被访问的次数" aria-hidden="true">#</a> 2、查看某一个页面被访问的次数：</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">grep</span> <span class="token string">&quot;/index.php&quot;</span> log_file <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_3、查看每一个ip访问了多少个页面" tabindex="-1"><a class="header-anchor" href="#_3、查看每一个ip访问了多少个页面" aria-hidden="true">#</a> 3、查看每一个IP访问了多少个页面：</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">awk</span> <span class="token string">&#39;{++S[$1]} END {for (a in S) print a,S[a]}&#39;</span> log_file <span class="token operator">&gt;</span> log.txt
<span class="token function">sort</span> <span class="token parameter variable">-n</span> <span class="token parameter variable">-t</span> <span class="token string">&#39; &#39;</span> <span class="token parameter variable">-k</span> <span class="token number">2</span> log.txt 配合sort进一步排序
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4、将每个ip访问的页面数进行从小到大排序" tabindex="-1"><a class="header-anchor" href="#_4、将每个ip访问的页面数进行从小到大排序" aria-hidden="true">#</a> 4、将每个IP访问的页面数进行从小到大排序：</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">awk</span> <span class="token string">&#39;{++S[$1]} END {for (a in S) print S[a],a}&#39;</span> log_file <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-n</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_5、查看某一个ip访问了哪些页面" tabindex="-1"><a class="header-anchor" href="#_5、查看某一个ip访问了哪些页面" aria-hidden="true">#</a> 5、查看某一个IP访问了哪些页面：</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">grep</span> ^111.111.111.111 log_file<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $1,$7}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_6、去掉搜索引擎统计的页面" tabindex="-1"><a class="header-anchor" href="#_6、去掉搜索引擎统计的页面" aria-hidden="true">#</a> 6、去掉搜索引擎统计的页面：</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">awk</span> <span class="token string">&#39;{print $12,$1}&#39;</span> log_file <span class="token operator">|</span> <span class="token function">grep</span> ^<span class="token punctuation">\\</span>&quot;Mozilla <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $2}&#39;</span> <span class="token operator">|</span><span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_7、查看2015年8月16日14时这一个小时内有多少ip访问" tabindex="-1"><a class="header-anchor" href="#_7、查看2015年8月16日14时这一个小时内有多少ip访问" aria-hidden="true">#</a> 7、查看2015年8月16日14时这一个小时内有多少IP访问:</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">awk</span> <span class="token string">&#39;{print $4,$1}&#39;</span> log_file <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">16</span>/Aug/2015:14 <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $2}&#39;</span><span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8、查看访问前十个ip地址" tabindex="-1"><a class="header-anchor" href="#_8、查看访问前十个ip地址" aria-hidden="true">#</a> 8、查看访问前十个ip地址</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span> <span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-nr</span> <span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-10</span> access_log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>uniq -c 相当于分组统计并把统计数放在最前面</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> access.log<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-10</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> access.log<span class="token operator">|</span><span class="token function">awk</span> &#39;<span class="token punctuation">{</span>counts<span class="token punctuation">[</span><span class="token variable"><span class="token variable">$(</span><span class="token number">11</span><span class="token variable">)</span></span><span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span> END <span class="token punctuation">{</span>for<span class="token punctuation">(</span>url <span class="token keyword">in</span> counts<span class="token punctuation">)</span> print counts<span class="token punctuation">[</span>url<span class="token punctuation">]</span>, url<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_9、访问次数最多的10个文件或页面" tabindex="-1"><a class="header-anchor" href="#_9、访问次数最多的10个文件或页面" aria-hidden="true">#</a> 9、访问次数最多的10个文件或页面</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> log_file<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{print $11}&#39;</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-nr</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-10</span>
<span class="token function">cat</span> log_file<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{print $11}&#39;</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-20</span>
<span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span> log_file <span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-n</span> <span class="token parameter variable">-r</span> <span class="token operator">|</span><span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-n</span> <span class="token parameter variable">-r</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-20</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>访问量最大的前20个ip</p></blockquote><h2 id="_10、通过子域名访问次数-依据referer来计算-稍有不准" tabindex="-1"><a class="header-anchor" href="#_10、通过子域名访问次数-依据referer来计算-稍有不准" aria-hidden="true">#</a> 10、通过子域名访问次数，依据referer来计算，稍有不准</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> access.log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $11}&#39;</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">&#39; s/http:\\/\\///&#39;</span> <span class="token parameter variable">-e</span> <span class="token string">&#39; s/\\/.*//&#39;</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-rn</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-20</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_11、列出传输大小最大的几个文件" tabindex="-1"><a class="header-anchor" href="#_11、列出传输大小最大的几个文件" aria-hidden="true">#</a> 11、列出传输大小最大的几个文件</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> www.access.log <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;($7~/\\.php/){print $10 &quot; &quot; $1 &quot; &quot; $4 &quot; &quot; $7}&#39;</span><span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-100</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_12、列出输出大于200000byte-约200kb-的页面以及对应页面发生次数" tabindex="-1"><a class="header-anchor" href="#_12、列出输出大于200000byte-约200kb-的页面以及对应页面发生次数" aria-hidden="true">#</a> 12、列出输出大于200000byte(约200kb)的页面以及对应页面发生次数</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> www.access.log <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;($10 &gt; 200000 &amp;&amp; $7~/\\.php/){print $7}&#39;</span><span class="token operator">|</span><span class="token function">sort</span> -n<span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-100</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_13、如果日志最后一列记录的是页面文件传输时间-则有列出到客户端最耗时的页面" tabindex="-1"><a class="header-anchor" href="#_13、如果日志最后一列记录的是页面文件传输时间-则有列出到客户端最耗时的页面" aria-hidden="true">#</a> 13、如果日志最后一列记录的是页面文件传输时间，则有列出到客户端最耗时的页面</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> www.access.log <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;($7~/\\.php/){print $NF &quot; &quot; $1 &quot; &quot; $4 &quot; &quot; $7}&#39;</span><span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-100</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_14、列出最最耗时的页面-超过60秒的-的以及对应页面发生次数" tabindex="-1"><a class="header-anchor" href="#_14、列出最最耗时的页面-超过60秒的-的以及对应页面发生次数" aria-hidden="true">#</a> 14、列出最最耗时的页面(超过60秒的)的以及对应页面发生次数</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> www.access.log <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;($NF &gt; 60 &amp;&amp; $7~/\\.php/){print $7}&#39;</span><span class="token operator">|</span><span class="token function">sort</span> -n<span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-100</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_15、列出传输时间超过-30-秒的文件" tabindex="-1"><a class="header-anchor" href="#_15、列出传输时间超过-30-秒的文件" aria-hidden="true">#</a> 15、列出传输时间超过 30 秒的文件</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> www.access.log <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;($NF &gt; 30){print $7}&#39;</span><span class="token operator">|</span><span class="token function">sort</span> -n<span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-20</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_16、列出当前服务器每一进程运行的数量-倒序排列" tabindex="-1"><a class="header-anchor" href="#_16、列出当前服务器每一进程运行的数量-倒序排列" aria-hidden="true">#</a> 16、列出当前服务器每一进程运行的数量，倒序排列</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">&#39; &#39;</span> <span class="token string">&#39;{print $8 &quot; &quot; $9}&#39;</span> <span class="token operator">|</span><span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-nr</span> <span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-20</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_17、查看apache当前并发访问数" tabindex="-1"><a class="header-anchor" href="#_17、查看apache当前并发访问数" aria-hidden="true">#</a> 17、查看apache当前并发访问数</h2><p>对比httpd.conf中MaxClients的数字差距多少</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> <span class="token parameter variable">-an</span> <span class="token operator">|</span> <span class="token function">grep</span> ESTABLISHED <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_18、可以使用如下参数查看数据" tabindex="-1"><a class="header-anchor" href="#_18、可以使用如下参数查看数据" aria-hidden="true">#</a> 18、可以使用如下参数查看数据</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">ps</span> -ef<span class="token operator">|</span><span class="token function">grep</span> httpd<span class="token operator">|</span><span class="token function">wc</span> <span class="token parameter variable">-l1388</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>统计httpd进程数，连个请求会启动一个进程，使用于Apache服务器。</p><p>表示Apache能够处理1388个并发请求，这个值Apache可根据负载情况自动调整</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> -nat<span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;80&quot;</span><span class="token operator">|</span><span class="token function">wc</span> <span class="token parameter variable">-l</span>
<span class="token number">4341</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>netstat -an会打印系统当前网络链接状态，而grep -i “80”是用来提取与80端口有关的连接的，wc -l进行连接数统计。 最终返回的数字就是当前所有80端口的请求总数</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> -na<span class="token operator">|</span><span class="token function">grep</span> ESTABLISHED<span class="token operator">|</span><span class="token function">wc</span> <span class="token parameter variable">-l</span>
<span class="token number">376</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>netstat -an会打印系统当前网络链接状态，而grep ESTABLISHED 提取出已建立连接的信息。然后wc -l统计 最终返回的数字就是当前所有80端口的已建立连接的总数。</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> -nat<span class="token operator">||</span><span class="token function">grep</span> ESTABLISHED<span class="token operator">|</span><span class="token function">wc</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>可查看所有建立连接的详细记录</p><h2 id="_19、输出每个ip的连接数-以及总的各个状态的连接数" tabindex="-1"><a class="header-anchor" href="#_19、输出每个ip的连接数-以及总的各个状态的连接数" aria-hidden="true">#</a> 19、输出每个ip的连接数，以及总的各个状态的连接数</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> <span class="token parameter variable">-n</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;/^tcp/ {n=split($(NF-1),array,&quot;:&quot;);if(n&lt;=2)++S[array[(1)]];else++S[array[(4)]];++s[$NF];++N} END {for(a in S){printf(&quot;%-20s %s\\n&quot;, a, S[a]);++I}printf(&quot;%-20s %s\\n&quot;,&quot;TOTAL_IP&quot;,I);for(a in s) printf(&quot;%-20s %s\\n&quot;,a, s[a]);printf(&quot;%-20s %s\\n&quot;,&quot;TOTAL_LINK&quot;,N);}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_20、其他" tabindex="-1"><a class="header-anchor" href="#_20、其他" aria-hidden="true">#</a> 20、其他</h2><p>分析日志文件下 2012-05-04 访问页面最高 的前20个 URL 并排序</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> access.log <span class="token operator">|</span><span class="token function">grep</span> <span class="token string">&#39;04/May/2012&#39;</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $11}&#39;</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-20</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查询受访问页面的URL地址中 含有 <code>www.abc.com</code> 网址的 IP 地址</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> access_log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;($11~/\\www.abc.com/){print $1}&#39;</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-nr</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>获取访问最高的10个IP地址 同时也可以按时间来查询</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> linewow-access.log<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-10</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>时间段查询日志时间段的情况</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> log_file <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token string">&#39;15/Aug/2015|16/Aug/2015&#39;</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-10</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>分析 2015/8/15 到 2015/8/16 访问”/index.php?g=Member&amp;m=Public&amp;a=sendValidCode”的IP倒序排列</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> log_file <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token string">&#39;15/Aug/2015|16/Aug/2015&#39;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{if($7 == &quot;/index.php?g=Member&amp;m=Public&amp;a=sendValidCode&quot;) print $1,$7}&#39;</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-nr</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>($7~/.php/) $7里面包含.php的就输出,本句的意思是最耗时的一百个PHP页面</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> log_file <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;($7~/\\.php/){print $NF &quot; &quot; $1 &quot; &quot; $4 &quot; &quot; $7}&#39;</span><span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-100</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>列出最最耗时的页面(超过60秒的)的以及对应页面发生次数</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> access.log <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;($NF &gt; 60 &amp;&amp; $7~/\\.php/){print $7}&#39;</span><span class="token operator">|</span><span class="token function">sort</span> -n<span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-100</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>统计网站流量（G)</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> access.log <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{sum+=$10} END {print sum/1024/1024/1024}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>统计404的连接</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">awk</span> <span class="token string">&#39;($9 ~/404/)&#39;</span> access.log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $9,$7}&#39;</span> <span class="token operator">|</span> <span class="token function">sort</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>统计http status</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> access.log <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{counts[$(9)]+=1}; END {for(code in counts) print code, counts[code]}&#39;</span><span class="token function">cat</span> access.log <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{print $9}&#39;</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-rn</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>每秒并发</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">watch</span> <span class="token string">&quot;awk &#39;{if(<span class="token variable">$9</span>~/200|30|404/)COUNT[<span class="token variable">$4</span>]++}END{for( a in COUNT) print a,COUNT[a]}&#39; log_file|sort -k 2 -nr|head -n10&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>带宽统计</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> apache.log <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{if($7~/GET/) count++}END{print &quot;client_request=&quot;count}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>找出某天访问次数最多的10个IP</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> /tmp/access.log <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;20/Mar/2011&quot;</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{print $3}&#39;</span><span class="token operator">|</span><span class="token function">sort</span> <span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>当天ip连接数最高的ip都在干些什么</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> access.log <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;10.0.21.17&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $8}&#39;</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">10</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>小时单位里ip连接数最多的10个时段</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">awk</span> <span class="token parameter variable">-vFS</span><span class="token operator">=</span><span class="token string">&quot;[:]&quot;</span> <span class="token string">&#39;{gsub(&quot;-.*&quot;,&quot;&quot;,$1);num[$2&quot; &quot;$1]++}END{for(i in num)print i,num[i]}&#39;</span> log_file <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-n</span> <span class="token parameter variable">-k</span> <span class="token number">3</span> <span class="token parameter variable">-r</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-10</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>找出访问次数最多的几个分钟</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span> access.log <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;20/Mar/2011&quot;</span> <span class="token operator">|</span><span class="token function">cut</span> <span class="token parameter variable">-c</span> <span class="token number">14</span>-18<span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>取5分钟日志</p><p><code>if [ $DATE_MINUTE != $DATE_END_MINUTE ] ;then #</code> 则判断开始时间戳与结束时间戳是否相等</p><p><code>START_LINE=sed -n &quot;/$DATE_MINUTE/=&quot; $APACHE_LOG|head -n1</code> #如果不相等，则取出开始时间戳的行号，与结束时间戳的行号</p><p>查看tcp的链接状态</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> <span class="token parameter variable">-nat</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{print $6}&#39;</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-rn</span> 
<span class="token function">netstat</span> <span class="token parameter variable">-n</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;/^tcp/ {++S[$NF]};END {for(a in S) print a, S[a]}&#39;</span> 
<span class="token function">netstat</span> <span class="token parameter variable">-n</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;/^tcp/ {++state[$NF]}; END {for(key in state) print key,&quot;\\t&quot;,state[key]}&#39;</span> 
<span class="token function">netstat</span> <span class="token parameter variable">-n</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;/^tcp/ {++arr[$NF]};END {for(k in arr) print k,&quot;\\t&quot;,arr[k]}&#39;</span> 
<span class="token function">netstat</span> <span class="token parameter variable">-n</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;/^tcp/ {print $NF}&#39;</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-rn</span> 
<span class="token function">netstat</span> <span class="token parameter variable">-ant</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $NF}&#39;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">&#39;[a-z]&#39;</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-cnetstat</span> -ant<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;/ip:80/{split($5,ip,&quot;:&quot;);++S[ip[1]]}END{for (a in S) print S[a],a}&#39;</span> <span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-n</span> 
<span class="token function">netstat</span> <span class="token parameter variable">-ant</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;/:80/{split($5,ip,&quot;:&quot;);++S[ip[1]]}END{for (a in S) print S[a],a}&#39;</span> <span class="token operator">|</span><span class="token function">sort</span> -rn<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">10</span> 
<span class="token function">awk</span> <span class="token string">&#39;BEGIN{printf (&quot;http_code\\tcount_num\\n&quot;)}{COUNT[$10]++}END{for (a in COUNT) printf a&quot;\\t\\t&quot;COUNT[a]&quot;\\n&quot;}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查找请求数前20个IP（常用于查找攻来源）：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> -anlp<span class="token operator">|</span><span class="token function">grep</span> <span class="token number">80</span><span class="token operator">|</span><span class="token function">grep</span> tcp<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{print $5}&#39;</span><span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">&#39;{print $1}&#39;</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-n20</span> <span class="token function">netstat</span> <span class="token parameter variable">-ant</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;/:80/{split($5,ip,&quot;:&quot;);++A[ip[1]]}END{for(i in A) print A[i],i}&#39;</span> <span class="token operator">|</span><span class="token function">sort</span> -rn<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-n20</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>用tcpdump嗅探80端口的访问看看谁最高</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>tcpdump <span class="token parameter variable">-i</span> eth0 <span class="token parameter variable">-tnn</span> dst port <span class="token number">80</span> <span class="token parameter variable">-c</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">&quot;.&quot;</span> <span class="token string">&#39;{print $1&quot;.&quot;$2&quot;.&quot;$3&quot;.&quot;$4}&#39;</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span> <span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-20</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查找较多time_wait连接</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> -n<span class="token operator">|</span><span class="token function">grep</span> TIME_WAIT<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{print $5}&#39;</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -rn<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-n20</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>找查较多的SYN连接</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> <span class="token parameter variable">-an</span> <span class="token operator">|</span> <span class="token function">grep</span> SYN <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $5}&#39;</span> <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">&#39;{print $1}&#39;</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span> <span class="token operator">|</span> <span class="token function">more</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>根据端口列进程</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> <span class="token parameter variable">-ntlp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">80</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $7}&#39;</span> <span class="token operator">|</span> <span class="token function">cut</span> -d/ <span class="token parameter variable">-f1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查看了连接数和当前的连接数</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> <span class="token parameter variable">-ant</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token variable">$ip</span>:80 <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span> <span class="token function">netstat</span> <span class="token parameter variable">-ant</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token variable">$ip</span>:80 <span class="token operator">|</span> <span class="token function">grep</span> EST <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查看IP访问次数</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> -nat<span class="token operator">|</span><span class="token function">grep</span> <span class="token string">&quot;:80&quot;</span><span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{print $5}&#39;</span> <span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">&#39;{print $1}&#39;</span> <span class="token operator">|</span> <span class="token function">sort</span><span class="token operator">|</span> <span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-n</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Linux命令分析当前的链接状况</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> <span class="token parameter variable">-n</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>watch &quot;netstat -n | awk &#39;/^tcp/ {++S[\\$NF]} END {for(a in S) print a, S[a]}&#39;&quot;</code> # 通过watch可以一直监控</p><ul><li><code>LAST_ACK 5</code> #关闭一个TCP连接需要从两个方向上分别进行关闭，双方都是通过发送FIN来表示单方向数据的关闭，当通信双方发送了最后一个FIN的时候， 发送方此时处于LAST_ACK状态，当发送方收到对方的确认（Fin的Ack确认）后才真正关闭整个TCP连接；</li><li><code>SYN_RECV 30</code> # 表示正在等待处理的请求数；</li><li><code>ESTABLISHED 1597</code> # 表示正常数据传输状态；</li><li><code>FIN_WAIT1 51</code> # 表示server端主动要求关闭tcp连接；</li><li><code>FIN_WAIT2 504</code> # 表示客户端中断连接；</li><li><code>TIME_WAIT 1057</code> # 表示处理完毕，等待超时结束的请求数；</li></ul>`,108);function c(r,l){return s(),n("div",null,[e(" more "),o])}const u=a(t,[["render",c],["__file","command-examples.html.vue"]]);export{u as default};
